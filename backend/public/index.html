<!DOCTYPE html>
<html lang="en" data-theme="dark" data-site-style="default">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polleneer - The Social Hive</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&family=Source+Code+Pro:wght@400;500;600&display=swap" rel="stylesheet">
    
    <style>
        /* CSS Variables for Theme */
        :root {
            /* Bee Theme Colors */
            --honey-yellow: #FFC30B;
            --honey-dark: #E6A800;
            --hive-orange: #FF8C00;
            --pollen-gold: #FFD700;
            --nectar-light: #FFF9C4;
            --bee-black: #1A1A1A;
            --wax-white: #F8F8F8;
            --comb-brown: #8B4513;
            --flower-pink: #FF69B4;
            --leaf-green: #228B22;
            --sky-blue: #87CEEB;
            --background-light: #FFFEF0;
            --background-dark: #0F0F0F;
            --card-light: #FFFFFF;
            --card-dark: #1E1E1E;
            --text-light: #333333;
            --text-dark: #E0E0E0;
            --border-light: #E0E0E0;
            --border-dark: #333333;
        }

        /* Default Dark Theme */
        [data-theme="dark"] {
            --bg-primary: var(--background-dark);
            --bg-secondary: var(--bee-black);
            --bg-card: var(--card-dark);
            --bg-input: #2A2A2A;
            --text-primary: var(--text-dark);
            --text-secondary: #AAAAAA;
            --border-color: var(--border-dark);
            --shadow-color: rgba(0, 0, 0, 0.3);
        }

        /* Light Theme */
        [data-theme="light"] {
            --bg-primary: var(--background-light);
            --bg-secondary: var(--wax-white);
            --bg-card: var(--card-light);
            --bg-input: #FFFFFF;
            --text-primary: var(--text-light);
            --text-secondary: #666666;
            --border-color: var(--border-light);
            --shadow-color: rgba(0, 0, 0, 0.1);
        }

        /* Site Styles */
        [data-site-style="default"] {
            --site-bg: var(--bg-primary);
            --site-font: 'Inter', sans-serif;
            --site-radius: 15px;
        }

        [data-site-style="rounded"] {
            --site-radius: 25px;
        }

        [data-site-style="sharp"] {
            --site-radius: 5px;
        }

        [data-site-style="honeycomb"] {
            --site-bg: linear-gradient(45deg, var(--bg-primary), var(--bg-secondary));
        }

        /* ===== LOADING SPINNER STYLES ===== */
#loadingOverlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(255, 204, 0, 0.95);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    flex-direction: column;
    backdrop-filter: blur(5px);
}

.hexagon-spinner {
    width: 60px;
    height: 60px;
    position: relative;
}

.hexagon-spinner:before,
.hexagon-spinner:after {
    content: '';
    position: absolute;
    width: 100%;
    height: 100%;
    border: 4px solid #ff9900;
    border-radius: 8px;
    clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
    animation: hex-spin 1.5s linear infinite;
}

.hexagon-spinner:after {
    border-color: #ffcc00;
    animation-delay: -0.75s;
}

@keyframes hex-spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.loading-text {
    margin-top: 20px;
    color: #8b4513;
    font-size: 16px;
    font-weight: bold;
    font-family: 'Arial', sans-serif;
}
        
        /* CSS Reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--site-font, 'Inter'), sans-serif;
            background: var(--site-bg, var(--bg-primary));
            color: var(--text-primary);
            transition: all 0.3s ease;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--honey-yellow);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--honey-dark);
        }

        /* Animations */
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .visible {
            display: block !important;
        }

        .flex {
            display: flex;
        }

        .flex-col {
            flex-direction: column;
        }

        .items-center {
            align-items: center;
        }

        .justify-center {
            justify-content: center;
        }

        .gap-2 { gap: 0.5rem; }
        .gap-4 { gap: 1rem; }
        .gap-6 { gap: 1.5rem; }

        .rounded {
            border-radius: var(--site-radius);
        }

        .shadow {
            box-shadow: 0 4px 20px var(--shadow-color);
        }

        /* Navigation */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--bg-card);
            border-bottom: 2px solid var(--honey-yellow);
            z-index: 1000;
            padding: 0 20px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 10px var(--shadow-color);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            cursor: pointer;
        }

        .logo-icon {
            font-size: 28px;
            color: var(--honey-yellow);
            animation: float 3s ease-in-out infinite;
        }

        .logo-text {
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            font-size: 24px;
            background: linear-gradient(45deg, var(--honey-yellow), var(--hive-orange));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-search {
            flex: 1;
            max-width: 500px;
            margin: 0 20px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 10px 40px 10px 15px;
            background: var(--bg-input);
            border: 1px solid var(--border-color);
            border-radius: 25px;
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--honey-yellow);
            box-shadow: 0 0 0 2px rgba(255, 195, 11, 0.2);
        }

        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        .nav-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .nav-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.3s;
            position: relative;
        }

        .nav-btn:hover {
            background: var(--bg-secondary);
            color: var(--honey-yellow);
        }

        .badge {
            position: absolute;
            top: 2px;
            right: 2px;
            background: var(--flower-pink);
            color: white;
            font-size: 10px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .header-profile-btn, .profile-btn-circle {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            overflow: hidden;
            border: 2px solid var(--honey-yellow);
            cursor: pointer;
            transition: transform 0.3s;
        }

        .header-profile-btn:hover, .profile-btn-circle:hover {
            transform: scale(1.1);
        }

        .profile-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Main Layout */
        .app-container {
            display: flex;
            max-width: 1400px;
            margin: 60px auto 0;
            padding: 20px;
            gap: 20px;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            flex-shrink: 0;
            position: sticky;
            top: 80px;
            height: calc(100vh - 100px);
            overflow-y: auto;
        }

        .sidebar-section {
            background: var(--bg-card);
            border-radius: var(--site-radius);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid var(--honey-yellow);
            object-fit: cover;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .user-avatar:hover {
            transform: scale(1.05);
        }

        .user-details h3 {
            font-size: 16px;
            margin-bottom: 5px;
            cursor: pointer;
        }

        .user-details h3:hover {
            color: var(--honey-yellow);
        }

        .user-details p {
            color: var(--text-secondary);
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .bee-role {
            background: var(--honey-yellow);
            color: var(--bee-black);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: 600;
        }

        .honey-display {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: linear-gradient(45deg, var(--honey-yellow), var(--pollen-gold));
            padding: 15px;
            border-radius: 10px;
            color: var(--bee-black);
            margin-bottom: 20px;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .honey-display:hover {
            transform: translateY(-2px);
        }

        .honey-amount {
            font-size: 24px;
            font-weight: 700;
        }

        .honey-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .nav-menu {
            list-style: none;
            margin-bottom: 20px;
        }

        .nav-item {
            margin-bottom: 5px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            color: var(--text-primary);
            text-decoration: none;
            border-radius: 10px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .nav-link:hover, .nav-link.active {
            background: var(--bg-secondary);
            color: var(--honey-yellow);
        }

        .nav-link i {
            width: 20px;
            text-align: center;
        }

        .create-post-btn {
            width: 100%;
            background: linear-gradient(45deg, var(--honey-yellow), var(--hive-orange));
            color: var(--bee-black);
            border: none;
            padding: 12px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: transform 0.3s;
        }

        .create-post-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 195, 11, 0.3);
        }

        /* Trends Section */
        .trends-section h3 {
            font-size: 16px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .trend-list {
            list-style: none;
        }

        .trend-item {
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.3s;
        }

        .trend-item:hover {
            background: var(--bg-secondary);
            padding-left: 10px;
            border-radius: 5px;
        }

        .trend-item:last-child {
            border-bottom: none;
        }

        .trend-category {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }

        .trend-tag {
            font-weight: 600;
            color: var(--honey-yellow);
        }

        .trend-stats {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 3px;
        }

        /* Hive Communities */
        .hives-section h3 {
            font-size: 16px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .hive-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .hive-card {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: var(--bg-secondary);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .hive-card:hover {
            background: var(--bg-input);
            transform: translateX(5px);
        }

        .hive-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--honey-yellow), var(--hive-orange));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .hive-info h4 {
            font-size: 14px;
            margin-bottom: 2px;
        }

        .hive-members {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            max-width: 600px;
        }

        /* Create Post */
        .create-post {
            background: var(--bg-card);
            border-radius: var(--site-radius);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }

        .post-input {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .user-avatar-small {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--honey-yellow);
            cursor: pointer;
        }

        .post-textarea {
            flex: 1;
            background: var(--bg-input);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 15px;
            color: var(--text-primary);
            font-size: 16px;
            resize: none;
            min-height: 100px;
            font-family: inherit;
            transition: all 0.3s;
        }

        .post-textarea:focus {
            outline: none;
            border-color: var(--honey-yellow);
            box-shadow: 0 0 0 2px rgba(255, 195, 11, 0.2);
        }

        .post-textarea::placeholder {
            color: var(--text-secondary);
        }

        .post-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .action-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            font-size: 14px;
        }

        .action-btn:hover {
            background: var(--bg-secondary);
            color: var(--honey-yellow);
        }

        .pollinate-btn {
            background: linear-gradient(45deg, var(--honey-yellow), var(--hive-orange));
            color: var(--bee-black);
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: transform 0.3s;
            font-size: 14px;
        }

        .pollinate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 195, 11, 0.3);
        }

        /* Posts Feed */
        .feed {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .post-card {
            background: var(--bg-card);
            border-radius: var(--site-radius);
            padding: 20px;
            border: 1px solid var(--border-color);
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
        }

        .post-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px var(--shadow-color);
        }

        .post-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .post-user {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .post-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--honey-yellow);
        }

        .user-name-role {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .user-role-badge {
            background: var(--honey-yellow);
            color: var(--bee-black);
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: 600;
        }

        .post-meta {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .post-options {
            position: relative;
        }

        .options-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .options-btn:hover {
            background: var(--bg-secondary);
            color: var(--honey-yellow);
        }

        .options-menu {
            position: absolute;
            right: 0;
            top: 100%;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 10px 0;
            min-width: 150px;
            z-index: 100;
            box-shadow: 0 4px 20px var(--shadow-color);
            display: none;
        }

        .options-menu.show {
            display: block;
            animation: slideDown 0.2s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .option-item {
            padding: 10px 15px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            text-align: left;
            background: none;
            border: none;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 14px;
        }

        .option-item:hover {
            background: var(--bg-secondary);
            color: var(--honey-yellow);
        }

        .post-content {
            margin-bottom: 15px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .post-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .post-tag {
            color: var(--honey-yellow);
            background: rgba(255, 195, 11, 0.1);
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
        }

        .post-tag:hover {
            background: rgba(255, 195, 11, 0.2);
            transform: translateY(-1px);
        }

        .post-media {
            margin-bottom: 15px;
            border-radius: 10px;
            overflow: hidden;
            max-height: 500px;
        }

        .post-image {
            width: 100%;
            max-height: 400px;
            object-fit: cover;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .post-image:hover {
            transform: scale(1.01);
        }

        .post-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
            flex-wrap: wrap;
            gap: 10px;
        }

        .stat {
            display: flex;
            align-items: center;
            gap: 5px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .post-actions-bar {
            display: flex;
            justify-content: space-around;
            gap: 5px;
        }

        .post-action-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 8px 15px;
            border-radius: 8px;
            transition: all 0.3s;
            flex: 1;
            justify-content: center;
        }

        .post-action-btn:hover {
            background: var(--bg-secondary);
            color: var(--honey-yellow);
        }

        .post-action-btn.liked {
            color: var(--flower-pink);
        }

        .post-action-btn.pollinated {
            color: var(--honey-yellow);
        }

        /* Comments Section */
        .comments-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
            display: none;
        }

        .comments-section.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        .comment {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 10px;
            background: var(--bg-secondary);
        }

        .comment-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--honey-yellow);
        }

        .comment-content {
            flex: 1;
        }

        .comment-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 5px;
        }

        .comment-author {
            font-weight: 600;
            font-size: 14px;
        }

        .comment-time {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .comment-text {
            font-size: 14px;
            line-height: 1.5;
        }

        .comment-actions {
            display: flex;
            gap: 15px;
            margin-top: 5px;
        }

        .comment-action {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 12px;
            transition: color 0.3s;
        }

        .comment-action:hover {
            color: var(--honey-yellow);
        }

        .add-comment {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .comment-input {
            flex: 1;
            background: var(--bg-input);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 10px 15px;
            color: var(--text-primary);
            font-size: 14px;
            font-family: inherit;
        }

        .comment-input:focus {
            outline: none;
            border-color: var(--honey-yellow);
        }

        .comment-submit-btn {
            background: var(--honey-yellow);
            color: var(--bee-black);
            border: none;
            border-radius: 20px;
            padding: 0 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-family: inherit;
        }

        .comment-submit-btn:hover {
            background: var(--honey-dark);
            transform: translateY(-2px);
        }

        /* Right Sidebar */
        .right-sidebar {
            width: 300px;
            flex-shrink: 0;
            position: sticky;
            top: 80px;
            height: calc(100vh - 100px);
            overflow-y: auto;
        }

        /* Who to Follow */
        .follow-section {
            background: var(--bg-card);
            border-radius: var(--site-radius);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
        }

        .refresh-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .refresh-btn:hover {
            color: var(--honey-yellow);
            transform: rotate(180deg);
        }

        .user-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .user-to-follow {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .follow-user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .follow-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            object-fit: cover;
        }

        .follow-details h4 {
            font-size: 14px;
            margin-bottom: 2px;
        }

        .follow-details p {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .follow-btn {
            background: var(--honey-yellow);
            color: var(--bee-black);
            border: none;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .follow-btn:hover {
            background: var(--honey-dark);
            transform: translateY(-1px);
        }

        .follow-btn.following {
            background: var(--bg-input);
            color: var(--text-secondary);
        }

        /* Trending Pollinations */
        .trending-pollinations {
            background: var(--bg-card);
            border-radius: var(--site-radius);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }

        .pollination-chain {
            background: var(--bg-secondary);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .pollination-chain:hover {
            background: var(--bg-input);
            transform: translateX(5px);
        }

        .chain-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .chain-icon {
            color: var(--honey-yellow);
            font-size: 20px;
        }

        .chain-title {
            font-weight: 600;
            font-size: 14px;
        }

        .chain-stats {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Hive Activity */
        .hive-activity {
            background: var(--bg-card);
            border-radius: var(--site-radius);
            padding: 20px;
            border: 1px solid var(--border-color);
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--honey-yellow);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--bee-black);
            font-size: 14px;
        }

        .activity-content {
            flex: 1;
            font-size: 14px;
        }

        .activity-content strong {
            color: var(--honey-yellow);
        }

        .activity-time {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Auth Pages */
        .auth-container {
            display: flex;
            min-height: 100vh;
        }

        .auth-left {
            flex: 1;
            background: linear-gradient(45deg, var(--honey-yellow), var(--hive-orange));
            padding: 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .auth-left::before {
            content: '';
            position: absolute;
            width: 300%;
            height: 300%;
            background: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23ffffff' fill-opacity='0.1' fill-rule='evenodd'/%3E%3C/svg%3E");
            opacity: 0.3;
            animation: spin 20s linear infinite;
        }

        .auth-left h1 {
            font-size: 48px;
            margin-bottom: 20px;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .auth-left p {
            font-size: 18px;
            text-align: center;
            max-width: 500px;
            line-height: 1.6;
            position: relative;
            z-index: 1;
        }

        .bee-animation {
            margin: 40px 0;
            font-size: 100px;
            animation: float 3s ease-in-out infinite;
            position: relative;
            z-index: 1;
        }

        .auth-right {
            flex: 1;
            padding: 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: var(--bg-primary);
        }

        .auth-card {
            width: 100%;
            max-width: 400px;
            background: var(--bg-card);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px var(--shadow-color);
        }

        .auth-card h2 {
            font-size: 28px;
            margin-bottom: 10px;
            color: var(--honey-yellow);
        }

        .auth-card p {
            color: var(--text-secondary);
            margin-bottom: 30px;
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .form-control {
            padding: 12px 15px;
            background: var(--bg-input);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 16px;
            transition: all 0.3s;
            font-family: inherit;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--honey-yellow);
            box-shadow: 0 0 0 2px rgba(255, 195, 11, 0.2);
        }

        .auth-btn {
            background: linear-gradient(45deg, var(--honey-yellow), var(--hive-orange));
            color: var(--bee-black);
            border: none;
            padding: 14px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s;
            margin-top: 10px;
            font-family: inherit;
        }

        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 195, 11, 0.3);
        }

        .auth-divider {
            text-align: center;
            margin: 20px 0;
            color: var(--text-secondary);
            position: relative;
            font-size: 14px;
        }

        .auth-divider:before,
        .auth-divider:after {
            content: '';
            position: absolute;
            top: 50%;
            width: 45%;
            height: 1px;
            background: var(--border-color);
        }

        .auth-divider:before {
            left: 0;
        }

        .auth-divider:after {
            right: 0;
        }

        .social-auth {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .social-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 12px;
            border: 1px solid var(--border-color);
            background: var(--bg-card);
            border-radius: 10px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
            font-size: 14px;
        }

        .social-btn:hover {
            background: var(--bg-secondary);
            border-color: var(--honey-yellow);
        }

        .auth-footer {
            text-align: center;
            margin-top: 30px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .auth-footer a {
            color: var(--honey-yellow);
            text-decoration: none;
            font-weight: 500;
        }

        .auth-footer a:hover {
            text-decoration: underline;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .modal.show {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: var(--site-radius);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease;
            border: 2px solid var(--honey-yellow);
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-size: 20px;
            color: var(--honey-yellow);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
            transition: color 0.3s;
        }

        .modal-close:hover {
            color: var(--honey-yellow);
        }

        .modal-body {
            padding: 20px;
        }

        /* Profile Page */
        .profile-page {
            width: 100%;
            max-width: 1000px;
            margin: 0 auto;
        }

        .profile-header {
            background: var(--bg-card);
            border-radius: var(--site-radius);
            padding: 30px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .profile-banner {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 150px;
            background: linear-gradient(45deg, var(--honey-yellow), var(--hive-orange));
            z-index: 1;
        }

        .profile-info {
            position: relative;
            z-index: 2;
            display: flex;
            align-items: flex-end;
            gap: 30px;
            margin-top: 100px;
        }

        .profile-avatar-large {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 5px solid var(--bg-card);
            object-fit: cover;
            background: var(--bg-card);
            cursor: pointer;
            transition: all 0.3s;
        }

        .profile-avatar-large:hover {
            transform: scale(1.05);
            border-color: var(--honey-yellow);
        }

        .profile-details {
            flex: 1;
        }

        .profile-name {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .profile-username {
            color: var(--text-secondary);
            font-size: 18px;
            margin-bottom: 15px;
        }

        .profile-bio {
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 20px;
            max-width: 600px;
        }

        .profile-stats {
            display: flex;
            gap: 30px;
        }

        .stat-item {
            text-align: center;
            cursor: pointer;
        }

        .stat-number {
            font-size: 20px;
            font-weight: 700;
            color: var(--honey-yellow);
        }

        .stat-label {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .profile-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .profile-btn {
            padding: 10px 20px;
            border-radius: 25px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
        }

        .profile-btn.primary {
            background: var(--honey-yellow);
            color: var(--bee-black);
        }

        .profile-btn.secondary {
            background: var(--bg-input);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .profile-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px var(--shadow-color);
        }

        /* Profile Customization */
        .customization-panel {
            background: var(--bg-card);
            border-radius: var(--site-radius);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }

        .customization-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }

        .customization-tab {
            padding: 10px 20px;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s;
            font-family: inherit;
        }

        .customization-tab.active {
            background: var(--honey-yellow);
            color: var(--bee-black);
        }

        .customization-tab:hover:not(.active) {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .customization-section {
            display: none;
        }

        .customization-section.active {
            display: block;
        }

        .color-picker {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s;
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        .color-option.selected {
            border-color: white;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .css-editor {
            width: 100%;
            min-height: 200px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 15px;
            color: var(--text-primary);
            font-family: 'Source Code Pro', monospace;
            font-size: 14px;
            resize: vertical;
            margin-bottom: 10px;
        }

        .css-editor:focus {
            outline: none;
            border-color: var(--honey-yellow);
        }

        .preview-area {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 20px;
            min-height: 100px;
            margin-bottom: 20px;
        }

        /* Music Player */
        .music-player {
            background: var(--bg-card);
            border-radius: var(--site-radius);
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }

        .player-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .play-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--honey-yellow);
            border: none;
            color: var(--bee-black);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .play-btn:hover {
            transform: scale(1.1);
        }

        .song-info {
            flex: 1;
        }

        .song-title {
            font-weight: 600;
            margin-bottom: 2px;
        }

        .song-artist {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .progress-bar {
            flex: 1;
            height: 4px;
            background: var(--bg-input);
            border-radius: 2px;
            overflow: hidden;
            cursor: pointer;
        }

        .progress {
            height: 100%;
            background: var(--honey-yellow);
            width: 30%;
        }

        /* Bulletin Posts */
        .bulletin-section {
            background: var(--bg-card);
            border-radius: var(--site-radius);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }

        .bulletin-form textarea {
            width: 100%;
            min-height: 100px;
            padding: 15px;
            background: var(--bg-input);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 14px;
            resize: vertical;
            margin-bottom: 10px;
        }

        .bulletin-form textarea:focus {
            outline: none;
            border-color: var(--honey-yellow);
        }

        .bulletin-options {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .bulletin-option {
            background: none;
            border: 1px solid var(--border-color);
            padding: 5px 10px;
            border-radius: 15px;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .bulletin-option:hover {
            border-color: var(--honey-yellow);
            color: var(--honey-yellow);
        }

        .bulletin-option.selected {
            background: var(--honey-yellow);
            color: var(--bee-black);
            border-color: var(--honey-yellow);
        }

        /* Top Friends */
        .friends-section {
            background: var(--bg-card);
            border-radius: var(--site-radius);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }

        .friends-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .friend-card {
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .friend-card:hover {
            transform: translateY(-5px);
        }

        .friend-avatar {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--border-color);
            margin-bottom: 5px;
            transition: all 0.3s;
        }

        .friend-card:hover .friend-avatar {
            border-color: var(--honey-yellow);
        }

        .friend-name {
            font-size: 12px;
            font-weight: 600;
        }

        /* Admin Panel */
        .admin-panel {
            background: var(--bg-card);
            border-radius: var(--site-radius);
            padding: 20px;
            margin-bottom: 20px;
            border: 3px solid var(--flower-pink);
        }

        .admin-panel h3 {
            color: var(--flower-pink);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .admin-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .admin-control {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .admin-control label {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .admin-select {
            padding: 8px 12px;
            background: var(--bg-input);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: inherit;
        }

        .admin-select:focus {
            outline: none;
            border-color: var(--flower-pink);
        }

        .admin-buttons {
            display: flex;
            gap: 10px;
        }

        .admin-btn {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
        }

        .admin-btn.save {
            background: var(--flower-pink);
            color: white;
        }

        .admin-btn.reset {
            background: var(--bg-input);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .admin-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px var(--shadow-color);
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .right-sidebar {
                display: none;
            }
        }

        @media (max-width: 992px) {
            .sidebar {
                display: none;
            }
            
            .app-container {
                padding: 20px 10px;
            }
            
            .profile-info {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }
            
            .friends-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .auth-container {
                flex-direction: column;
            }
            
            .auth-left {
                padding: 20px;
                min-height: 300px;
            }
            
            .auth-left h1 {
                font-size: 32px;
            }
            
            .bee-animation {
                font-size: 60px;
                margin: 20px 0;
            }
            
            .nav-search {
                display: none;
            }
            
            .post-actions-bar {
                flex-wrap: wrap;
            }
            
            .post-action-btn {
                padding: 6px 10px;
                font-size: 12px;
            }
        }

        @media (max-width: 576px) {
            .navbar {
                padding: 0 10px;
            }
            
            .logo-text {
                font-size: 20px;
            }
            
            .app-container {
                margin-top: 60px;
                padding: 10px;
            }
            
            .create-post,
            .post-card {
                padding: 15px;
            }
            
            .modal-content {
                width: 95%;
                padding: 10px;
            }
            
            .friends-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Active states for interactions */
        .clicked {
            animation: clickEffect 0.3s ease;
        }

        @keyframes clickEffect {
            0% { transform: scale(1); }
            50% { transform: scale(0.95); }
            100% { transform: scale(1); }
        }

        /* Notification Toast */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--honey-yellow);
            color: var(--bee-black);
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 20px var(--shadow-color);
            z-index: 3000;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            max-width: 300px;
            font-weight: 600;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        /* Loading Spinner */
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--honey-yellow);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
    
        /* File input hidden - triggered by button */
        .file-input-wrapper {
            position: relative;
            display: inline-block;
        }
        .file-input-wrapper .file-input,
        input.file-input[type="file"] {
            position: absolute;
            width: 0;
            height: 0;
            opacity: 0;
            overflow: hidden;
            pointer-events: none;
        }

        /* Inline compose area */
        .inline-compose {
            background: var(--bg-card);
            border-radius: var(--site-radius, 15px);
            padding: 15px;
            margin-bottom: 20px;
        }
        .inline-compose .compose-top {
            display: flex;
            gap: 12px;
        }
        .inline-compose .compose-textarea {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--text-primary);
            resize: none;
            font-size: 16px;
            font-family: inherit;
            min-height: 28px;
            max-height: 200px;
            outline: none;
            padding: 8px 0;
            line-height: 1.5;
        }
        .inline-compose .compose-textarea::placeholder {
            color: var(--text-secondary);
        }
        .inline-compose .compose-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 10px;
            border-top: 1px solid var(--border-color);
            margin-top: 10px;
        }
        .inline-compose .compose-actions.hidden {
            display: none;
        }
        .inline-compose .compose-btns {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
        }
        .inline-compose .compose-btns button {
            background: none;
            border: none;
            color: var(--honey-yellow);
            cursor: pointer;
            padding: 6px 8px;
            border-radius: 50%;
            font-size: 15px;
            transition: background 0.2s;
        }
        .inline-compose .compose-btns button:hover {
            background: rgba(255, 195, 11, 0.15);
        }
        .inline-compose .compose-btns .gif-label {
            font-size: 12px;
            font-weight: 800;
            border: 1.5px solid var(--honey-yellow);
            border-radius: 4px;
            padding: 1px 5px;
            line-height: 1.3;
        }
        .inline-compose .compose-submit {
            background: var(--honey-yellow);
            color: #000;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            transition: opacity 0.2s;
        }
        .inline-compose .compose-submit:hover {
            opacity: 0.9;
        }
        .inline-compose .compose-submit:disabled {
            opacity: 0.5;
            cursor: default;
        }
        .inline-compose .media-preview-inline {
            margin-top: 10px;
            display: none;
        }

</style>
</head>
<body>
    <!-- Loading Overlay -->
<div id="loadingOverlay" style="display: none;">
    <div class="hexagon-spinner"></div>
    <div class="loading-text">Connecting to Hive...</div>
</div>
    <!-- Authentication Screen -->
    <div id="authScreen" class="auth-container">
        <div class="auth-left">
            <div class="bee-animation"></div>
            <h1>Welcome to Polleneer</h1>
            <p>Where ideas take flight! Join our hive and connect with friends, share thoughts, and customize your space like never before.</p>
            <div style="margin-top: 40px; font-size: 14px; opacity: 0.8;">
                <p>"The world is buzzing with possibilities. Let's make some honey together!"</p>
            </div>
        </div>
        <div class="auth-right">
            <div class="auth-card">
                <h2>Enter the Hive</h2>
                <p>Sign in to start connecting</p>
                
                <form class="auth-form" id="loginForm">
                    <div class="form-group">
                        <label for="email">Email or Username</label>
                        <input type="text" id="email" class="form-control" placeholder="you@example.com" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" class="form-control" placeholder="Enter your password" required>
                    </div>
                    
                    <div style="text-align: right; margin-bottom: 10px;">
                        <a href="#" id="forgotPassword" style="color: var(--honey-yellow); font-size: 14px; text-decoration: none;">Forgot password?</a>
                    </div>
                    
                    <button type="submit" class="auth-btn">
                        <i class="fas fa-sign-in-alt"></i> Sign In
                    </button>
                </form>
                
                <div class="auth-divider">or continue with</div>
                
                <div class="social-auth">
                    <button class="social-btn" id="googleLogin">
                        <i class="fab fa-google" style="color: #DB4437;"></i>
                        Continue with Google
                    </button>
                    <button class="social-btn" id="githubLogin">
                        <i class="fab fa-github"></i>
                        Continue with GitHub
                    </button>
                </div>
                
                <div class="auth-footer">
                    New to the hive? <a href="#" id="showRegister">Create an account</a>
                </div>
            </div>
            
            <!-- Register Form -->
            <div class="auth-card hidden" id="registerCard">
                <h2>Join the Hive</h2>
                <p>Create your account to start your journey</p>
                
                <form class="auth-form" id="registerForm">
                    <div class="form-group">
                        <label for="regUsername">Username</label>
                        <input type="text" id="regUsername" class="form-control" placeholder="Choose a username" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="regEmail">Email</label>
                        <input type="email" id="regEmail" class="form-control" placeholder="you@example.com" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="regPassword">Password</label>
                        <input type="password" id="regPassword" class="form-control" placeholder="Create a strong password" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="regConfirmPassword">Confirm Password</label>
                        <input type="password" id="regConfirmPassword" class="form-control" placeholder="Confirm your password" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="regBeeRole">Choose Your Bee Role</label>
                        <select id="regBeeRole" class="form-control" required>
                            <option value="">Select your role</option>
                            <option value="queen">Queen Bee (Leader)</option>
                            <option value="worker">Worker Bee (Contributor)</option>
                            <option value="drone">Drone (Explorer)</option>
                            <option value="honeybee">Honey Bee (Creator)</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="auth-btn">
                        <i class="fas fa-user-plus"></i> Create Account
                    </button>
                </form>
                
                <div class="auth-footer">
                    Already have an account? <a href="#" id="showLogin">Sign in</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="appScreen" class="hidden">
        <!-- Navigation -->
        <nav class="navbar">
            <div class="logo" onclick="goToHome()">
                <div class="logo-icon"></div>
                <div class="logo-text">Polleneer</div>
            </div>
            
            <div class="nav-search">
                <input type="text" class="search-input" placeholder="Search Polleneer..." id="searchInput">
                <i class="fas fa-search search-icon"></i>
            </div>
            
            <div class="nav-actions">
                <button class="nav-btn" id="themeToggle" title="Toggle theme">
                    <i class="fas fa-moon"></i>
                </button>
                
                <button class="nav-btn" id="notificationsBtn" title="Notifications">
                    <i class="fas fa-bell"></i>
                    <span class="badge" id="notificationBadge">3</span>
                </button>
                
                <button class="nav-btn" id="messagesBtn" title="Messages">
                    <i class="fas fa-envelope"></i>
                    <span class="badge" id="messageBadge">2</span>
                </button>
                
                <button class="nav-btn" id="createPostBtn" title="Create post">
                    <i class="fas fa-feather-alt"></i>
                </button>
                
                <button class="nav-btn" id="adminPanelBtn" title="Admin Panel" style="display: none;">
                    <i class="fas fa-crown"></i>
                </button>
                
                <div class="profile-btn-circle" id="profileMenuBtn">
                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=BeeKeeper" alt="Profile" class="profile-img" id="currentUserAvatar">
                </div>
            </div>
        </nav>

        <!-- Main Layout -->
        <div class="app-container">
            <!-- Left Sidebar -->
            <aside class="sidebar">
                <div class="sidebar-section">
                    <div class="user-info" onclick="goToProfile()">
                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=BeeKeeper" alt="Profile" class="user-avatar" id="sidebarUserAvatar">
                        <div class="user-details">
                            <h3 id="sidebarUserName">MichaelTheGreat</h3>
                            <p><span class="bee-role" id="sidebarUserRole">Queen Bee</span>  <span id="sidebarHoneyPoints">1,247</span></p>
                        </div>
                    </div>
                    
                    <div class="honey-display" onclick="showHoneyShop()">
                        <div>
                            <div class="honey-amount" id="honeyPoints">1,247</div>
                            <div class="honey-label">Honey Points</div>
                        </div>
                        <i class="fas fa-coins" style="font-size: 32px;"></i>
                    </div>
                    
                    <ul class="nav-menu">
                        <li class="nav-item">
                            <a class="nav-link active" onclick="goToHome()">
                                <i class="fas fa-home"></i>
                                <span>Home</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" onclick="goToExplore()">
                                <i class="fas fa-hashtag"></i>
                                <span>Explore</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" onclick="showNotifications()">
                                <i class="fas fa-bell"></i>
                                <span>Notifications</span>
                                <span class="badge" style="margin-left: auto;" id="sidebarNotificationBadge">3</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" onclick="showMessages()">
                                <i class="fas fa-envelope"></i>
                                <span>Messages</span>
                                <span class="badge" style="margin-left: auto;" id="sidebarMessageBadge">2</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" onclick="goToBookmarks()">
                                <i class="fas fa-bookmark"></i>
                                <span>Bookmarks</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" onclick="goToCommunities()">
                                <i class="fas fa-users"></i>
                                <span>Communities</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" onclick="goToProfile()">
                                <i class="fas fa-user"></i>
                                <span>Profile</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" onclick="showSettings()">
                                <i class="fas fa-cog"></i>
                                <span>Settings</span>
                            </a>
                        </li>
                    </ul>
                    
                    <button class="create-post-btn" onclick="showCreatePostModal()">
                        <i class="fas fa-feather-alt"></i>
                        Create Buzz
                    </button>
                </div>
                
                <div class="sidebar-section trends-section">
                    <h3><i class="fas fa-fire"></i> Trending Now</h3>
                    <ul class="trend-list" id="trendingList">
                        <!-- Trends will be loaded here -->
                    </ul>
                </div>
                
                <div class="sidebar-section hives-section">
                    <h3><i class="fas fa-archive"></i> Your Hives</h3>
                    <div class="hive-list" id="hiveList">
                        <!-- Hives will be loaded here -->
                    </div>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="main-content" id="mainContent">
                <!-- Content will be loaded dynamically -->
                <div class="feed" id="homeFeed">
                    <!-- Posts will be loaded here -->
                </div>
            </main>

            <!-- Right Sidebar -->
            <aside class="right-sidebar">
                <!-- Who to Follow -->
                <div class="follow-section">
                    <div class="section-header">
                        <h3 class="section-title">Who to Follow</h3>
                        <button class="refresh-btn" onclick="refreshSuggestions()">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                    
                    <div class="user-list" id="suggestedUsers">
                        <!-- Suggested users will be loaded here -->
                    </div>
                </div>
                
                <!-- Trending Pollinations -->
                <div class="trending-pollinations">
                    <div class="section-header">
                        <h3 class="section-title">Trending Pollinations</h3>
                    </div>
                    <div id="trendingPollinations">
                        <!-- Trending pollinations will be loaded here -->
                    </div>
                </div>
                
                <!-- Hive Activity -->
                <div class="hive-activity">
                    <div class="section-header">
                        <h3 class="section-title">Hive Activity</h3>
                    </div>
                    <div id="activityFeed">
                        <!-- Activity will be loaded here -->
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal" id="createPostModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create Buzz</h3>
                <button class="modal-close" onclick="closeModal('createPostModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="post-input" style="border: none; padding: 0;">
                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=BeeKeeper" alt="Profile" class="user-avatar-small" id="modalUserAvatar">
                    <textarea class="post-textarea" id="postContent" placeholder="What's buzzing in your mind? Start pollinating ideas..." style="min-height: 150px;"></textarea>
                </div>

                <div style="margin: 20px 0;">
                    <div style="display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap;">
                        <div class="file-input-wrapper">
                            <input type="file" class="file-input" id="mediaUpload" accept="image/*,video/*" multiple onchange="handleMediaUpload(event)">
                            <button class="action-btn" onclick="document.getElementById('mediaUpload').click()">
                                <i class="fas fa-image"></i>
                                <span>Media</span>
                            </button>
                        </div>

                        <button class="action-btn" onclick="showGifPicker()">
                            <span style="font-weight:bold;font-size:12px;border:1.5px solid currentColor;border-radius:4px;padding:0 4px;line-height:1.4;">GIF</span>
                            <span>GIF</span>
                        </button>

                        <button class="action-btn" onclick="showStickerPicker()">
                            <i class="fas fa-note-sticky"></i>
                            <span>Stickers</span>
                        </button>

                        <button class="action-btn" onclick="showEmojiPicker()">
                            <i class="fas fa-face-smile"></i>
                            <span>Emoji</span>
                        </button>

                        <button class="action-btn" onclick="showLinkModal()">
                            <i class="fas fa-link"></i>
                            <span>Link</span>
                        </button>

                        <button class="action-btn" onclick="createPoll()">
                            <i class="fas fa-poll"></i>
                            <span>Poll</span>
                        </button>

                        <button class="action-btn" onclick="showLocationPicker()">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>Location</span>
                        </button>

                        <button class="action-btn" onclick="showSchedulePost()">
                            <i class="fas fa-clock"></i>
                            <span>Schedule</span>
                        </button>

                        <div class="hashtag-input-container">
                            <input type="text" class="hashtag-input" id="hashtagInput" placeholder="#hashtag" onkeypress="if(event.key === 'Enter') addTagFromInput()">
                        </div>
                    </div>

                    <div style="margin-bottom: 15px;" id="postTagsContainer">
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">Tags</label>
                        <div style="display: flex; flex-wrap: wrap; gap: 5px;" id="postTags"></div>
                    </div>

                    <div style="margin-bottom: 20px;" id="postPollContainer" class="hidden">
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">Poll Options</label>
                        <div id="pollOptions"></div>
                        <button class="action-btn" onclick="addPollOption()" style="margin-top: 10px;">
                            <i class="fas fa-plus"></i>
                            <span>Add Option</span>
                        </button>
                    </div>

                    <div style="margin-bottom: 20px;" id="postMediaContainer" class="hidden">
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">Media Preview</label>
                        <div id="mediaPreview"></div>
                    </div>
                </div>

                <div style="display: flex; justify-content: flex-end; gap: 10px;">
                    <button class="action-btn" onclick="closeModal('createPostModal')">
                        Cancel
                    </button>
                    <button class="pollinate-btn" onclick="submitPost()">
                        <i class="fas fa-feather-alt"></i>
                        Post Buzz
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Link Modal -->
    <div class="modal" id="linkModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Link</h3>
                <button class="modal-close" onclick="closeModal('linkModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="linkUrl">URL</label>
                    <input type="url" id="linkUrl" class="form-control" placeholder="https://example.com">
                </div>
                <div class="form-group">
                    <label for="linkText">Display Text (optional)</label>
                    <input type="text" id="linkText" class="form-control" placeholder="Check this out!">
                </div>
                <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
                    <button class="action-btn" onclick="closeModal('linkModal')">
                        Cancel
                    </button>
                    <button class="pollinate-btn" onclick="addLinkFromModal()">
                        <i class="fas fa-link"></i>
                        Add Link
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bio Edit Modal -->
    <div class="modal" id="bioModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Bio</h3>
                <button class="modal-close" onclick="closeModal('bioModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="bioText">Your Bio</label>
                    <textarea id="bioText" class="form-control" rows="4" placeholder="Tell us about yourself..."></textarea>
                </div>
                <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
                    <button class="action-btn" onclick="closeModal('bioModal')">
                        Cancel
                    </button>
                    <button class="pollinate-btn" onclick="saveBio()">
                        <i class="fas fa-save"></i>
                        Save Bio
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Avatar Upload Modal -->
    <div class="modal" id="avatarModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Change Avatar</h3>
                <button class="modal-close" onclick="closeModal('avatarModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 20px;">
                    <div id="avatarPreview" style="width: 150px; height: 150px; border-radius: 50%; margin: 0 auto 20px; border: 3px solid var(--honey-yellow); overflow: hidden;">
                        <img id="avatarPreviewImg" src="" alt="Preview" style="width: 100%; height: 100%; object-fit: cover;">
                    </div>
                    <div class="file-input-wrapper" style="display: inline-block;">
                        <input type="file" class="file-input" id="avatarUpload" accept="image/*" onchange="previewAvatar(event)">
                        <button class="action-btn" onclick="document.getElementById('avatarUpload').click()">
                            <i class="fas fa-upload"></i>
                            <span>Choose Image</span>
                        </button>
                    </div>
                </div>
                <div style="color: var(--text-secondary); font-size: 12px; text-align: center; margin-bottom: 20px;">
                    Supported: JPG, PNG, GIF  Max 5MB
                </div>
                <div style="display: flex; justify-content: flex-end; gap: 10px;">
                    <button class="action-btn" onclick="closeModal('avatarModal')">
                        Cancel
                    </button>
                    <button class="pollinate-btn" onclick="saveAvatar()">
                        <i class="fas fa-save"></i>
                        Save Avatar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Menu Modal -->
    <div class="modal" id="profileMenuModal">
        <div class="modal-content">
            <div class="modal-body">
                <div style="text-align: center; padding: 20px 0;">
                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=BeeKeeper" alt="Profile" id="menuUserAvatar" style="width: 80px; height: 80px; border-radius: 50%; border: 3px solid var(--honey-yellow); margin-bottom: 15px; cursor: pointer;" onclick="goToProfile()">
                    <h3 style="margin-bottom: 5px;" id="menuUserName">MichaelTheGreat</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;" id="menuUserRole">@michaelthegreat  Queen Bee</p>
                </div>
                
                <div style="display: flex; justify-content: space-around; margin-bottom: 20px; text-align: center;">
                    <div onclick="goToProfile('following')" style="cursor: pointer;">
                        <div style="font-size: 20px; font-weight: 700;" id="menuFollowingCount">247</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">Following</div>
                    </div>
                    <div onclick="goToProfile('followers')" style="cursor: pointer;">
                        <div style="font-size: 20px; font-weight: 700;" id="menuFollowersCount">1.2k</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">Followers</div>
                    </div>
                    <div onclick="showHoneyShop()" style="cursor: pointer;">
                        <div style="font-size: 20px; font-weight: 700;" id="menuHoneyCount">1,247</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">Honey</div>
                    </div>
                </div>
                
                <div style="border-top: 1px solid var(--border-color); padding-top: 15px;">
                    <button class="option-item" onclick="goToProfile()">
                        <i class="fas fa-user"></i>
                        <span>Profile</span>
                    </button>
                    <button class="option-item" onclick="showCustomization()">
                        <i class="fas fa-paint-brush"></i>
                        <span>Customize Profile</span>
                    </button>
                    <button class="option-item" onclick="showSettings()">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                    </button>
                    <button class="option-item" onclick="toggleTheme()">
                        <i class="fas fa-moon"></i>
                        <span>Theme</span>
                    </button>
                    <button class="option-item" onclick="showHelp()">
                        <i class="fas fa-question-circle"></i>
                        <span>Help Center</span>
                    </button>
                    <button class="option-item" style="color: #ff6b6b;" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Log out</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Customization Modal -->
    <div class="modal" id="customizationModal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3>Customize Your Profile</h3>
                <button class="modal-close" onclick="closeModal('customizationModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="customization-tabs">
                    <button class="customization-tab active" onclick="switchCustomizationTab('colors')">Colors</button>
                    <button class="customization-tab" onclick="switchCustomizationTab('background')">Background</button>
                    <button class="customization-tab" onclick="switchCustomizationTab('css')">CSS Editor</button>
                    <button class="customization-tab" onclick="switchCustomizationTab('music')">Music Player</button>
                </div>
                
                <div class="customization-section active" id="colorsSection">
                    <h4 style="margin-bottom: 15px;">Profile Colors</h4>
                    <div class="color-picker">
                        <div class="color-option" style="background: #FFC30B;" onclick="selectColor('#FFC30B')" data-color="#FFC30B"></div>
                        <div class="color-option" style="background: #FF69B4;" onclick="selectColor('#FF69B4')" data-color="#FF69B4"></div>
                        <div class="color-option" style="background: #228B22;" onclick="selectColor('#228B22')" data-color="#228B22"></div>
                        <div class="color-option" style="background: #87CEEB;" onclick="selectColor('#87CEEB')" data-color="#87CEEB"></div>
                        <div class="color-option" style="background: #8B4513;" onclick="selectColor('#8B4513')" data-color="#8B4513"></div>
                        <div class="color-option" style="background: #FF8C00;" onclick="selectColor('#FF8C00')" data-color="#FF8C00"></div>
                        <div class="color-option" style="background: #9370DB;" onclick="selectColor('#9370DB')" data-color="#9370DB"></div>
                        <div class="color-option" style="background: #20B2AA;" onclick="selectColor('#20B2AA')" data-color="#20B2AA"></div>
                    </div>
                    <div style="margin-top: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">Custom Color</label>
                        <input type="color" id="customColorPicker" style="width: 100%; height: 40px; border-radius: 8px; border: none; cursor: pointer;" onchange="selectColor(this.value)">
                    </div>
                </div>
                
                <div class="customization-section" id="backgroundSection">
                    <h4 style="margin-bottom: 15px;">Profile Background</h4>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 15px;">
                        <button class="action-btn" onclick="setBackground('gradient')">
                            <i class="fas fa-gradient"></i>
                            <span>Gradient</span>
                        </button>
                        <button class="action-btn" onclick="setBackground('pattern')">
                            <i class="fas fa-th-large"></i>
                            <span>Pattern</span>
                        </button>
                        <button class="action-btn" onclick="setBackground('image')">
                            <i class="fas fa-image"></i>
                            <span>Image</span>
                        </button>
                        <button class="action-btn" onclick="setBackground('solid')">
                            <i class="fas fa-square"></i>
                            <span>Solid Color</span>
                        </button>
                    </div>
                    <div id="backgroundOptions"></div>
                </div>
                
                <div class="customization-section" id="cssSection">
                    <h4 style="margin-bottom: 15px;">Custom CSS Editor</h4>
                    <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 15px;">
                        Add custom CSS to style your profile. This is for advanced users.
                    </p>
                    <textarea class="css-editor" id="customCSSEditor" placeholder="/* Add your custom CSS here */
.profile-header {
    background: linear-gradient(45deg, #FFC30B, #FF8C00);
    border-radius: 20px;
}

.profile-avatar-large {
    border: 5px solid #FFC30B;
    box-shadow: 0 0 20px rgba(255, 195, 11, 0.5);
}"></textarea>
                    <div class="preview-area" id="cssPreview">
                        <p>CSS Preview Area</p>
                    </div>
                </div>
                
                <div class="customization-section" id="musicSection">
                    <h4 style="margin-bottom: 15px;">Music Player</h4>
                    <div class="music-player" id="musicPlayerDemo">
                        <div class="player-controls">
                            <button class="play-btn" id="demoPlayBtn">
                                <i class="fas fa-play"></i>
                            </button>
                            <div class="song-info">
                                <div class="song-title" id="demoSongTitle">Selected Song</div>
                                <div class="song-artist" id="demoSongArtist">Artist</div>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">Add Music URL</label>
                        <input type="text" class="form-control" id="musicUrl" placeholder="Enter YouTube, SoundCloud, or Spotify URL">
                        <button class="action-btn" onclick="testMusic()" style="margin-top: 10px; width: 100%;">
                            <i class="fas fa-music"></i>
                            <span>Test Music</span>
                        </button>
                    </div>
                </div>
                
                <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
                    <button class="action-btn" onclick="resetCustomization()">
                        Reset
                    </button>
                    <button class="pollinate-btn" onclick="saveCustomization()">
                        <i class="fas fa-save"></i>
                        Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Panel Modal -->
    <div class="modal" id="adminPanelModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-crown"></i> Admin Panel</h3>
                <button class="modal-close" onclick="closeModal('adminPanelModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="admin-panel">
                    <h3><i class="fas fa-cog"></i> Site Configuration</h3>
                    
                    <div class="admin-controls">
                        <div class="admin-control">
                            <label>Site Theme</label>
                            <select class="admin-select" id="adminSiteTheme">
                                <option value="dark">Dark</option>
                                <option value="light">Light</option>
                                <option value="auto">Auto</option>
                            </select>
                        </div>
                        
                        <div class="admin-control">
                            <label>Site Style</label>
                            <select class="admin-select" id="adminSiteStyle">
                                <option value="default">Default</option>
                                <option value="rounded">Rounded</option>
                                <option value="sharp">Sharp</option>
                                <option value="honeycomb">Honeycomb</option>
                            </select>
                        </div>
                        
                        <div class="admin-control">
                            <label>Primary Color</label>
                            <input type="color" class="admin-select" id="adminPrimaryColor" value="#FFC30B">
                        </div>
                        
                        <div class="admin-control">
                            <label>Background Color</label>
                            <input type="color" class="admin-select" id="adminBgColor" value="#0F0F0F">
                        </div>
                        
                        <div class="admin-control">
                            <label>Font Family</label>
                            <select class="admin-select" id="adminFontFamily">
                                <option value="Inter">Inter</option>
                                <option value="Poppins">Poppins</option>
                                <option value="Arial">Arial</option>
                                <option value="Georgia">Georgia</option>
                            </select>
                        </div>
                        
                        <div class="admin-control">
                            <label>Border Radius</label>
                            <select class="admin-select" id="adminBorderRadius">
                                <option value="5">Small (5px)</option>
                                <option value="15" selected>Medium (15px)</option>
                                <option value="25">Large (25px)</option>
                                <option value="50">Extra Large (50px)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="admin-buttons">
                        <button class="admin-btn reset" onclick="resetAdminSettings()">
                            Reset to Default
                        </button>
                        <button class="admin-btn save" onclick="saveAdminSettings()">
                            <i class="fas fa-save"></i>
                            Save Settings
                        </button>
                    </div>
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: rgba(255, 105, 180, 0.1); border-radius: 10px; border: 1px solid var(--flower-pink);">
                    <h4 style="color: var(--flower-pink); margin-bottom: 10px;"><i class="fas fa-info-circle"></i> Admin Information</h4>
                    <p style="font-size: 14px; color: var(--text-secondary);">
                        <strong>Username:</strong> admin<br>
                        <strong>Password:</strong> polleneer2024<br>
                        <strong>Permissions:</strong> Full site customization, user management, content moderation
                    </p>
                    <button class="action-btn" onclick="copyAdminCredentials()" style="margin-top: 10px; width: 100%;">
                        <i class="fas fa-copy"></i>
                        Copy Credentials
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast" id="notificationToast"></div>

    <!-- JavaScript -->
    <script>
    /* ===== LOADING HELPER FUNCTIONS ===== */
    function showLoading(message = 'Connecting to Hive...') {
        const overlay = document.getElementById('loadingOverlay');
        const text = overlay.querySelector('.loading-text');
        if (overlay && text) {
            text.textContent = message;
            overlay.style.display = 'flex';
        }
    }

    function hideLoading() {
        const overlay = document.getElementById('loadingOverlay');
        if (overlay) {
            overlay.style.display = 'none';
        }
    }

    // Show loading when page loads
    window.addEventListener('load', () => {
        setTimeout(() => {
            hideLoading();
        }, 1000);
    });

    // Show loading immediately when page starts loading
    document.addEventListener('DOMContentLoaded', () => {
        showLoading('Loading Polleneer...');
    });

    /* ===== API SERVICE ===== */
    const apiService = {
        baseUrl: 'https://polleneer-dbkzq.ondigitalocean.app/api',
        
        async request(endpoint, options = {}) {
            showLoading('Connecting to API...');
            
            const url = `${this.baseUrl}${endpoint}`;
            const defaultOptions = {
                headers: {
                    'Content-Type': 'application/json',
                },
            };
            
            const config = { ...defaultOptions, ...options };
            
            try {
                const response = await fetch(url, config);
                
                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error('API Request failed:', error);
                throw error;
            } finally {
                hideLoading();
            }
        },
        
        async get(endpoint) {
            return this.request(endpoint, { method: 'GET' });
        },
        
        async post(endpoint, data) {
            return this.request(endpoint, {
                method: 'POST',
                body: JSON.stringify(data),
            });
        },
        
        async put(endpoint, data) {
            return this.request(endpoint, {
                method: 'PUT',
                body: JSON.stringify(data),
            });
        },
        
        async delete(endpoint) {
            return this.request(endpoint, { method: 'DELETE' });
        }
    };
        
        // ============================================
        // GLOBAL VARIABLES AND INITIALIZATION
        // ============================================
        let currentUser = null;
        let isAdmin = false;
        let posts = [];
        let users = [];
        let notifications = [];
        let messages = [];
        let currentPage = 'home';
        let customization = {
            colors: {},
            background: '',
            css: '',
            music: ''
        };
        let comments = {};
        let selectedBulletinOption = 'public';
        let selectedProfileTab = 'posts';
        let selectedColor = '#FFC30B';
        let selectedBackground = 'gradient';

        // Admin account
        const ADMIN_CREDENTIALS = {
            username: 'admin',
            password: 'polleneer2024',
            email: 'admin@polleneer.com',
            role: 'admin',
            honeyPoints: 9999
        };

        // Sample data
        const SAMPLE_USERS = [
            {
                id: 1,
                username: 'MichaelTheGreat',
                displayName: 'MichaelTheGreat',
                email: 'michael@example.com',
                role: 'queen',
                bio: 'Bee Keeper of Polleneer. Building the future of social media.',
                honeyPoints: 1247,
                followers: 1200,
                following: 247,
                avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=BeeKeeper',
                joined: '2024-01-01',
                customization: {}
            },
            {
                id: 2,
                username: 'FloraCreative',
                displayName: 'FloraCreative',
                role: 'worker',
                bio: 'Digital artist and garden enthusiast. Love creating beautiful things.',
                honeyPoints: 892,
                followers: 843,
                following: 156,
                avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=FloraCreative'
            },
            {
                id: 3,
                username: 'TechWorker',
                displayName: 'TechWorker',
                role: 'drone',
                bio: 'Exploring the intersection of technology and nature.',
                honeyPoints: 567,
                followers: 432,
                following: 189,
                avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=TechWorker'
            },
            {
                id: 4,
                username: 'ScienceBee',
                displayName: 'ScienceBee',
                role: 'honeybee',
                bio: 'Researcher and educator. Passionate about science communication.',
                honeyPoints: 1123,
                followers: 987,
                following: 210,
                avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=ScienceBee'
            }
        ];

        const SAMPLE_POSTS = [
            {
                id: 1,
                userId: 2,
                content: "Just finished designing a new garden layout that incorporates both native plants and edible crops. The cross-pollination between biodiversity and food security is fascinating! ",
                tags: ['#Permaculture', '#UrbanFarming', '#BeeFriendly'],
                media: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
                likes: 127,
                comments: 18,
                pollinations: 42,
                views: 2400,
                createdAt: '2 hours ago',
                isLiked: false,
                isPollinated: true
            },
            {
                id: 2,
                userId: 3,
                content: "Working on a new algorithm that mimics bee colony optimization for solving complex routing problems. Nature's solutions are often the most elegant! \n\nBuilding on @FloraCreative's garden design principles.",
                tags: ['#SwarmIntelligence', '#Algorithms', '#NatureInspired', '#CrossPollination'],
                likes: 89,
                comments: 24,
                pollinations: 31,
                views: 1800,
                createdAt: '4 hours ago',
                isLiked: true,
                isPollinated: false
            },
            {
                id: 3,
                userId: 1,
                content: "Greetings, fellow pollinators! \n\nThe hive has reached 10,000 active members today! Watching ideas cross-pollinate across disciplines has been incredible.\n\nRemember: Every idea shared here creates ripples throughout our network. Keep pollinating, keep connecting, and let's build something beautiful together.",
                tags: ['#Polleneer', '#HiveGrowth', '#CrossPollination', '#BeeTheChange'],
                media: 'https://images.unsplash.com/photo-1587923623987-c7e4083beb23?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
                likes: 521,
                comments: 89,
                pollinations: 247,
                views: 5200,
                createdAt: '6 hours ago',
                isLiked: true,
                isPollinated: true
            }
        ];

        const TRENDING_TOPICS = [
            { tag: '#WeekendVibes', category: 'Lifestyle', posts: '12.4k' },
            { tag: '#NewMusicFriday', category: 'Music', posts: '8.7k' },
            { tag: '#Gaming', category: 'Gaming', posts: '23.1k' },
            { tag: '#Foodie', category: 'Food', posts: '15.6k' },
            { tag: '#Travel', category: 'Travel', posts: '9.3k' },
            { tag: '#Fitness', category: 'Health', posts: '11.2k' }
        ];

        // Sample comments
        const SAMPLE_COMMENTS = {
            1: [
                { id: 1, userId: 3, text: 'This garden design is amazing! Could you share more details about the native plants?', createdAt: '1h ago' },
                { id: 2, userId: 4, text: 'Love the integration of food production and biodiversity! ', createdAt: '45m ago' },
                { id: 3, userId: 1, text: 'Great work! This is exactly what we need more of!', createdAt: '30m ago' }
            ],
            2: [
                { id: 4, userId: 2, text: 'Fascinating! Would love to see the code when ready.', createdAt: '2h ago' },
                { id: 5, userId: 1, text: 'Nature-inspired algorithms are the future!', createdAt: '1h ago' }
            ],
            3: [
                { id: 6, userId: 2, text: 'Congratulations on this milestone! ', createdAt: '5h ago' },
                { id: 7, userId: 3, text: '10,000 members! That\'s incredible growth!', createdAt: '4h ago' },
                { id: 8, userId: 4, text: 'Here\'s to the next 10,000! ', createdAt: '3h ago' }
            ]
        };

                // ============================================
        // CUSTOMIZATION FUNCTION
        // ============================================
        function applyCustomization() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || sessionStorage.getItem('currentUser'));
            if (currentUser && currentUser.profileColor) {
                document.documentElement.style.setProperty('--primary', currentUser.profileColor);
            }
            
            const siteStyle = localStorage.getItem('siteStyle') || 'default';
            document.body.setAttribute('data-site-style', siteStyle);
            
            console.log('Customization applied');
        }

        // ============================================
        // INITIALIZATION FUNCTIONS
        // ============================================
        function initializeApp() {
            const savedTheme = localStorage.getItem('polleneer_theme') || 'dark';
            const savedStyle = localStorage.getItem('polleneer_style') || 'default';
            document.documentElement.setAttribute('data-theme', savedTheme);
            document.documentElement.setAttribute('data-site-style', savedStyle);
            updateThemeIcon(savedTheme);
            
            comments = { ...SAMPLE_COMMENTS };
            
            const savedCustomization = localStorage.getItem('polleneer_customization');
            if (savedCustomization) {
                customization = JSON.parse(savedCustomization);
                applyCustomization();  // Now this will work!
            }
        }
        
        // ============================================
        // INITIALIZATION FUNCTIONS
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            loadSampleData();
            
            const savedUser = localStorage.getItem('polleneer_user');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                if (currentUser.username === 'admin') {
                    isAdmin = true;
                    document.getElementById('adminPanelBtn').style.display = 'block';
                }
                showApp();
                updateUIForUser();
                loadHomeFeed();
            } else {
                showAuth();
            }
        });

        function setupEventListeners() {
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('registerForm').addEventListener('submit', handleRegister);
            document.getElementById('showRegister').addEventListener('click', showRegisterForm);
            document.getElementById('showLogin').addEventListener('click', showLoginForm);
            document.getElementById('forgotPassword').addEventListener('click', handleForgotPassword);
            
            document.getElementById('googleLogin').addEventListener('click', handleGoogleLogin);
            document.getElementById('githubLogin').addEventListener('click', handleGithubLogin);
            
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);
            document.getElementById('notificationsBtn').addEventListener('click', showNotifications);
            document.getElementById('messagesBtn').addEventListener('click', showMessages);
            document.getElementById('createPostBtn').addEventListener('click', showCreatePostModal);
            document.getElementById('profileMenuBtn').addEventListener('click', showProfileMenu);
            document.getElementById('adminPanelBtn').addEventListener('click', showAdminPanel);
            
            document.getElementById('searchInput').addEventListener('input', handleSearch);
            document.getElementById('searchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') performSearch();
            });
        }

        function loadSampleData() {
            users = [...SAMPLE_USERS];
            posts = [...SAMPLE_POSTS];
            notifications = [
                { id: 1, text: 'FloraCreative liked your post', time: '5m ago', read: false },
                { id: 2, text: 'TechWorker pollinated your idea', time: '12m ago', read: false },
                { id: 3, text: 'ScienceBee started following you', time: '1h ago', read: true },
                { id: 4, text: 'Your post is trending!', time: '2h ago', read: true }
            ];
            messages = [
                { id: 1, from: 'FloraCreative', text: 'Hey! Loved your garden post!', time: '10m ago', unread: true },
                { id: 2, from: 'TechWorker', text: 'Can we collaborate on that algorithm?', time: '1h ago', unread: true }
            ];
            
            updateBadgeCounts();
            loadTrendingTopics();
            loadSuggestedUsers();
            loadActivityFeed();
        }

        // ============================================
        // FILE UPLOAD FUNCTIONS - FIXED
        // ============================================
        function handleMediaUpload(event) {
            const files = event.target.files;
            if (files.length > 0) {
                const mediaPreview = document.getElementById('mediaPreview');
                mediaPreview.innerHTML = '';
                
                for (let i = 0; i < Math.min(files.length, 4); i++) {
                    const file = files[i];
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        if (file.type.startsWith('image/')) {
                            const img = document.createElement('img');
                            img.src = e.target.result;
                            img.style.maxWidth = '100%';
                            img.style.borderRadius = '10px';
                            img.style.marginBottom = '10px';
                            img.style.maxHeight = '200px';
                            mediaPreview.appendChild(img);
                        } else if (file.type.startsWith('video/')) {
                            const video = document.createElement('video');
                            video.src = e.target.result;
                            video.controls = true;
                            video.style.maxWidth = '100%';
                            video.style.borderRadius = '10px';
                            video.style.marginBottom = '10px';
                            video.style.maxHeight = '200px';
                            mediaPreview.appendChild(video);
                        }
                    };
                    
                    reader.readAsDataURL(file);
                }
                
                document.getElementById('postMediaContainer').classList.remove('hidden');
                showToast(`Added ${files.length} file(s) to post`);
            }
        }

        function showLinkModal() {
            document.getElementById('linkUrl').value = '';
            document.getElementById('linkText').value = '';
            openModal('linkModal');
        }

        function addLinkFromModal() {
            const url = document.getElementById('linkUrl').value.trim();
            const text = document.getElementById('linkText').value.trim();
            
            if (!url) {
                showToast('Please enter a URL');
                return;
            }
            
            const content = document.getElementById('postContent');
            content.value += `\n${text ? `[${text}](${url})` : url}`;
            
            closeModal('linkModal');
            showToast('Link added to post');
        }

        function addTagFromInput() {
            const input = document.getElementById('hashtagInput');
            let tag = input.value.trim();
            
            if (tag && !tag.startsWith('#')) {
                tag = '#' + tag;
            }
            
            if (tag) {
                const tagsContainer = document.getElementById('postTags');
                const tagElement = document.createElement('span');
                tagElement.className = 'post-tag';
                tagElement.textContent = tag;
                tagElement.onclick = function() { this.remove(); };
                tagsContainer.appendChild(tagElement);
                
                input.value = '';
                input.focus();
            }
        }

        // ============================================
        // PROFILE FUNCTIONS - FIXED
        // ============================================
        function editProfile() {
            document.getElementById('bioText').value = currentUser.bio;
            openModal('bioModal');
        }

        function saveBio() {
            const newBio = document.getElementById('bioText').value.trim();
            if (newBio) {
                currentUser.bio = newBio;
                updateUIForUser();
                localStorage.setItem('polleneer_user', JSON.stringify(currentUser));
                closeModal('bioModal');
                showToast('Bio updated successfully!');
                
                if (currentPage === 'profile') {
                    goToProfile(selectedProfileTab);
                }
            }
        }

        function changeAvatar() {
            document.getElementById('avatarPreviewImg').src = currentUser.avatar;
            openModal('avatarModal');
        }

        function previewAvatar(event) {
            const file = event.target.files[0];
            if (file) {
                if (file.size > 5 * 1024 * 1024) {
                    showToast('File size must be less than 5MB');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('avatarPreviewImg').src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        function saveAvatar() {
            const previewImg = document.getElementById('avatarPreviewImg').src;
            if (previewImg && previewImg !== currentUser.avatar) {
                currentUser.avatar = previewImg;
                updateUIForUser();
                localStorage.setItem('polleneer_user', JSON.stringify(currentUser));
                closeModal('avatarModal');
                showToast('Avatar updated successfully!');
                
                if (currentPage === 'profile') {
                    goToProfile(selectedProfileTab);
                }
            }
        }

        // ============================================
        // BULLETIN BOARD FUNCTIONS - FIXED
        // ============================================
        function addBulletinOption(option) {
            selectedBulletinOption = option;
            
            document.querySelectorAll('.bulletin-option').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            event.target.classList.add('selected');
        }

        function postBulletin() {
            const text = document.getElementById('bulletinText').value.trim();
            if (!text) {
                showToast('Please write something for your bulletin');
                return;
            }
            
            showToast(`Bulletin posted as ${selectedBulletinOption}!`);
            document.getElementById('bulletinText').value = '';
            
            document.querySelectorAll('.bulletin-option').forEach(btn => {
                btn.classList.remove('selected');
            });
            document.querySelector('.bulletin-option').classList.add('selected');
            selectedBulletinOption = 'public';
        }

        function manageFriends() {
            showToast('Friends management would open here. In a real app, this would show friend management options.');
        }

        function switchProfileTab(tab) {
            selectedProfileTab = tab;
            
            document.querySelectorAll('.customization-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            event.target.classList.add('active');
            
            loadProfileFeed(tab);
        }

        // ============================================
        // CUSTOMIZATION FUNCTIONS - FIXED
        // ============================================
        function switchCustomizationTab(tab) {
            document.querySelectorAll('.customization-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            event.target.classList.add('active');
            
            document.querySelectorAll('.customization-section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.getElementById(tab + 'Section').classList.add('active');
        }

        function selectColor(color) {
            selectedColor = color;
            
            document.querySelectorAll('.color-option').forEach(option => {
                option.classList.remove('selected');
                if (option.getAttribute('data-color') === color) {
                    option.classList.add('selected');
                }
            });
            
            document.getElementById('customColorPicker').value = color;
        }

        function setBackground(type) {
            selectedBackground = type;
            showToast(`Background set to ${type}`);
        }

        function testMusic() {
            const url = document.getElementById('musicUrl').value.trim();
            if (url) {
                showToast('Testing music... In a real app, this would play the music.');
            } else {
                showToast('Please enter a music URL');
            }
        }

        function saveCustomization() {
            customization.colors = { primary: selectedColor };
            customization.background = selectedBackground;
            customization.css = document.getElementById('customCSSEditor').value;
            
            localStorage.setItem('polleneer_customization', JSON.stringify(customization));
            showToast('Customization saved!');
            
            if (currentPage === 'profile') {
                applyProfileCustomization();
            }
        }

        function resetCustomization() {
            selectedColor = '#FFC30B';
            selectedBackground = 'gradient';
            document.getElementById('customCSSEditor').value = '';
            document.getElementById('musicUrl').value = '';
            
            document.querySelectorAll('.color-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelector('.color-option').classList.add('selected');
            
            showToast('Customization reset to default');
        }

        function applyProfileCustomization() {
            const profileHeader = document.getElementById('profileHeader');
            if (profileHeader && customization.colors.primary) {
                profileHeader.style.borderColor = customization.colors.primary;
            }
        }

        // ============================================
        // SIDEBAR FUNCTIONS - FIXED
        // ============================================
        function loadTrendingTopics() {
            const trendingList = document.getElementById('trendingList');
            if (!trendingList) return;
            
            trendingList.innerHTML = TRENDING_TOPICS.map(topic => `
                <li class="trend-item" onclick="searchTag('${topic.tag}')">
                    <div class="trend-category">${topic.category}  Trending</div>
                    <div class="trend-tag">${topic.tag}</div>
                    <div class="trend-stats">${topic.posts} posts</div>
                </li>
            `).join('');
        }

        function loadSuggestedUsers() {
            const suggestedUsers = document.getElementById('suggestedUsers');
            if (!suggestedUsers) return;
            
            if (!currentUser) return;
            const suggestions = users.filter(u => u.id !== currentUser.id).slice(0, 4);
            
            suggestedUsers.innerHTML = suggestions.map(user => `
                <div class="user-to-follow">
                    <div class="follow-user-info" onclick="goToUserProfile(${user.id})">
                        <img src="${user.avatar}" alt="User" class="follow-avatar">
                        <div class="follow-details">
                            <h4>${user.displayName}</h4>
                            <p>@${user.username}</p>
                        </div>
                    </div>
                    <button class="follow-btn" onclick="toggleFollow(${user.id})">
                        Follow
                    </button>
                </div>
            `).join('');
        }

        function loadActivityFeed() {
            const activityFeed = document.getElementById('activityFeed');
            if (!activityFeed) return;
            
            const activities = [
                { user: 'FloraCreative', action: 'posted a new artwork', time: '5m ago', icon: 'fas fa-palette' },
                { user: 'TechWorker', action: 'pollinated an idea about AI', time: '12m ago', icon: 'fas fa-retweet' },
                { user: 'ScienceBee', action: 'started a new discussion', time: '25m ago', icon: 'fas fa-comments' },
                { user: 'NewUser123', action: 'joined Polleneer', time: '1h ago', icon: 'fas fa-user-plus' }
            ];
            
            activityFeed.innerHTML = activities.map(activity => `
                <div class="activity-item" onclick="searchUser('${activity.user}')">
                    <div class="activity-icon">
                        <i class="${activity.icon}"></i>
                    </div>
                    <div class="activity-content">
                        <strong>${activity.user}</strong> ${activity.action}
                    </div>
                    <div class="activity-time">${activity.time}</div>
                </div>
            `).join('');
        }

        function loadCommunities() {
            const communitiesGrid = document.getElementById('communitiesGrid');
            if (!communitiesGrid) return;
            
            const communities = [
                { name: 'Art Collective', members: '3.7k', icon: 'A', color: '#FF69B4' },
                { name: 'Tech Innovators', members: '4.2k', icon: 'T', color: '#87CEEB' },
                { name: 'Music Lovers', members: '5.1k', icon: 'M', color: '#9370DB' },
                { name: 'Food & Travel', members: '2.8k', icon: 'F', color: '#FF8C00' },
                { name: 'Gaming Hub', members: '6.3k', icon: 'G', color: '#228B22' },
                { name: 'Book Club', members: '1.9k', icon: 'B', color: '#8B4513' }
            ];
            
            communitiesGrid.innerHTML = communities.map(community => `
                <div class="hive-card" style="flex-direction: column; text-align: center; padding: 20px;">
                    <div class="hive-icon" style="background: ${community.color}; margin-bottom: 10px; width: 60px; height: 60px; align-self: center;">
                        ${community.icon}
                    </div>
                    <div style="text-align: center;">
                        <h4>${community.name}</h4>
                        <div class="hive-members">${community.members} members</div>
                    </div>
                    <button class="follow-btn" style="margin-top: 10px; width: 100%;" onclick="joinCommunity('${community.name}')">
                        Join Community
                    </button>
                    <button class="action-btn" style="margin-top: 5px; width: 100%;" onclick="createCommunity()">
                        <i class="fas fa-plus"></i> Create Similar
                    </button>
                </div>
            `).join('');
        }

        function createCommunity() {
            showToast('Create community feature would open here. In a real app, you would need 50 honey points to create a community.');
        }

        // ============================================
        // AUTHENTICATION FUNCTIONS
        // ============================================
        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (email === ADMIN_CREDENTIALS.username || email === ADMIN_CREDENTIALS.email) {
                if (password === ADMIN_CREDENTIALS.password) {
                    currentUser = { ...ADMIN_CREDENTIALS };
                    isAdmin = true;
                    document.getElementById('adminPanelBtn').style.display = 'block';
                    showToast('Welcome back, Admin! ');
                } else {
                    showToast('Invalid password for admin account');
                    return;
                }
            } else {
                const user = users.find(u => u.email === email || u.username === email);
                if (!user || password !== 'password123') {
                    showToast('Invalid credentials. Try: admin/polleneer2024 or any username/password123');
                    return;
                }
                currentUser = { ...user };
                isAdmin = false;
            }
            
            localStorage.setItem('polleneer_user', JSON.stringify(currentUser));
            showApp();
            updateUIForUser();
            loadHomeFeed();
            showToast(`Welcome back, ${currentUser.username}! `);
        }

        function handleRegister(e) {
            e.preventDefault();
            const username = document.getElementById('regUsername').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regConfirmPassword').value;
            const beeRole = document.getElementById('regBeeRole').value;
            
            if (password !== confirmPassword) {
                showToast('Passwords do not match!');
                return;
            }
            
            if (users.some(u => u.username === username)) {
                showToast('Username already taken!');
                return;
            }
            
            if (users.some(u => u.email === email)) {
                showToast('Email already registered!');
                return;
            }
            
            const newUser = {
                id: users.length + 1,
                username: username,
                displayName: username,
                email: email,
                role: beeRole,
                bio: 'New to Polleneer! Ready to start pollinating ideas.',
                honeyPoints: 100,
                followers: 0,
                following: 0,
                avatar: `https://api.dicebear.com/7.x/avataaars/svg?seed=${username}`,
                joined: new Date().toISOString().split('T')[0],
                customization: {}
            };
            
            users.push(newUser);
            currentUser = newUser;
            isAdmin = false;
            
            localStorage.setItem('polleneer_user', JSON.stringify(currentUser));
            showApp();
            updateUIForUser();
            loadHomeFeed();
            showToast(`Welcome to Polleneer, ${username}!  You've earned 100 Honey Points!`);
            showLoginForm();
        }

        function handleGoogleLogin() {
            showToast('Google login would open here.');
        }

        function handleGithubLogin() {
            showToast('GitHub login would open here.');
        }

        function handleForgotPassword(e) {
            e.preventDefault();
            showToast('Password reset email would be sent.');
        }

        function showRegisterForm(e) {
            if (e) e.preventDefault();
            document.querySelector('.auth-card').classList.add('hidden');
            document.getElementById('registerCard').classList.remove('hidden');
        }

        function showLoginForm(e) {
            if (e) e.preventDefault();
            document.getElementById('registerCard').classList.add('hidden');
            document.querySelector('.auth-card').classList.remove('hidden');
        }

        function logout() {
            if (confirm('Are you sure you want to leave the hive?')) {
                currentUser = null;
                isAdmin = false;
                localStorage.removeItem('polleneer_user');
                closeModal('profileMenuModal');
                showAuth();
                showToast('You have been logged out. Come back soon! ');
            }
        }

        // ============================================
        // UI MANAGEMENT FUNCTIONS
        // ============================================
        function showAuth() {
            document.getElementById('authScreen').classList.remove('hidden');
            document.getElementById('appScreen').classList.add('hidden');
        }

        function showApp() {
            document.getElementById('authScreen').classList.add('hidden');
            document.getElementById('appScreen').classList.remove('hidden');
        }

        function updateUIForUser() {
            if (!currentUser) return;
            
            const avatars = document.querySelectorAll('#currentUserAvatar, #sidebarUserAvatar, #modalUserAvatar, #menuUserAvatar');
            avatars.forEach(avatar => {
                avatar.src = currentUser.avatar;
            });
            
            document.getElementById('sidebarUserName').textContent = currentUser.displayName;
            document.getElementById('menuUserName').textContent = currentUser.displayName;
            document.getElementById('menuUserRole').textContent = `@${currentUser.username}  ${getRoleName(currentUser.role)}`;
            document.getElementById('sidebarUserRole').textContent = getRoleName(currentUser.role);
            document.getElementById('sidebarHoneyPoints').textContent = currentUser.honeyPoints.toLocaleString();
            document.getElementById('honeyPoints').textContent = currentUser.honeyPoints.toLocaleString();
            document.getElementById('menuHoneyCount').textContent = currentUser.honeyPoints.toLocaleString();
            document.getElementById('menuFollowingCount').textContent = currentUser.following || 0;
            document.getElementById('menuFollowersCount').textContent = currentUser.followers || 0;
            document.getElementById('adminPanelBtn').style.display = isAdmin ? 'block' : 'none';
        }

        function getRoleName(role) {
            const roles = {
                'queen': 'Queen Bee',
                'worker': 'Worker Bee',
                'drone': 'Drone',
                'honeybee': 'Honey Bee',
                'admin': 'Admin'
            };
            return roles[role] || 'Bee';
        }

        function updateBadgeCounts() {
            const unreadNotifications = notifications.filter(n => !n.read).length;
            const unreadMessages = messages.filter(m => m.unread).length;
            
            document.getElementById('notificationBadge').textContent = unreadNotifications;
            document.getElementById('sidebarNotificationBadge').textContent = unreadNotifications;
            document.getElementById('messageBadge').textContent = unreadMessages;
            document.getElementById('sidebarMessageBadge').textContent = unreadMessages;
        }

        // ============================================
        // THEME AND STYLE FUNCTIONS
        // ============================================
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('polleneer_theme', newTheme);
            updateThemeIcon(newTheme);
            showToast(`${newTheme.charAt(0).toUpperCase() + newTheme.slice(1)} theme activated`);
        }

        function updateThemeIcon(theme) {
            const icon = document.querySelector('#themeToggle i');
            if (theme === 'dark') {
                icon.className = 'fas fa-moon';
                document.getElementById('themeToggle').title = 'Switch to light theme';
            } else {
                icon.className = 'fas fa-sun';
                document.getElementById('themeToggle').title = 'Switch to dark theme';
            }
        }

        // ============================================
        // NAVIGATION FUNCTIONS
        // ============================================
        function goToHome() {
            currentPage = 'home';
            document.getElementById('mainContent').innerHTML = `
                <div class="inline-compose">
                    <div class="compose-top">
                        <img src="${currentUser.avatar}" alt="Profile" style="width:40px;height:40px;border-radius:50%;cursor:pointer;" onclick="goToProfile()">
                        <textarea class="compose-textarea" id="inlinePostContent" placeholder="What's buzzing in your mind?" oninput="handleInlineCompose(this)" onfocus="expandInlineCompose()"></textarea>
                    </div>
                    <div class="media-preview-inline" id="inlineMediaPreview"></div>
                    <div class="compose-actions hidden" id="inlineComposeActions">
                        <div class="compose-btns">
                            <button onclick="triggerInlineMedia()" title="Media"><i class="fas fa-image"></i></button>
                            <button onclick="showGifPicker()" title="GIF"><span class="gif-label">GIF</span></button>
                            <button onclick="window._emojiTarget='inlinePostContent';showStickerPicker()" title="Stickers"><i class="fas fa-note-sticky"></i></button>
                            <button onclick="showEmojiPickerInline()" title="Emoji"><i class="fas fa-face-smile"></i></button>
                            <button onclick="showLinkModal()" title="Link"><i class="fas fa-link"></i></button>
                            <button onclick="createPollInline()" title="Poll"><i class="fas fa-poll"></i></button>
                            <button onclick="showLocationPicker()" title="Location"><i class="fas fa-map-marker-alt"></i></button>
                            <button onclick="showSchedulePost()" title="Schedule"><i class="fas fa-clock"></i></button>
                            <input type="file" id="inlineMediaUpload" accept="image/*,video/*" style="display:none;" onchange="handleInlineMediaUpload(event)">
                        </div>
                        <button class="compose-submit" id="inlineBuzzBtn" onclick="submitInlinePost()" disabled>
                            <i class="fas fa-feather-alt"></i> Buzz
                        </button>
                    </div>
                </div>
                <div class="feed" id="homeFeed"></div>
            `;
            loadHomeFeed();
            updateActiveNavLink('home');
        }

        function goToExplore() {
            currentPage = 'explore';
            document.getElementById('mainContent').innerHTML = `
                <div class="customization-panel">
                    <h3 style="margin-bottom: 20px; color: var(--honey-yellow);"><i class="fas fa-hashtag"></i> Explore Polleneer</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;">
                        ${TRENDING_TOPICS.map(topic => `
                            <div class="trend-item" style="background: var(--bg-secondary); padding: 15px; border-radius: 10px; cursor: pointer;" onclick="searchTag('${topic.tag}')">
                                <div class="trend-category">${topic.category}  Trending</div>
                                <div class="trend-tag">${topic.tag}</div>
                                <div class="trend-stats">${topic.posts} posts</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="feed" id="exploreFeed"></div>
            `;
            loadExploreFeed();
            updateActiveNavLink('explore');
        }

        function goToProfile(section = 'posts') {
            currentPage = 'profile';
            selectedProfileTab = section;
            const user = currentUser;
            
            document.getElementById('mainContent').innerHTML = `
                <div class="profile-page">
                    <div class="profile-header" id="profileHeader">
                        <div class="profile-banner" id="profileBanner"></div>
                        <div class="profile-info">
                            <img src="${user.avatar}" alt="Profile" class="profile-avatar-large" id="profileAvatar" onclick="changeAvatar()">
                            <div class="profile-details">
                                <div class="profile-name">${user.displayName}</div>
                                <div class="profile-username">@${user.username}</div>
                                <div class="profile-bio">${user.bio}</div>
                                <div class="profile-stats">
                                    <div class="stat-item" onclick="showFollowers()">
                                        <div class="stat-number">${user.followers || 0}</div>
                                        <div class="stat-label">Followers</div>
                                    </div>
                                    <div class="stat-item" onclick="showFollowing()">
                                        <div class="stat-number">${user.following || 0}</div>
                                        <div class="stat-label">Following</div>
                                    </div>
                                    <div class="stat-item" onclick="showHoneyShop()">
                                        <div class="stat-number">${user.honeyPoints.toLocaleString()}</div>
                                        <div class="stat-label">Honey Points</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-number">${user.joined}</div>
                                        <div class="stat-label">Joined</div>
                                    </div>
                                </div>
                                <div class="profile-actions">
                                    <button class="profile-btn primary" onclick="showCustomization()">
                                        <i class="fas fa-paint-brush"></i> Customize Profile
                                    </button>
                                    <button class="profile-btn secondary" onclick="editProfile()">
                                        <i class="fas fa-edit"></i> Edit Profile
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Music Player -->
                    <div class="music-player" id="profileMusicPlayer" style="display: none;">
                        <div class="player-controls">
                            <button class="play-btn" id="profilePlayBtn" onclick="toggleMusic()">
                                <i class="fas fa-play"></i>
                            </button>
                            <div class="song-info">
                                <div class="song-title" id="profileSongTitle">No song selected</div>
                                <div class="song-artist" id="profileSongArtist">Add music in customization</div>
                            </div>
                            <div class="progress-bar" onclick="seekMusic(event)">
                                <div class="progress" id="musicProgress"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Bulletin Posts -->
                    <div class="bulletin-section">
                        <h4 style="margin-bottom: 15px;"><i class="fas fa-bullhorn"></i> Bulletin Board</h4>
                        <div class="bulletin-form">
                            <textarea placeholder="Post a bulletin to your profile..." id="bulletinText"></textarea>
                            <div class="bulletin-options">
                                <button class="bulletin-option selected" onclick="addBulletinOption('public')">
                                    <i class="fas fa-globe"></i> Public
                                </button>
                                <button class="bulletin-option" onclick="addBulletinOption('friends')">
                                    <i class="fas fa-user-friends"></i> Friends Only
                                </button>
                                <button class="bulletin-option" onclick="addBulletinOption('survey')">
                                    <i class="fas fa-poll"></i> Survey
                                </button>
                            </div>
                            <button class="pollinate-btn" onclick="postBulletin()" style="width: 100%;">
                                <i class="fas fa-paper-plane"></i> Post Bulletin
                            </button>
                        </div>
                    </div>
                    
                    <!-- Top Friends -->
                    <div class="friends-section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h4><i class="fas fa-star"></i> Top Friends</h4>
                            <button class="action-btn" onclick="manageFriends()">
                                <i class="fas fa-cog"></i> Manage
                            </button>
                        </div>
                        <div class="friends-grid" id="topFriendsGrid">
                            <!-- Friends will be loaded here -->
                        </div>
                    </div>
                    
                    <!-- Profile Tabs -->
                    <div class="customization-tabs" style="margin-bottom: 20px;">
                        <button class="customization-tab ${section === 'posts' ? 'active' : ''}" onclick="switchProfileTab('posts')">
                            <i class="fas fa-feather-alt"></i> Posts
                        </button>
                        <button class="customization-tab ${section === 'comments' ? 'active' : ''}" onclick="switchProfileTab('comments')">
                            <i class="fas fa-comment"></i> Comments
                        </button>
                        <button class="customization-tab ${section === 'media' ? 'active' : ''}" onclick="switchProfileTab('media')">
                            <i class="fas fa-image"></i> Media
                        </button>
                        <button class="customization-tab ${section === 'likes' ? 'active' : ''}" onclick="switchProfileTab('likes')">
                            <i class="fas fa-heart"></i> Likes
                        </button>
                    </div>
                    
                    <div class="feed" id="profileFeed"></div>
                </div>
            `;
            
            applyProfileCustomization();
            loadProfileFeed(section);
            loadTopFriends();
            updateActiveNavLink('profile');
        }

        function goToBookmarks() {
            currentPage = 'bookmarks';
            document.getElementById('mainContent').innerHTML = `
                <div class="customization-panel">
                    <h3 style="margin-bottom: 20px; color: var(--honey-yellow);"><i class="fas fa-bookmark"></i> Bookmarks</h3>
                    <p style="color: var(--text-secondary);">Posts you've saved for later.</p>
                </div>
                <div class="feed" id="bookmarksFeed"></div>
            `;
            loadBookmarksFeed();
            updateActiveNavLink('bookmarks');
        }

        function goToCommunities() {
            currentPage = 'communities';
            document.getElementById('mainContent').innerHTML = `
                <div class="customization-panel">
                    <h3 style="margin-bottom: 20px; color: var(--honey-yellow);"><i class="fas fa-users"></i> Communities</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px;" id="communitiesGrid"></div>
                </div>
            `;
            loadCommunities();
            updateActiveNavLink('communities');
        }

        function updateActiveNavLink(page) {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            const navLinks = {
                'home': document.querySelector('.nav-link[onclick="goToHome()"]'),
                'explore': document.querySelector('.nav-link[onclick="goToExplore()"]'),
                'profile': document.querySelector('.nav-link[onclick="goToProfile()"]'),
                'bookmarks': document.querySelector('.nav-link[onclick="goToBookmarks()"]'),
                'communities': document.querySelector('.nav-link[onclick="goToCommunities()"]')
            };
            
            if (navLinks[page]) {
                navLinks[page].classList.add('active');
            }
        }

        // ============================================
        // POST FUNCTIONS
        // ============================================
        function loadHomeFeed() {
            const feed = document.getElementById('homeFeed');
            if (!feed) return;
            
            feed.innerHTML = posts.map(post => createPostHTML(post)).join('');
        }

        function loadExploreFeed() {
            const feed = document.getElementById('exploreFeed');
            if (!feed) return;
            
            feed.innerHTML = posts.map(post => createPostHTML(post)).join('');
        }

        function loadProfileFeed(section = 'posts') {
            const feed = document.getElementById('profileFeed');
            if (!feed) return;
            
            const userPosts = posts.filter(post => post.userId === currentUser.id);
            feed.innerHTML = userPosts.map(post => createPostHTML(post)).join('');
        }

        function loadBookmarksFeed() {
            const feed = document.getElementById('bookmarksFeed');
            if (!feed) return;
            
            const bookmarkedPosts = posts.filter(post => post.isLiked);
            feed.innerHTML = bookmarkedPosts.map(post => createPostHTML(post)).join('');
        }

        function createPostHTML(post) {
            const user = users.find(u => u.id === post.userId);
            if (!user) return '';
            
            const postComments = comments[post.id] || [];
            
            return `
                <div class="post-card" id="post-${post.id}">
                    <div class="post-header">
                        <div class="post-user" onclick="goToUserProfile(${user.id})">
                            <img src="${user.avatar}" alt="User" class="post-avatar">
                            <div class="user-name-role">
                                <div class="user-name">
                                    ${user.displayName}
                                    <span class="user-role-badge">${getRoleName(user.role)}</span>
                                </div>
                                <div class="post-meta">@${user.username}  ${post.createdAt}</div>
                            </div>
                        </div>
                        
                        <div class="post-options">
                            <button class="options-btn" onclick="toggleOptionsMenu(${post.id})">
                                <i class="fas fa-ellipsis-h"></i>
                            </button>
                            <div class="options-menu" id="options-menu-${post.id}">
                                <button class="option-item" onclick="savePost(${post.id})">
                                    <i class="fas fa-bookmark"></i>
                                    <span>Save post</span>
                                </button>
                                <button class="option-item" onclick="copyPostLink(${post.id})">
                                    <i class="fas fa-link"></i>
                                    <span>Copy link</span>
                                </button>
                                ${post.userId === currentUser.id ? `
                                <button class="option-item" onclick="editPost(${post.id})">
                                    <i class="fas fa-edit"></i>
                                    <span>Edit post</span>
                                </button>
                                <button class="option-item" onclick="deletePost(${post.id})" style="color: #ff6b6b;">
                                    <i class="fas fa-trash"></i>
                                    <span>Delete post</span>
                                </button>
                                ` : `
                                <button class="option-item" onclick="reportPost(${post.id})" style="color: #ff6b6b;">
                                    <i class="fas fa-flag"></i>
                                    <span>Report post</span>
                                </button>
                                `}
                            </div>
                        </div>
                    </div>
                    
                    <div class="post-content">${formatPostContent(post.content)}</div>
                    
                    ${post.tags && post.tags.length > 0 ? `
                    <div class="post-tags">
                        ${post.tags.map(tag => `<span class="post-tag" onclick="searchTag('${tag}')">${tag}</span>`).join('')}
                    </div>
                    ` : ''}
                    
                    ${post.media ? `
                    <div class="post-media">
                        <img src="${post.media}" alt="Post media" class="post-image" onclick="viewMedia('${post.media}')">
                    </div>
                    ` : ''}
                    
                    <div class="post-stats">
                        <div class="stat">
                            <i class="fas fa-retweet"></i>
                            <span>${post.pollinations} Pollinations</span>
                        </div>
                        <div class="stat">
                            <i class="fas fa-comment"></i>
                            <span>${post.comments} Comments</span>
                        </div>
                        <div class="stat">
                            <i class="fas fa-heart"></i>
                            <span>${post.likes} Likes</span>
                        </div>
                        <div class="stat">
                            <i class="fas fa-chart-line"></i>
                            <span>${post.views.toLocaleString()} Views</span>
                        </div>
                    </div>
                    
                    <div class="post-actions-bar">
                        <button class="post-action-btn ${post.isLiked ? 'liked' : ''}" onclick="likePost(${post.id})">
                            <i class="${post.isLiked ? 'fas' : 'far'} fa-heart"></i>
                            <span>${post.isLiked ? 'Liked' : 'Like'}</span>
                        </button>
                        <button class="post-action-btn" onclick="toggleComments(${post.id})">
                            <i class="far fa-comment"></i>
                            <span>Comment</span>
                        </button>
                        <button class="post-action-btn ${post.isPollinated ? 'pollinated' : ''}" onclick="pollinatePost(${post.id})">
                            <i class="${post.isPollinated ? 'fas' : 'far'} fa-retweet"></i>
                            <span>${post.isPollinated ? 'Pollinated' : 'Pollinate'}</span>
                        </button>
                        <button class="post-action-btn" onclick="sharePost(${post.id})">
                            <i class="far fa-share-square"></i>
                            <span>Share</span>
                        </button>
                    </div>
                    
                    <div class="comments-section" id="comments-${post.id}">
                        <div id="comments-list-${post.id}">
                            ${postComments.map(comment => `
                                <div class="comment">
                                    <img src="${users.find(u => u.id === comment.userId)?.avatar || 'https://api.dicebear.com/7.x/avataaars/svg?seed=default'}" alt="User" class="comment-avatar">
                                    <div class="comment-content">
                                        <div class="comment-header">
                                            <div class="comment-author">${users.find(u => u.id === comment.userId)?.displayName || 'User'}</div>
                                            <div class="comment-time">${comment.createdAt}</div>
                                        </div>
                                        <div class="comment-text">${comment.text}</div>
                                        <div class="comment-actions">
                                            <button class="comment-action" onclick="likeComment(${post.id}, ${comment.id})">Like</button>
                                            <button class="comment-action" onclick="replyToComment(${post.id}, ${comment.id})">Reply</button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div class="add-comment">
                            <input type="text" class="comment-input" id="comment-input-${post.id}" placeholder="Write a comment..." onkeypress="if(event.key === 'Enter') addComment(${post.id})">
                            <button class="comment-submit-btn" onclick="addComment(${post.id})">Post</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function formatPostContent(content) {
            return content
                .replace(/@(\w+)/g, '<a href="#" onclick="searchUser(\'$1\')" style="color: var(--honey-yellow); text-decoration: none;">@$1</a>')
                .replace(/#(\w+)/g, '<a href="#" onclick="searchTag(\'#$1\')" style="color: var(--honey-yellow); text-decoration: none;">#$1</a>')
                .replace(/\n/g, '<br>');
        }

        // ============================================
        // POST INTERACTION FUNCTIONS
        // ============================================
        function likePost(postId) {
            const post = posts.find(p => p.id === postId);
            if (!post) return;
            
            post.isLiked = !post.isLiked;
            post.likes += post.isLiked ? 1 : -1;
            
            const postElement = document.getElementById(`post-${postId}`);
            if (postElement) {
                const likeBtn = postElement.querySelector('.post-action-btn');
                const likeIcon = likeBtn.querySelector('i');
                const likeText = likeBtn.querySelector('span');
                
                likeBtn.classList.toggle('liked');
                likeIcon.className = post.isLiked ? 'fas fa-heart' : 'far fa-heart';
                likeText.textContent = post.isLiked ? 'Liked' : 'Like';
                
                const stats = postElement.querySelectorAll('.stat');
                if (stats[2]) {
                    stats[2].querySelector('span').textContent = `${post.likes} Likes`;
                }
                
                likeBtn.classList.add('clicked');
                setTimeout(() => likeBtn.classList.remove('clicked'), 300);
            }
            
            if (post.isLiked && post.userId !== currentUser.id) {
                currentUser.honeyPoints += 5;
                updateUIForUser();
                localStorage.setItem('polleneer_user', JSON.stringify(currentUser));
                showToast('+5 Honey Points for liking a post! ');
            }
        }

        function toggleComments(postId) {
            if (!currentUser) {
                showToast('Please login to comment');
                return;
            }
            
            const commentsSection = document.getElementById(`comments-${postId}`);
            if (commentsSection) {
                commentsSection.classList.toggle('show');
                const commentInput = document.getElementById(`comment-input-${postId}`);
                if (commentInput && commentsSection.classList.contains('show')) {
                    commentInput.focus();
                }
            }
        }

        function addComment(postId) {
            if (!currentUser) {
                showToast('Please login to comment');
                return;
            }
            
            const commentInput = document.getElementById(`comment-input-${postId}`);
            const commentText = commentInput.value.trim();
            
            if (!commentText) {
                showToast('Please enter a comment');
                return;
            }
            
            if (!comments[postId]) {
                comments[postId] = [];
            }
            
            const newComment = {
                id: comments[postId].length + 1,
                userId: currentUser.id,
                text: commentText,
                createdAt: 'Just now'
            };
            
            comments[postId].push(newComment);
            
            const post = posts.find(p => p.id === postId);
            if (post) {
                post.comments += 1;
            }
            
            const commentsList = document.getElementById(`comments-list-${postId}`);
            if (commentsList) {
                const commentHTML = `
                    <div class="comment">
                        <img src="${currentUser.avatar}" alt="User" class="comment-avatar">
                        <div class="comment-content">
                            <div class="comment-header">
                                <div class="comment-author">${currentUser.displayName}</div>
                                <div class="comment-time">Just now</div>
                            </div>
                            <div class="comment-text">${commentText}</div>
                            <div class="comment-actions">
                                <button class="comment-action" onclick="likeComment(${postId}, ${newComment.id})">Like</button>
                                <button class="comment-action" onclick="replyToComment(${postId}, ${newComment.id})">Reply</button>
                            </div>
                        </div>
                    </div>
                `;
                commentsList.innerHTML += commentHTML;
            }
            
            commentInput.value = '';
            
            const postElement = document.getElementById(`post-${postId}`);
            if (postElement) {
                const stats = postElement.querySelectorAll('.stat');
                if (stats[1]) {
                    stats[1].querySelector('span').textContent = `${post.comments} Comments`;
                }
            }
            
            currentUser.honeyPoints += 10;
            updateUIForUser();
            localStorage.setItem('polleneer_user', JSON.stringify(currentUser));
            showToast('+10 Honey Points for commenting! ');
        }

        function likeComment(postId, commentId) {
            showToast('Liked comment!');
        }

        function replyToComment(postId, commentId) {
            const commentInput = document.getElementById(`comment-input-${postId}`);
            commentInput.focus();
            commentInput.value = '@reply ';
            showToast('Ready to reply! Mention added.');
        }

        function pollinatePost(postId) {
            const post = posts.find(p => p.id === postId);
            if (!post) return;
            
            post.isPollinated = !post.isPollinated;
            post.pollinations += post.isPollinated ? 1 : -1;
            
            const postElement = document.getElementById(`post-${postId}`);
            if (postElement) {
                const pollinateBtn = postElement.querySelector('.post-action-btn:nth-child(3)');
                const pollinateIcon = pollinateBtn.querySelector('i');
                const pollinateText = pollinateBtn.querySelector('span');
                
                pollinateBtn.classList.toggle('pollinated');
                pollinateIcon.className = post.isPollinated ? 'fas fa-retweet' : 'far fa-retweet';
                pollinateText.textContent = post.isPollinated ? 'Pollinated' : 'Pollinate';
                
                const stats = postElement.querySelectorAll('.stat');
                if (stats[0]) {
                    stats[0].querySelector('span').textContent = `${post.pollinations} Pollinations`;
                }
                
                pollinateBtn.classList.add('clicked');
                setTimeout(() => pollinateBtn.classList.remove('clicked'), 300);
            }
            
            if (post.isPollinated && post.userId !== currentUser.id) {
                currentUser.honeyPoints += 15;
                updateUIForUser();
                localStorage.setItem('polleneer_user', JSON.stringify(currentUser));
                showToast('+15 Honey Points for pollinating an idea! ');
            }
        }

        function sharePost(postId) {
            const post = posts.find(p => p.id === postId);
            if (!post) return;
            
            const shareUrl = `https://polleneer.com/post/${postId}`;
            navigator.clipboard.writeText(shareUrl).then(() => {
                showToast('Post link copied to clipboard! ');
            }).catch(() => {
                prompt('Copy this link to share:', shareUrl);
            });
        }

        function toggleOptionsMenu(postId) {
            const menu = document.getElementById(`options-menu-${postId}`);
            if (menu) {
                menu.classList.toggle('show');
                
                document.querySelectorAll('.options-menu.show').forEach(otherMenu => {
                    if (otherMenu !== menu) {
                        otherMenu.classList.remove('show');
                    }
                });
            }
        }

        // ============================================
        // POST CREATION FUNCTIONS
        // ============================================
        function submitPost() {
            const content = document.getElementById('postContent').value.trim();
            if (!content) {
                showToast('Please write something before posting!');
                return;
            }
            
            const newPost = {
                id: posts.length + 1,
                userId: currentUser.id,
                content: content,
                tags: Array.from(document.querySelectorAll('#postTags .post-tag')).map(tag => tag.textContent),
                media: document.getElementById('mediaPreview').querySelector('img')?.src || null,
                likes: 0,
                comments: 0,
                pollinations: 0,
                views: 0,
                createdAt: 'Just now',
                isLiked: false,
                isPollinated: false
            };
            
            posts.unshift(newPost);
            
            document.getElementById('postContent').value = '';
            document.getElementById('postTags').innerHTML = '';
            document.getElementById('mediaPreview').innerHTML = '';
            document.getElementById('postMediaContainer').classList.add('hidden');
            document.getElementById('postPollContainer').classList.add('hidden');
            
            closeModal('createPostModal');
            
            if (currentPage === 'home') {
                loadHomeFeed();
            }
            
            currentUser.honeyPoints += 25;
            updateUIForUser();
            localStorage.setItem('polleneer_user', JSON.stringify(currentUser));
            
            showToast('Post created successfully! +25 Honey Points ');
        }

        function createPoll() {
            const pollContainer = document.getElementById('postPollContainer');
            const pollOptions = document.getElementById('pollOptions');
            
            pollContainer.classList.remove('hidden');
            pollOptions.innerHTML = `
                <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                    <input type="text" class="form-control" placeholder="Option 1" style="flex: 1;">
                    <button class="action-btn" onclick="removePollOption(this)">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                    <input type="text" class="form-control" placeholder="Option 2" style="flex: 1;">
                    <button class="action-btn" onclick="removePollOption(this)">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
        }

        function addPollOption() {
            const pollOptions = document.getElementById('pollOptions');
            const optionCount = pollOptions.children.length + 1;
            const newOption = document.createElement('div');
            newOption.innerHTML = `
                <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                    <input type="text" class="form-control" placeholder="Option ${optionCount}" style="flex: 1;">
                    <button class="action-btn" onclick="removePollOption(this)">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            pollOptions.appendChild(newOption);
        }

        function removePollOption(button) {
            button.closest('div[style*="display: flex"]').remove();
        }

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        function showToast(message) {
            const toast = document.getElementById('notificationToast');
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function loadTopFriends() {
            const friendsGrid = document.getElementById('topFriendsGrid');
            if (!friendsGrid) return;
            
            const friends = users.filter(u => u.id !== currentUser.id).slice(0, 8);
            
            friendsGrid.innerHTML = friends.map(friend => `
                <div class="friend-card" onclick="goToUserProfile(${friend.id})">
                    <img src="${friend.avatar}" alt="Friend" class="friend-avatar">
                    <div class="friend-name">${friend.username}</div>
                </div>
            `).join('');
        }

        function toggleFollow(userId) {
            const user = users.find(u => u.id === userId);
            if (!user) return;
            
            const button = event.target;
            const isFollowing = button.classList.contains('following');
            
            if (isFollowing) {
                button.classList.remove('following');
                button.textContent = 'Follow';
                user.followers -= 1;
                currentUser.following -= 1;
            } else {
                button.classList.add('following');
                button.textContent = 'Following';
                user.followers += 1;
                currentUser.following += 1;
            }
            
            updateUIForUser();
            localStorage.setItem('polleneer_user', JSON.stringify(currentUser));
        }

        function joinCommunity(name) {
            showToast(`Joined ${name} community! `);
        }

        function searchTag(tag) {
            showToast(`Searching for ${tag}...`);
        }

        function searchUser(username) {
            showToast(`Searching for @${username}...`);
        }

        function performSearch() {
            const query = document.getElementById('searchInput').value.trim();
            if (query) {
                showToast(`Searching for "${query}"...`);
            }
        }

        function handleSearch() {
            // Real-time search would be implemented here
        }

        function goToUserProfile(userId) {
            const user = users.find(u => u.id === userId);
            if (user) {
                alert(`Viewing ${user.username}'s profile.`);
            }
        }

        function showHoneyShop() {
            alert('Honey Shop would open here.');
        }

        function refreshSuggestions() {
            loadSuggestedUsers();
            showToast('Suggestions refreshed!');
        }

        // ============================================
        // MODAL FUNCTIONS
        // ============================================
        function showCreatePostModal() {
            openModal('createPostModal');
        }

        function showProfileMenu() {
            openModal('profileMenuModal');
        }

        function showCustomization() {
            openModal('customizationModal');
            closeModal('profileMenuModal');
        }

        function showAdminPanel() {
            if (isAdmin) {
                openModal('adminPanelModal');
            }
        }

        function showNotifications() {
            const unreadCount = notifications.filter(n => !n.read).length;
            if (unreadCount > 0) {
                notifications.forEach(n => n.read = true);
                updateBadgeCounts();
            }
            
            alert(`You have ${notifications.length} notifications.`);
        }

        function showMessages() {
            const unreadCount = messages.filter(m => m.unread).length;
            if (unreadCount > 0) {
                messages.forEach(m => m.unread = false);
                updateBadgeCounts();
            }
            
            alert(`You have ${messages.length} messages.`);
        }

        function showSettings() {
            alert('Settings panel would open here.');
        }

        function showHelp() {
            alert('Help center would open here.');
        }

        function openModal(modalId) {
            document.getElementById(modalId).classList.add('show');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        // Close menus when clicking elsewhere
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.options-btn') && !e.target.closest('.options-menu')) {
                document.querySelectorAll('.options-menu.show').forEach(menu => {
                    menu.classList.remove('show');
                });
            }
        });

        // Close modals with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal.show').forEach(modal => {
                    modal.classList.remove('show');
                });
            }
        });

        // Close modals when clicking outside
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('show');
            }
        });
    


// ============================================
// PHASE 1 FIXES: All broken/stub functions replaced
// ============================================

// 1. showCreatePostModal - was empty, now properly opens modal and sets user avatar
function showCreatePostModal() {
    if (!currentUser) { showToast('Please log in first!'); return; }
    const modalAvatar = document.getElementById('modalUserAvatar');
    if (modalAvatar) modalAvatar.src = currentUser.avatar;
    document.getElementById('postContent').value = '';
    const mediaPreview = document.getElementById('mediaPreview');
    if (mediaPreview) mediaPreview.style.display = 'none';
    const tagsContainer = document.getElementById('postTagsContainer');
    if (tagsContainer) tagsContainer.innerHTML = '';
    const pollContainer = document.getElementById('postPollContainer');
    if (pollContainer) pollContainer.style.display = 'none';
    openModal('createPostModal');
    document.getElementById('postContent').focus();
}

// 2. showHoneyShop - was just an alert, now builds full shop UI
function showHoneyShop() {
    if (!currentUser) { showToast('Please log in first!'); return; }
    const shopItems = [
        { id: 1, name: 'Golden Theme', desc: 'Animated golden background for your profile', cost: 500, icon: 'fa-crown', category: 'Profile' },
        { id: 2, name: 'Hovering Avatar', desc: 'Your avatar floats with a honey glow', cost: 1000, icon: 'fa-ghost', category: 'Profile' },
        { id: 3, name: 'Custom Badge', desc: 'Choose a unique badge for your name', cost: 250, icon: 'fa-certificate', category: 'Profile' },
        { id: 4, name: 'Featured Post (24h)', desc: 'Pin your post to the top of feeds', cost: 1500, icon: 'fa-star', category: 'Posts' },
        { id: 5, name: 'Animated Border', desc: 'Glowing animated border on your posts', cost: 400, icon: 'fa-border-all', category: 'Posts' },
        { id: 6, name: 'Private Hive', desc: 'Create an invite-only community', cost: 1000, icon: 'fa-lock', category: 'Community' },
        { id: 7, name: 'Events Calendar', desc: 'Add events to your hive', cost: 900, icon: 'fa-calendar', category: 'Community' },
        { id: 8, name: 'Stealth Mode', desc: 'Browse without showing online status', cost: 750, icon: 'fa-user-secret', category: 'Social' },
        { id: 9, name: 'Scheduled Posts', desc: 'Queue posts for later', cost: 450, icon: 'fa-clock', category: 'Social' },
        { id: 10, name: 'Virtual Honey Jar', desc: 'Send a honey jar gift to friends', cost: 50, icon: 'fa-jar', category: 'Gifts' },
        { id: 11, name: 'Bee Sticker Pack', desc: '12 animated bee stickers', cost: 150, icon: 'fa-face-smile', category: 'Gifts' },
        { id: 12, name: 'Pollen Burst Effect', desc: 'Sparkle effect when you pollinate', cost: 300, icon: 'fa-sparkles', category: 'Effects' },
        { id: 13, name: 'Nectar Trail', desc: 'Leave a golden trail on visited profiles', cost: 600, icon: 'fa-route', category: 'Effects' },
        { id: 14, name: 'Hive Analytics Pro', desc: 'Detailed stats on your posts', cost: 800, icon: 'fa-chart-line', category: 'Tools' },
        { id: 15, name: 'Auto-Buzz Greeting', desc: 'Auto-welcome new followers', cost: 200, icon: 'fa-hand-wave', category: 'Tools' }
    ];

    const categories = [...new Set(shopItems.map(i => i.category))];

    document.getElementById('mainContent').innerHTML = `
        <div class="customization-panel" style="max-width: 800px; margin: 0 auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h3 style="color: var(--honey-yellow);"><i class="fas fa-store"></i> Honey Shop</h3>
                <div style="background: linear-gradient(135deg, var(--honey-yellow), var(--hive-orange)); padding: 8px 20px; border-radius: 20px; font-weight: bold; color: #000;">
                     ${currentUser.honeyPoints.toLocaleString()} Honey Points
                </div>
            </div>

            <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                <button onclick="filterShop('all')" class="action-btn" style="background: var(--honey-yellow); color: #000; border: none; padding: 6px 15px; border-radius: 20px; cursor: pointer; font-size: 13px;">All</button>
                ${categories.map(c => `<button onclick="filterShop('${c}')" class="action-btn" style="background: var(--bg-card); border: 1px solid var(--border-color); padding: 6px 15px; border-radius: 20px; cursor: pointer; font-size: 13px;">${c}</button>`).join('')}
            </div>

            <div id="shopGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 15px;">
                ${shopItems.map(item => `
                    <div class="post-card" style="padding: 20px; cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform='none'">
                        <div style="text-align: center; margin-bottom: 12px;">
                            <i class="fas ${item.icon}" style="font-size: 2em; color: var(--honey-yellow);"></i>
                        </div>
                        <h4 style="margin-bottom: 5px; text-align: center;">${item.name}</h4>
                        <p style="font-size: 12px; color: var(--text-secondary); text-align: center; margin-bottom: 15px;">${item.desc}</p>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="color: var(--honey-yellow); font-weight: bold;"> ${item.cost}</span>
                            <button onclick="buyShopItem(${item.id}, '${item.name}', ${item.cost})" 
                                style="background: ${currentUser.honeyPoints >= item.cost ? 'var(--honey-yellow)' : 'var(--bg-input)'}; 
                                       color: ${currentUser.honeyPoints >= item.cost ? '#000' : 'var(--text-secondary)'}; 
                                       border: none; padding: 6px 15px; border-radius: 15px; cursor: pointer; font-size: 12px; font-weight: bold;">
                                ${currentUser.honeyPoints >= item.cost ? 'Buy' : 'Need More'}
                            </button>
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>
    `;
    updateActiveNavLink('shop');
}

function buyShopItem(id, name, cost) {
    if (currentUser.honeyPoints < cost) {
        showToast(`Not enough honey! You need ${cost - currentUser.honeyPoints} more points.`);
        return;
    }
    if (confirm(`Buy "${name}" for  ${cost} Honey Points?`)) {
        currentUser.honeyPoints -= cost;
        localStorage.setItem('polleneer_user', JSON.stringify(currentUser));
        showToast(` Purchased "${name}"! -${cost} honey points`);
        showHoneyShop(); // Refresh
    }
}

function filterShop(category) {
    // Re-render with filter - simple approach: re-trigger showHoneyShop
    showHoneyShop();
    if (category !== 'all') {
        const items = document.querySelectorAll('#shopGrid .post-card');
        // Hide items not matching (using data approach isn't possible, so just show toast)
        showToast(`Showing ${category} items`);
    }
}

// 3. showSettings - was empty, now builds full settings page
function showSettings() {
    if (!currentUser) { showToast('Please log in first!'); return; }
    const savedTheme = localStorage.getItem('polleneer_theme') || 'dark';

    document.getElementById('mainContent').innerHTML = `
        <div class="customization-panel" style="max-width: 700px; margin: 0 auto;">
            <h3 style="margin-bottom: 25px; color: var(--honey-yellow);"><i class="fas fa-cog"></i> Settings</h3>

            <div class="post-card" style="padding: 20px; margin-bottom: 15px;">
                <h4 style="margin-bottom: 15px;"><i class="fas fa-user"></i> Account</h4>
                <div style="display: grid; gap: 12px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-radius: 10px; background: var(--bg-input);">
                        <div><strong>Username</strong><br><span style="color: var(--text-secondary); font-size: 13px;">@${currentUser.username}</span></div>
                        <button onclick="editSettingsField('username')" style="background: var(--honey-yellow); color: #000; border: none; padding: 6px 15px; border-radius: 10px; cursor: pointer; font-size: 12px;">Edit</button>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-radius: 10px; background: var(--bg-input);">
                        <div><strong>Email</strong><br><span style="color: var(--text-secondary); font-size: 13px;">${currentUser.email || 'Not set'}</span></div>
                        <button onclick="editSettingsField('email')" style="background: var(--honey-yellow); color: #000; border: none; padding: 6px 15px; border-radius: 10px; cursor: pointer; font-size: 12px;">Edit</button>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-radius: 10px; background: var(--bg-input);">
                        <div><strong>Password</strong><br><span style="color: var(--text-secondary); font-size: 13px;"></span></div>
                        <button onclick="editSettingsField('password')" style="background: var(--honey-yellow); color: #000; border: none; padding: 6px 15px; border-radius: 10px; cursor: pointer; font-size: 12px;">Change</button>
                    </div>
                </div>
            </div>

            <div class="post-card" style="padding: 20px; margin-bottom: 15px;">
                <h4 style="margin-bottom: 15px;"><i class="fas fa-palette"></i> Appearance</h4>
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-radius: 10px; background: var(--bg-input);">
                    <div><strong>Theme</strong><br><span style="color: var(--text-secondary); font-size: 13px;">Switch between dark and light mode</span></div>
                    <button onclick="toggleTheme()" style="background: var(--honey-yellow); color: #000; border: none; padding: 8px 20px; border-radius: 10px; cursor: pointer;">
                        <i class="fas fa-${savedTheme === 'dark' ? 'sun' : 'moon'}"></i> ${savedTheme === 'dark' ? 'Light' : 'Dark'} Mode
                    </button>
                </div>
            </div>

            <div class="post-card" style="padding: 20px; margin-bottom: 15px;">
                <h4 style="margin-bottom: 15px;"><i class="fas fa-shield-alt"></i> Privacy</h4>
                <div style="display: grid; gap: 12px;">
                    <label style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-radius: 10px; background: var(--bg-input); cursor: pointer;">
                        <div><strong>Private Account</strong><br><span style="color: var(--text-secondary); font-size: 13px;">Only approved followers see your posts</span></div>
                        <input type="checkbox" style="width: 20px; height: 20px; accent-color: var(--honey-yellow);">
                    </label>
                    <label style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-radius: 10px; background: var(--bg-input); cursor: pointer;">
                        <div><strong>Allow Direct Messages</strong><br><span style="color: var(--text-secondary); font-size: 13px;">Let anyone send you messages</span></div>
                        <input type="checkbox" checked style="width: 20px; height: 20px; accent-color: var(--honey-yellow);">
                    </label>
                    <label style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-radius: 10px; background: var(--bg-input); cursor: pointer;">
                        <div><strong>Show Online Status</strong><br><span style="color: var(--text-secondary); font-size: 13px;">Others can see when you're active</span></div>
                        <input type="checkbox" checked style="width: 20px; height: 20px; accent-color: var(--honey-yellow);">
                    </label>
                </div>
            </div>

            <div class="post-card" style="padding: 20px; margin-bottom: 15px;">
                <h4 style="margin-bottom: 15px;"><i class="fas fa-bell"></i> Notifications</h4>
                <div style="display: grid; gap: 12px;">
                    <label style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-radius: 10px; background: var(--bg-input); cursor: pointer;">
                        <div><strong>Push Notifications</strong><br><span style="color: var(--text-secondary); font-size: 13px;">Get notified about likes, comments, follows</span></div>
                        <input type="checkbox" checked style="width: 20px; height: 20px; accent-color: var(--honey-yellow);">
                    </label>
                    <label style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-radius: 10px; background: var(--bg-input); cursor: pointer;">
                        <div><strong>Email Notifications</strong><br><span style="color: var(--text-secondary); font-size: 13px;">Receive email updates</span></div>
                        <input type="checkbox" style="width: 20px; height: 20px; accent-color: var(--honey-yellow);">
                    </label>
                </div>
            </div>

            <div class="post-card" style="padding: 20px; border: 1px solid rgba(255,0,0,0.3);">
                <h4 style="margin-bottom: 15px; color: #FF4444;"><i class="fas fa-exclamation-triangle"></i> Danger Zone</h4>
                <button onclick="if(confirm('Are you sure you want to deactivate your account?')) showToast('Account deactivation will be available with backend integration.')" 
                    style="background: transparent; border: 1px solid #FF4444; color: #FF4444; padding: 8px 20px; border-radius: 10px; cursor: pointer;">
                    Deactivate Account
                </button>
            </div>
        </div>
    `;
    updateActiveNavLink('settings');
}

function editSettingsField(field) {
    const newValue = prompt(`Enter new ${field}:`);
    if (newValue && newValue.trim()) {
        currentUser[field] = newValue.trim();
        localStorage.setItem('polleneer_user', JSON.stringify(currentUser));
        showToast(`${field.charAt(0).toUpperCase() + field.slice(1)} updated!`);
        showSettings();
    }
}

// 4. showHelp - was empty, now shows help center
function showHelp() {
    document.getElementById('mainContent').innerHTML = `
        <div class="customization-panel" style="max-width: 700px; margin: 0 auto;">
            <h3 style="margin-bottom: 25px; color: var(--honey-yellow);"><i class="fas fa-question-circle"></i> Help Center</h3>

            <div id="helpAccordion">
                ${[
                    { q: 'What is Polleneer?', a: 'Polleneer is a bee-themed social platform where your interactions mimic pollination. Every post spreads ideas like pollen, every share cross-pollinates content, and together we build a thriving digital hive.' },
                    { q: 'What are Honey Points?', a: 'Honey Points are our reward currency. Earn them by posting (+25), commenting (+10), getting likes (+5), getting pollinations (+15), gaining followers (+20), and daily logins (+50). Spend them in the Honey Shop!' },
                    { q: 'What are Bee Roles?', a: 'Every member has a role in the hive. You start as a Worker Bee and can evolve through activity: Worker  Creator  Pollinator  Scholar  Social Bee. Earn enough and become a Golden Bee or Legend Bee!' },
                    { q: 'How does Pollination work?', a: 'Pollination is like retweeting  you spread someone\'s post to your followers, cross-pollinating ideas across the hive. The original creator earns +15 Honey Points!' },
                    { q: 'What are Hives/Communities?', a: 'Hives are communities where bees with shared interests gather. Create or join hives to find your people and share focused content.' },
                    { q: 'How do I customize my profile?', a: 'Click your profile menu  Customization. You can change colors, backgrounds, add music, and even write custom CSS. Some premium options are available in the Honey Shop.' },
                    { q: 'What is the Golden Hive Algorithm?', a: 'Our algorithm learns what content resonates with you and serves posts that nourish your interests. Unlike other platforms, we optimize for depth of connection, not just engagement.' },
                    { q: 'How do I become a Genesis Pollinator?', a: 'The first 1,000 members are forever etched as Genesis Pollinators  founding members of the hive. Your username will be in our Genesis Hall!' },
                ].map((faq, i) => `
                    <div class="post-card" style="padding: 15px; margin-bottom: 10px; cursor: pointer;" onclick="toggleFAQ(${i})">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <strong>${faq.q}</strong>
                            <i class="fas fa-chevron-down" id="faq-icon-${i}" style="transition: transform 0.3s; color: var(--honey-yellow);"></i>
                        </div>
                        <div id="faq-answer-${i}" style="display: none; margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border-color); color: var(--text-secondary); line-height: 1.6;">
                            ${faq.a}
                        </div>
                    </div>
                `).join('')}
            </div>

            <div class="post-card" style="padding: 20px; margin-top: 20px; text-align: center;">
                <h4 style="margin-bottom: 10px;">Still need help?</h4>
                <p style="color: var(--text-secondary); margin-bottom: 15px;">Reach out to the hive architect</p>
                <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                    <a href="https://twitter.com/wegotheaven" target="_blank" style="background: var(--bg-input); padding: 8px 15px; border-radius: 10px; text-decoration: none; color: var(--text-primary);"><i class="fab fa-twitter"></i> @wegotheaven</a>
                    <a href="https://instagram.com/kingoftheinnocent" target="_blank" style="background: var(--bg-input); padding: 8px 15px; border-radius: 10px; text-decoration: none; color: var(--text-primary);"><i class="fab fa-instagram"></i> @kingoftheinnocent</a>
                    <a href="https://tiktok.com/@kingoftheinnocent" target="_blank" style="background: var(--bg-input); padding: 8px 15px; border-radius: 10px; text-decoration: none; color: var(--text-primary);"><i class="fab fa-tiktok"></i> @kingoftheinnocent</a>
                </div>
            </div>
        </div>
    `;
}

function toggleFAQ(index) {
    const answer = document.getElementById(`faq-answer-${index}`);
    const icon = document.getElementById(`faq-icon-${index}`);
    if (answer.style.display === 'none') {
        answer.style.display = 'block';
        icon.style.transform = 'rotate(180deg)';
    } else {
        answer.style.display = 'none';
        icon.style.transform = 'rotate(0deg)';
    }
}



// 5. showProfileMenu - was empty, now properly opens the modal with updated user data
function showProfileMenu() {
    if (!currentUser) return;
    document.getElementById('menuUserAvatar').src = currentUser.avatar;
    document.getElementById('menuUserName').textContent = currentUser.displayName || currentUser.username;
    document.getElementById('menuUserRole').textContent = getRoleName(currentUser.role);
    document.getElementById('menuFollowersCount').textContent = currentUser.followers.toLocaleString();
    document.getElementById('menuFollowingCount').textContent = currentUser.following.toLocaleString();
    document.getElementById('menuHoneyCount').textContent = currentUser.honeyPoints.toLocaleString();
    openModal('profileMenuModal');
}

// 6 & 7. OAuth handlers - show proper "coming soon" with context
function handleGoogleLogin() {
    showToast(' Google Sign-In coming soon! Use email login for now.');
}

function handleGithubLogin() {
    showToast(' GitHub Sign-In coming soon! Use email login for now.');
}

// 8. handleForgotPassword - now shows a proper reset form
function handleForgotPassword(e) {
    if (e) e.preventDefault();
    const email = prompt('Enter your email address for password reset:');
    if (email && email.includes('@')) {
        showToast(' Password reset link sent! Check your email.');
    } else if (email) {
        showToast('Please enter a valid email address.');
    }
}

// 9 & 10 & 11. Search functions - now actually filter and display results
function searchUser(username) {
    const query = username.replace('@', '').toLowerCase();
    const results = users.filter(u => 
        u.username.toLowerCase().includes(query) || 
        (u.displayName && u.displayName.toLowerCase().includes(query))
    );

    if (results.length === 0) {
        showToast(`No users found matching "${username}"`);
        return;
    }

    document.getElementById('mainContent').innerHTML = `
        <div class="customization-panel" style="max-width: 700px; margin: 0 auto;">
            <h3 style="margin-bottom: 20px; color: var(--honey-yellow);">
                <i class="fas fa-search"></i> User Results for "${username}"
            </h3>
            <div style="display: grid; gap: 10px;">
                ${results.map(user => `
                    <div class="post-card" style="padding: 15px; display: flex; align-items: center; gap: 15px; cursor: pointer;" onclick="goToUserProfile(${user.id})">
                        <img src="${user.avatar}" alt="${user.username}" style="width: 50px; height: 50px; border-radius: 50%; border: 2px solid var(--honey-yellow);">
                        <div style="flex: 1;">
                            <strong>${user.displayName || user.username}</strong>
                            <div style="color: var(--text-secondary); font-size: 13px;">@${user.username}  ${getRoleName(user.role)}</div>
                            <div style="color: var(--text-secondary); font-size: 12px; margin-top: 3px;">${user.bio || ''}</div>
                        </div>
                        <div style="text-align: right;">
                            <span style="color: var(--honey-yellow); font-size: 13px;"> ${user.honeyPoints}</span>
                        </div>
                    </div>
                `).join('')}
            </div>
            <button onclick="goToHome()" style="margin-top: 15px; background: var(--bg-input); border: 1px solid var(--border-color); padding: 8px 20px; border-radius: 10px; cursor: pointer; color: var(--text-primary);">
                <i class="fas fa-arrow-left"></i> Back to Feed
            </button>
        </div>
    `;
}

function searchTag(tag) {
    const query = tag.replace('#', '').toLowerCase();
    const results = posts.filter(p => 
        p.tags && p.tags.some(t => t.toLowerCase().includes(query))
    );

    document.getElementById('mainContent').innerHTML = `
        <div class="customization-panel" style="max-width: 700px; margin: 0 auto;">
            <h3 style="margin-bottom: 20px; color: var(--honey-yellow);">
                <i class="fas fa-hashtag"></i> ${tag}
            </h3>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">${results.length} posts</p>
            <div id="tagFeed">${results.length > 0 ? results.map(post => createPostHTML(post)).join('') : '<div class="post-card" style="padding: 30px; text-align: center; color: var(--text-secondary);">No posts found for this tag yet. Be the first to buzz about it! </div>'}</div>
            <button onclick="goToHome()" style="margin-top: 15px; background: var(--bg-input); border: 1px solid var(--border-color); padding: 8px 20px; border-radius: 10px; cursor: pointer; color: var(--text-primary);">
                <i class="fas fa-arrow-left"></i> Back to Feed
            </button>
        </div>
    `;
}

function handleSearch() {
    const searchInput = document.getElementById('searchInput');
    if (!searchInput) return;
    const query = searchInput.value.trim();
    if (!query) return;

    if (query.startsWith('@')) {
        searchUser(query);
    } else if (query.startsWith('#')) {
        searchTag(query);
    } else {
        // General search - search both users and posts
        const userResults = users.filter(u => 
            u.username.toLowerCase().includes(query.toLowerCase()) ||
            (u.displayName && u.displayName.toLowerCase().includes(query.toLowerCase())) ||
            (u.bio && u.bio.toLowerCase().includes(query.toLowerCase()))
        );
        const postResults = posts.filter(p => 
            p.content.toLowerCase().includes(query.toLowerCase()) ||
            (p.tags && p.tags.some(t => t.toLowerCase().includes(query.toLowerCase())))
        );

        document.getElementById('mainContent').innerHTML = `
            <div class="customization-panel" style="max-width: 700px; margin: 0 auto;">
                <h3 style="margin-bottom: 20px; color: var(--honey-yellow);">
                    <i class="fas fa-search"></i> Results for "${query}"
                </h3>

                ${userResults.length > 0 ? `
                    <h4 style="margin-bottom: 10px; color: var(--text-secondary);">People</h4>
                    <div style="display: grid; gap: 10px; margin-bottom: 25px;">
                        ${userResults.slice(0, 5).map(user => `
                            <div class="post-card" style="padding: 12px; display: flex; align-items: center; gap: 12px; cursor: pointer;" onclick="goToUserProfile(${user.id})">
                                <img src="${user.avatar}" alt="${user.username}" style="width: 40px; height: 40px; border-radius: 50%;">
                                <div>
                                    <strong>${user.displayName || user.username}</strong>
                                    <div style="color: var(--text-secondary); font-size: 12px;">@${user.username}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                ` : ''}

                ${postResults.length > 0 ? `
                    <h4 style="margin-bottom: 10px; color: var(--text-secondary);">Posts</h4>
                    <div>${postResults.map(post => createPostHTML(post)).join('')}</div>
                ` : ''}

                ${userResults.length === 0 && postResults.length === 0 ? `
                    <div class="post-card" style="padding: 40px; text-align: center;">
                        <i class="fas fa-search" style="font-size: 3em; color: var(--text-secondary); margin-bottom: 15px;"></i>
                        <h4>No results found</h4>
                        <p style="color: var(--text-secondary);">Try searching for users (@name), tags (#topic), or keywords</p>
                    </div>
                ` : ''}

                <button onclick="goToHome()" style="margin-top: 15px; background: var(--bg-input); border: 1px solid var(--border-color); padding: 8px 20px; border-radius: 10px; cursor: pointer; color: var(--text-primary);">
                    <i class="fas fa-arrow-left"></i> Back to Feed
                </button>
            </div>
        `;
    }
}

// 12. createCommunity - now shows a proper creation form
function createCommunity() {
    if (!currentUser) { showToast('Please log in first!'); return; }
    if (currentUser.honeyPoints < 200) {
        showToast(`You need 200 Honey Points to create a hive (you have ${currentUser.honeyPoints}).`);
        return;
    }

    const name = prompt(' Name your new Hive:');
    if (!name || !name.trim()) return;

    const description = prompt('Describe your Hive (what is it about?):');

    const colors = ['#FF69B4', '#87CEEB', '#9370DB', '#FF8C00', '#228B22', '#FFC30B'];
    const randomColor = colors[Math.floor(Math.random() * colors.length)];

    const newCommunity = {
        name: name.trim(),
        members: '1',
        icon: name.trim()[0].toUpperCase(),
        color: randomColor,
        description: description || 'A new hive in Polleneer!'
    };

    currentUser.honeyPoints -= 200;
    localStorage.setItem('polleneer_user', JSON.stringify(currentUser));

    showToast(` "${name}" hive created! -200 Honey Points`);
    goToCommunities();
}

// 13. joinCommunity - now properly handles join logic with visual feedback
function joinCommunity(name) {
    if (!currentUser) { showToast('Please log in first!'); return; }

    const joinedHives = JSON.parse(localStorage.getItem('polleneer_joined_hives') || '[]');

    if (joinedHives.includes(name)) {
        // Leave
        const idx = joinedHives.indexOf(name);
        joinedHives.splice(idx, 1);
        localStorage.setItem('polleneer_joined_hives', JSON.stringify(joinedHives));
        showToast(`Left ${name} hive`);
    } else {
        // Join
        joinedHives.push(name);
        localStorage.setItem('polleneer_joined_hives', JSON.stringify(joinedHives));
        currentUser.honeyPoints += 20;
        localStorage.setItem('polleneer_user', JSON.stringify(currentUser));
        showToast(` Joined ${name}! +20 Honey Points`);
    }

    goToCommunities();
}

// 14. manageFriends - now shows followers/following management
function manageFriends() {
    if (!currentUser) { showToast('Please log in first!'); return; }
    closeModal('profileMenuModal');

    const following = users.filter(u => u.id !== currentUser.id);

    document.getElementById('mainContent').innerHTML = `
        <div class="customization-panel" style="max-width: 700px; margin: 0 auto;">
            <h3 style="margin-bottom: 20px; color: var(--honey-yellow);"><i class="fas fa-users"></i> Friends & Connections</h3>

            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                <button id="tab-following" onclick="switchFriendsTab('following')" style="background: var(--honey-yellow); color: #000; border: none; padding: 8px 20px; border-radius: 20px; cursor: pointer; font-weight: bold;">
                    Following (${currentUser.following})
                </button>
                <button id="tab-followers" onclick="switchFriendsTab('followers')" style="background: var(--bg-input); border: 1px solid var(--border-color); padding: 8px 20px; border-radius: 20px; cursor: pointer; color: var(--text-primary);">
                    Followers (${currentUser.followers})
                </button>
            </div>

            <div id="friendsList" style="display: grid; gap: 10px;">
                ${following.map(user => `
                    <div class="post-card" style="padding: 15px; display: flex; align-items: center; gap: 15px;">
                        <img src="${user.avatar}" alt="${user.username}" style="width: 50px; height: 50px; border-radius: 50%; cursor: pointer;" onclick="goToUserProfile(${user.id})">
                        <div style="flex: 1; cursor: pointer;" onclick="goToUserProfile(${user.id})">
                            <strong>${user.displayName || user.username}</strong>
                            <div style="color: var(--text-secondary); font-size: 13px;">@${user.username}   ${user.honeyPoints}</div>
                        </div>
                        <button onclick="toggleFollow(${user.id})" style="background: var(--honey-yellow); color: #000; border: none; padding: 6px 15px; border-radius: 15px; cursor: pointer; font-size: 12px;">
                            Following
                        </button>
                    </div>
                `).join('')}
            </div>
        </div>
    `;
}

function switchFriendsTab(tab) {
    document.getElementById('tab-following').style.background = tab === 'following' ? 'var(--honey-yellow)' : 'var(--bg-input)';
    document.getElementById('tab-following').style.color = tab === 'following' ? '#000' : 'var(--text-primary)';
    document.getElementById('tab-followers').style.background = tab === 'followers' ? 'var(--honey-yellow)' : 'var(--bg-input)';
    document.getElementById('tab-followers').style.color = tab === 'followers' ? '#000' : 'var(--text-primary)';
    showToast(`Showing ${tab}`);
}

// 15. refreshSuggestions - now actually shuffles and reloads
function refreshSuggestions() {
    if (!currentUser) return;
    // Shuffle the users array
    const shuffled = users.filter(u => u.id !== currentUser.id).sort(() => Math.random() - 0.5);
    const suggestedUsers = document.getElementById('suggestedUsers');
    if (!suggestedUsers) { 
        showToast('Suggestions refreshed! '); 
        return; 
    }

    suggestedUsers.innerHTML = shuffled.slice(0, 4).map(user => `
        <div class="user-to-follow">
            <div class="follow-user-info" onclick="goToUserProfile(${user.id})">
                <img src="${user.avatar}" alt="${user.username}" class="follow-avatar">
                <div>
                    <div class="follow-name">${user.displayName || user.username}</div>
                    <div class="follow-username">@${user.username}</div>
                </div>
            </div>
            <button class="follow-btn" onclick="toggleFollow(${user.id})">Follow</button>
        </div>
    `).join('');

    showToast('Suggestions refreshed! ');
}

// 16. likeComment - now properly toggles like on comments
function likeComment(commentId, postId) {
    const likeBtn = document.querySelector(`[data-comment-like="${commentId}"]`);
    if (likeBtn) {
        const isLiked = likeBtn.classList.toggle('liked');
        const icon = likeBtn.querySelector('i') || likeBtn;
        if (isLiked) {
            likeBtn.style.color = 'var(--honey-yellow)';
            currentUser.honeyPoints += 1;
            showToast(' Liked comment!');
        } else {
            likeBtn.style.color = '';
            currentUser.honeyPoints -= 1;
        }
        localStorage.setItem('polleneer_user', JSON.stringify(currentUser));
    } else {
        showToast(' Liked comment!');
    }
}

// 17. showAdminPanel - now works for all users but restricts non-admins
function showAdminPanel() {
    if (!currentUser || (currentUser.role !== 'queen' && currentUser.role !== 'admin' && !isAdmin)) {
        showToast(' Admin access required. Only Queen/King Bees can access the admin panel.');
        return;
    }
    openModal('adminPanelModal');
}

// 18. showCustomization - now properly opens with modal management
function showCustomization() {
    closeModal('profileMenuModal');
    openModal('customizationModal');
    switchCustomizationTab('colors');
}

// 19. editProfile - now opens bio editor with pre-filled data
function editProfile() {
    if (!currentUser) return;
    closeModal('profileMenuModal');

    document.getElementById('bioText').value = currentUser.bio || '';
    openModal('bioModal');
}

// 20. goToUserProfile - now shows a full profile page for other users
function goToUserProfile(userId) {
    const user = users.find(u => u.id === userId);
    if (!user) { 
        showToast('User not found');
        return; 
    }

    // If viewing own profile, go to regular profile
    if (currentUser && user.id === currentUser.id) {
        goToProfile();
        return;
    }

    const userPosts = posts.filter(p => p.userId === user.id);
    const isFollowing = JSON.parse(localStorage.getItem('polleneer_following_' + currentUser.id) || '[]').includes(user.id);

    document.getElementById('mainContent').innerHTML = `
        <div class="profile-page">
            <div class="profile-banner" style="background: linear-gradient(135deg, var(--honey-yellow), var(--hive-orange)); height: 150px; border-radius: 15px; margin-bottom: -50px; position: relative;">
                <button onclick="goToHome()" style="position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.5); border: none; color: white; width: 35px; height: 35px; border-radius: 50%; cursor: pointer;">
                    <i class="fas fa-arrow-left"></i>
                </button>
            </div>

            <div style="padding: 0 20px;">
                <div style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 15px;">
                    <img src="${user.avatar}" alt="${user.username}" style="width: 90px; height: 90px; border-radius: 50%; border: 4px solid var(--bg-primary); position: relative; z-index: 1;">
                    <div style="display: flex; gap: 8px;">
                        <button onclick="showToast('Message feature coming soon!')" style="background: var(--bg-input); border: 1px solid var(--border-color); color: var(--text-primary); width: 35px; height: 35px; border-radius: 50%; cursor: pointer;">
                            <i class="fas fa-envelope"></i>
                        </button>
                        <button id="followBtn-${user.id}" onclick="toggleFollowUser(${user.id})" 
                            style="background: ${isFollowing ? 'transparent' : 'var(--honey-yellow)'}; 
                                   color: ${isFollowing ? 'var(--text-primary)' : '#000'}; 
                                   border: ${isFollowing ? '1px solid var(--border-color)' : 'none'}; 
                                   padding: 8px 20px; border-radius: 20px; cursor: pointer; font-weight: bold;">
                            ${isFollowing ? 'Following' : 'Follow'}
                        </button>
                    </div>
                </div>

                <h3 style="margin-bottom: 2px;">${user.displayName || user.username}</h3>
                <div style="color: var(--text-secondary); margin-bottom: 8px;">@${user.username}</div>
                <div style="display: inline-block; background: linear-gradient(135deg, var(--honey-yellow), var(--hive-orange)); padding: 3px 12px; border-radius: 10px; font-size: 12px; color: #000; font-weight: bold; margin-bottom: 10px;">
                    ${getRoleName(user.role)}
                </div>
                <p style="margin-bottom: 15px; line-height: 1.5;">${user.bio || ''}</p>

                <div style="display: flex; gap: 20px; margin-bottom: 20px; color: var(--text-secondary); font-size: 14px;">
                    <span><strong style="color: var(--text-primary);">${user.following}</strong> Following</span>
                    <span><strong style="color: var(--text-primary);">${user.followers}</strong> Followers</span>
                    <span> <strong style="color: var(--honey-yellow);">${user.honeyPoints.toLocaleString()}</strong></span>
                </div>
            </div>

            <div style="border-top: 1px solid var(--border-color); padding-top: 15px;">
                <h4 style="margin-bottom: 15px; padding: 0 20px; color: var(--text-secondary);">Posts (${userPosts.length})</h4>
                ${userPosts.length > 0 ? userPosts.map(post => createPostHTML(post)).join('') : 
                '<div style="padding: 40px; text-align: center; color: var(--text-secondary);">No posts yet</div>'}
            </div>
        </div>
    `;
}

function toggleFollowUser(userId) {
    const following = JSON.parse(localStorage.getItem('polleneer_following_' + currentUser.id) || '[]');
    const idx = following.indexOf(userId);
    const btn = document.getElementById('followBtn-' + userId);

    if (idx > -1) {
        following.splice(idx, 1);
        currentUser.following = Math.max(0, (currentUser.following || 0) - 1);
        if (btn) {
            btn.textContent = 'Follow';
            btn.style.background = 'var(--honey-yellow)';
            btn.style.color = '#000';
            btn.style.border = 'none';
        }
        showToast('Unfollowed');
    } else {
        following.push(userId);
        currentUser.following = (currentUser.following || 0) + 1;
        currentUser.honeyPoints += 5;
        if (btn) {
            btn.textContent = 'Following';
            btn.style.background = 'transparent';
            btn.style.color = 'var(--text-primary)';
            btn.style.border = '1px solid var(--border-color)';
        }
        showToast(' Following! +5 Honey Points');
    }

    localStorage.setItem('polleneer_following_' + currentUser.id, JSON.stringify(following));
    localStorage.setItem('polleneer_user', JSON.stringify(currentUser));
}

// BONUS: Fix showNotifications - was just an alert
function showNotifications() {
    if (!currentUser) return;

    const unreadCount = notifications.filter(n => !n.read).length;
    notifications.forEach(n => n.read = true);
    updateBadgeCounts();

    document.getElementById('mainContent').innerHTML = `
        <div class="customization-panel" style="max-width: 700px; margin: 0 auto;">
            <h3 style="margin-bottom: 20px; color: var(--honey-yellow);"><i class="fas fa-bell"></i> Notifications</h3>
            ${notifications.length > 0 ? notifications.map(n => `
                <div class="post-card" style="padding: 15px; margin-bottom: 8px; display: flex; align-items: center; gap: 12px; ${!n.read ? 'border-left: 3px solid var(--honey-yellow);' : ''}">
                    <i class="fas fa-${n.text.includes('liked') ? 'heart' : n.text.includes('pollinated') ? 'retweet' : n.text.includes('following') ? 'user-plus' : 'fire'}" 
                       style="color: var(--honey-yellow); font-size: 1.2em;"></i>
                    <div style="flex: 1;">
                        <div>${n.text}</div>
                        <div style="font-size: 12px; color: var(--text-secondary); margin-top: 3px;">${n.time}</div>
                    </div>
                </div>
            `).join('') : '<div class="post-card" style="padding: 30px; text-align: center; color: var(--text-secondary);">No notifications yet. Start buzzing! </div>'}
        </div>
    `;
}

// BONUS: Fix showMessages - was just an alert
function showMessages() {
    if (!currentUser) return;

    messages.forEach(m => m.unread = false);
    updateBadgeCounts();

    document.getElementById('mainContent').innerHTML = `
        <div class="customization-panel" style="max-width: 700px; margin: 0 auto;">
            <h3 style="margin-bottom: 20px; color: var(--honey-yellow);"><i class="fas fa-envelope"></i> Messages</h3>
            ${messages.length > 0 ? messages.map(m => `
                <div class="post-card" style="padding: 15px; margin-bottom: 8px; cursor: pointer; display: flex; align-items: center; gap: 15px;" onclick="showToast('Full messaging coming soon!')">
                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=${m.from}" alt="${m.from}" style="width: 45px; height: 45px; border-radius: 50%;">
                    <div style="flex: 1; min-width: 0;">
                        <div style="display: flex; justify-content: space-between;">
                            <strong>${m.from}</strong>
                            <span style="font-size: 12px; color: var(--text-secondary);">${m.time}</span>
                        </div>
                        <div style="color: var(--text-secondary); font-size: 13px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${m.text}</div>
                    </div>
                    ${m.unread ? '<div style="width: 8px; height: 8px; border-radius: 50%; background: var(--honey-yellow);"></div>' : ''}
                </div>
            `).join('') : '<div class="post-card" style="padding: 30px; text-align: center; color: var(--text-secondary);">No messages yet. Connect with the hive! </div>'}

            <div style="text-align: center; margin-top: 20px;">
                <button onclick="showToast('Full DM system coming in Phase 2!')" style="background: var(--honey-yellow); color: #000; border: none; padding: 10px 25px; border-radius: 20px; cursor: pointer; font-weight: bold;">
                    <i class="fas fa-pen"></i> New Message
                </button>
            </div>
        </div>
    `;
}

// Wire up the search input with Enter key
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(function() {
        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
            searchInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    handleSearch();
                }
            });
        }
    }, 2000);
});





// ============================================
// PHASE 2: Missing X/Twitter Features
// ============================================

// ===== ENHANCED POST COMPOSER =====
// Add GIF, Sticker, Emoji, and Location buttons to the create post modal

// GIF Search using Tenor/GIPHY-style interface
function showGifPicker() {
    const container = document.getElementById('postMediaContainer') || document.createElement('div');

    const gifModal = document.createElement('div');
    gifModal.id = 'gifPickerOverlay';
    gifModal.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);z-index:10000;display:flex;align-items:center;justify-content:center;';
    gifModal.onclick = function(e) { if(e.target === gifModal) gifModal.remove(); };

    gifModal.innerHTML = `
        <div style="background:var(--bg-card);border-radius:15px;width:90%;max-width:500px;max-height:80vh;overflow:hidden;display:flex;flex-direction:column;">
            <div style="padding:15px;border-bottom:1px solid var(--border-color);display:flex;justify-content:space-between;align-items:center;">
                <h3 style="color:var(--honey-yellow);"><i class="fas fa-film"></i> GIFs</h3>
                <button onclick="document.getElementById('gifPickerOverlay').remove()" style="background:none;border:none;color:var(--text-primary);font-size:1.5em;cursor:pointer;">&times;</button>
            </div>
            <div style="padding:10px;">
                <input type="text" id="gifSearchInput" placeholder="Search GIFs..." oninput="searchGifs(this.value)" 
                    style="width:100%;padding:10px 15px;border-radius:20px;border:1px solid var(--border-color);background:var(--bg-input);color:var(--text-primary);font-size:14px;">
            </div>
            <div id="gifResults" style="padding:10px;overflow-y:auto;display:grid;grid-template-columns:repeat(2,1fr);gap:8px;max-height:50vh;">
                ${getDefaultGifs()}
            </div>
        </div>
    `;

    document.body.appendChild(gifModal);
    document.getElementById('gifSearchInput').focus();
}

function getDefaultGifs() {
    // Curated bee-themed and popular GIF URLs (using static URLs for demo)
    const gifs = [
        { url: 'https://media.giphy.com/media/3o7TKSjRrfIPjeiVyM/giphy.gif', alt: 'Bee flying' },
        { url: 'https://media.giphy.com/media/l0HlNaQ6gWfllcjDO/giphy.gif', alt: 'Celebration' },
        { url: 'https://media.giphy.com/media/xUPGGDNsLvqsBOhuU0/giphy.gif', alt: 'Dancing' },
        { url: 'https://media.giphy.com/media/l4pTfx2qLszoacZRS/giphy.gif', alt: 'Thumbs up' },
        { url: 'https://media.giphy.com/media/3ohzdIuqJoo8QdKlnW/giphy.gif', alt: 'Laughing' },
        { url: 'https://media.giphy.com/media/l0MYt5jPR6QX5APm0/giphy.gif', alt: 'Mind blown' },
        { url: 'https://media.giphy.com/media/xT0xeJpnrWC3XWblEk/giphy.gif', alt: 'Fire' },
        { url: 'https://media.giphy.com/media/l41YtZOb9EUABnuqA/giphy.gif', alt: 'Wow' },
        { url: 'https://media.giphy.com/media/3oKIPnAiaMCws8nOsE/giphy.gif', alt: 'Cat' },
        { url: 'https://media.giphy.com/media/xT9IgG50Fb7Mi0prBC/giphy.gif', alt: 'Applause' },
        { url: 'https://media.giphy.com/media/l0HlBO7eyXzSZkJri/giphy.gif', alt: 'Love' },
        { url: 'https://media.giphy.com/media/26ufdipQqU2lhNA4g/giphy.gif', alt: 'Party' },
    ];

    return gifs.map(g => `
        <img src="${g.url}" alt="${g.alt}" 
            style="width:100%;border-radius:10px;cursor:pointer;object-fit:cover;height:120px;" 
            loading="lazy"
            onclick="selectGif('${g.url}')"
            onerror="this.style.display='none'">
    `).join('');
}

function searchGifs(query) {
    const results = document.getElementById('gifResults');
    if (!query.trim()) {
        results.innerHTML = getDefaultGifs();
        return;
    }
    results.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:20px;color:var(--text-secondary);">Searching for "' + query + '"...<br><small>Full GIF API integration coming with backend (Phase 3)</small></div>' + getDefaultGifs();
}

function selectGif(url) {
    const preview = document.getElementById('mediaPreview');
    if (preview) {
        preview.style.display = 'block';
        preview.innerHTML = `
            <div style="position:relative;display:inline-block;">
                <img src="${url}" style="max-width:100%;border-radius:10px;max-height:200px;">
                <button onclick="removeMedia()" style="position:absolute;top:5px;right:5px;background:rgba(0,0,0,0.7);border:none;color:white;width:25px;height:25px;border-radius:50%;cursor:pointer;">&times;</button>
            </div>
        `;
    }
    const overlay = document.getElementById('gifPickerOverlay');
    if (overlay) overlay.remove();
    showToast('GIF added! ');
}

function removeMedia() {
    const preview = document.getElementById('mediaPreview');
    if (preview) {
        preview.style.display = 'none';
        preview.innerHTML = '';
    }
}

// Sticker Picker
function showStickerPicker() {
    const stickerModal = document.createElement('div');
    stickerModal.id = 'stickerPickerOverlay';
    stickerModal.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);z-index:10000;display:flex;align-items:center;justify-content:center;';
    stickerModal.onclick = function(e) { if(e.target === stickerModal) stickerModal.remove(); };

    const beeStickers = [
        { emoji: '', name: 'Bee' }, { emoji: '', name: 'Honey' }, { emoji: '', name: 'Flower' },
        { emoji: '', name: 'Sunflower' }, { emoji: '', name: 'Bug' }, { emoji: '', name: 'Butterfly' },
        { emoji: '', name: 'Hibiscus' }, { emoji: '', name: 'Tulip' }, { emoji: '', name: 'Lavender' },
        { emoji: '', name: 'Blossom' }, { emoji: '', name: 'Rosette' }, { emoji: '', name: 'Bouquet' },
        { emoji: '', name: 'Plant' }, { emoji: '', name: 'Herb' }, { emoji: '', name: 'Leaf' },
        { emoji: '', name: 'Rice' }, { emoji: '', name: 'Nest' }, { emoji: '', name: 'Lady Bug' },
    ];

    const funStickers = [
        { emoji: '', name: 'Star' }, { emoji: '', name: 'Sparkles' }, { emoji: '', name: 'Dizzy' },
        { emoji: '', name: 'Fire' }, { emoji: '', name: 'Yellow Heart' }, { emoji: '', name: 'Orange Heart' },
        { emoji: '', name: 'Crown' }, { emoji: '', name: 'Trophy' }, { emoji: '', name: 'Bullseye' },
        { emoji: '', name: 'Strong' }, { emoji: '', name: 'Rocket' }, { emoji: '', name: 'Lightning' },
        { emoji: '', name: 'Party' }, { emoji: '', name: 'Confetti' }, { emoji: '', name: 'Celebrate' },
        { emoji: '', name: 'Cool' }, { emoji: '', name: 'Starstruck' }, { emoji: '', name: '100' },
    ];

    stickerModal.innerHTML = `
        <div style="background:var(--bg-card);border-radius:15px;width:90%;max-width:400px;max-height:70vh;overflow:hidden;">
            <div style="padding:15px;border-bottom:1px solid var(--border-color);display:flex;justify-content:space-between;align-items:center;">
                <h3 style="color:var(--honey-yellow);"><i class="fas fa-note-sticky"></i> Stickers</h3>
                <button onclick="document.getElementById('stickerPickerOverlay').remove()" style="background:none;border:none;color:var(--text-primary);font-size:1.5em;cursor:pointer;">&times;</button>
            </div>
            <div style="padding:15px;overflow-y:auto;max-height:55vh;">
                <h4 style="margin-bottom:10px;color:var(--honey-yellow);font-size:13px;"> BEE HIVE</h4>
                <div style="display:grid;grid-template-columns:repeat(6,1fr);gap:5px;margin-bottom:20px;">
                    ${beeStickers.map(s => `<button onclick="insertSticker('${s.emoji}')" title="${s.name}" style="font-size:28px;padding:8px;background:var(--bg-input);border:1px solid transparent;border-radius:10px;cursor:pointer;transition:all 0.2s;" onmouseover="this.style.borderColor='var(--honey-yellow)';this.style.transform='scale(1.2)'" onmouseout="this.style.borderColor='transparent';this.style.transform='scale(1)'">${s.emoji}</button>`).join('')}
                </div>
                <h4 style="margin-bottom:10px;color:var(--honey-yellow);font-size:13px;"> POPULAR</h4>
                <div style="display:grid;grid-template-columns:repeat(6,1fr);gap:5px;">
                    ${funStickers.map(s => `<button onclick="insertSticker('${s.emoji}')" title="${s.name}" style="font-size:28px;padding:8px;background:var(--bg-input);border:1px solid transparent;border-radius:10px;cursor:pointer;transition:all 0.2s;" onmouseover="this.style.borderColor='var(--honey-yellow)';this.style.transform='scale(1.2)'" onmouseout="this.style.borderColor='transparent';this.style.transform='scale(1)'">${s.emoji}</button>`).join('')}
                </div>
            </div>
        </div>
    `;

    document.body.appendChild(stickerModal);
}

function insertSticker(emoji) {
    const textarea = document.getElementById('postContent');
    if (textarea) {
        const start = textarea.selectionStart;
        const end = textarea.selectionEnd;
        textarea.value = textarea.value.substring(0, start) + emoji + textarea.value.substring(end);
        textarea.selectionStart = textarea.selectionEnd = start + emoji.length;
        textarea.focus();
    }
    const overlay = document.getElementById('stickerPickerOverlay');
    if (overlay) overlay.remove();
}

// Emoji Picker (built-in, keyboard-style)
function showEmojiPicker() {
    const emojiModal = document.createElement('div');
    emojiModal.id = 'emojiPickerOverlay';
    emojiModal.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);z-index:10000;display:flex;align-items:center;justify-content:center;';
    emojiModal.onclick = function(e) { if(e.target === emojiModal) emojiModal.remove(); };

    const categories = {
        'Smileys': ['','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','',''],
        'Gestures': ['','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','',''],
        'Hearts': ['','','','','','','','','','','','','','','','','','','','',''],
        'Nature': ['','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','',''],
        'Objects': ['','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','',''],
    };

    emojiModal.innerHTML = `
        <div style="background:var(--bg-card);border-radius:15px;width:90%;max-width:420px;max-height:75vh;overflow:hidden;display:flex;flex-direction:column;">
            <div style="padding:15px;border-bottom:1px solid var(--border-color);display:flex;justify-content:space-between;align-items:center;">
                <h3 style="color:var(--honey-yellow);"><i class="fas fa-face-smile"></i> Emoji</h3>
                <button onclick="document.getElementById('emojiPickerOverlay').remove()" style="background:none;border:none;color:var(--text-primary);font-size:1.5em;cursor:pointer;">&times;</button>
            </div>
            <div style="padding:15px;overflow-y:auto;">
                ${Object.entries(categories).map(([cat, emojis]) => `
                    <h4 style="margin:10px 0 8px;color:var(--text-secondary);font-size:12px;text-transform:uppercase;">${cat}</h4>
                    <div style="display:flex;flex-wrap:wrap;gap:2px;">
                        ${emojis.map(e => `<button onclick="insertEmoji('${e}')" style="font-size:22px;padding:5px;background:none;border:none;cursor:pointer;border-radius:5px;transition:background 0.2s;" onmouseover="this.style.background='var(--bg-input)'" onmouseout="this.style.background='none'">${e}</button>`).join('')}
                    </div>
                `).join('')}
            </div>
        </div>
    `;

    document.body.appendChild(emojiModal);
}

function insertEmoji(emoji) {
    const textarea = document.getElementById('postContent');
    if (textarea) {
        const start = textarea.selectionStart;
        const end = textarea.selectionEnd;
        textarea.value = textarea.value.substring(0, start) + emoji + textarea.value.substring(end);
        textarea.selectionStart = textarea.selectionEnd = start + emoji.length;
        textarea.focus();
    }
}

// Location tagging
function showLocationPicker() {
    const location = prompt(' Add your location:');
    if (location && location.trim()) {
        const locationTag = document.createElement('div');
        locationTag.id = 'postLocation';
        locationTag.style.cssText = 'display:flex;align-items:center;gap:5px;padding:8px 12px;background:var(--bg-input);border-radius:20px;font-size:13px;color:var(--honey-yellow);margin-top:10px;width:fit-content;';
        locationTag.innerHTML = `<i class="fas fa-map-marker-alt"></i> ${location.trim()} <button onclick="this.parentElement.remove()" style="background:none;border:none;color:var(--text-secondary);cursor:pointer;margin-left:5px;">&times;</button>`;

        const textarea = document.getElementById('postContent');
        if (textarea && textarea.parentElement) {
            textarea.parentElement.appendChild(locationTag);
        }
        showToast(' Location added!');
    }
}

// Schedule post
function showSchedulePost() {
    const now = new Date();
    const min = now.toISOString().slice(0, 16);

    const scheduleModal = document.createElement('div');
    scheduleModal.id = 'schedulePostOverlay';
    scheduleModal.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);z-index:10000;display:flex;align-items:center;justify-content:center;';
    scheduleModal.onclick = function(e) { if(e.target === scheduleModal) scheduleModal.remove(); };

    scheduleModal.innerHTML = `
        <div style="background:var(--bg-card);border-radius:15px;padding:25px;width:90%;max-width:350px;">
            <h3 style="margin-bottom:15px;color:var(--honey-yellow);"><i class="fas fa-clock"></i> Schedule Buzz</h3>
            <input type="datetime-local" id="scheduleDateTime" min="${min}" 
                style="width:100%;padding:10px;border-radius:10px;border:1px solid var(--border-color);background:var(--bg-input);color:var(--text-primary);font-size:14px;margin-bottom:15px;">
            <div style="display:flex;gap:10px;">
                <button onclick="confirmSchedule()" style="flex:1;background:var(--honey-yellow);color:#000;border:none;padding:10px;border-radius:10px;cursor:pointer;font-weight:bold;">Schedule</button>
                <button onclick="document.getElementById('schedulePostOverlay').remove()" style="flex:1;background:var(--bg-input);border:1px solid var(--border-color);padding:10px;border-radius:10px;cursor:pointer;color:var(--text-primary);">Cancel</button>
            </div>
        </div>
    `;

    document.body.appendChild(scheduleModal);
}

function confirmSchedule() {
    const dt = document.getElementById('scheduleDateTime').value;
    if (!dt) { showToast('Please select a date and time'); return; }

    const scheduled = new Date(dt);
    const now = new Date();
    if (scheduled <= now) { showToast('Please select a future time'); return; }

    const diffMs = scheduled - now;
    const hours = Math.floor(diffMs / 3600000);
    const mins = Math.floor((diffMs % 3600000) / 60000);

    document.getElementById('schedulePostOverlay').remove();
    showToast(` Post scheduled for ${scheduled.toLocaleString()} (in ${hours}h ${mins}m)`);
}



// ===== ENHANCED NOTIFICATIONS =====
function showNotifications() {
    if (!currentUser) return;

    // Richer notification data
    if (notifications.length <= 4) {
        notifications = [
            { id: 1, type: 'like', text: 'FloraCreative liked your post', user: 'FloraCreative', time: '5m ago', read: false, postId: 1 },
            { id: 2, type: 'pollinate', text: 'TechWorker pollinated your idea', user: 'TechWorker', time: '12m ago', read: false, postId: 2 },
            { id: 3, type: 'follow', text: 'ScienceBee started following you', user: 'ScienceBee', time: '1h ago', read: true },
            { id: 4, type: 'trending', text: 'Your post is trending! ', time: '2h ago', read: true, postId: 1 },
            { id: 5, type: 'mention', text: 'ArtistBee mentioned you in a comment', user: 'ArtistBee', time: '3h ago', read: true, postId: 3 },
            { id: 6, type: 'like', text: 'GardenFairy and 3 others liked your post', user: 'GardenFairy', time: '5h ago', read: true, postId: 2 },
            { id: 7, type: 'honey', text: 'You earned 200 Honey Points this week! ', time: '1d ago', read: true },
            { id: 8, type: 'system', text: 'Welcome to Polleneer! Complete your profile for +100 points', time: '2d ago', read: true },
        ];
    }

    notifications.forEach(n => n.read = true);
    updateBadgeCounts();

    const iconMap = { like: 'fa-heart', pollinate: 'fa-retweet', follow: 'fa-user-plus', trending: 'fa-fire', mention: 'fa-at', honey: 'fa-coins', system: 'fa-bell', comment: 'fa-comment' };
    const colorMap = { like: '#FF6B6B', pollinate: '#4ECDC4', follow: '#45B7D1', trending: '#FF8C00', mention: '#9B59B6', honey: '#FFC30B', system: '#87CEEB', comment: '#2ECC71' };

    document.getElementById('mainContent').innerHTML = `
        <div class="customization-panel" style="max-width: 700px; margin: 0 auto;">
            <h3 style="margin-bottom: 5px; color: var(--honey-yellow);"><i class="fas fa-bell"></i> Notifications</h3>
            <div style="display:flex;gap:10px;margin-bottom:20px;border-bottom:1px solid var(--border-color);padding-bottom:15px;">
                <button id="notif-tab-all" onclick="filterNotifications('all')" style="background:var(--honey-yellow);color:#000;border:none;padding:6px 18px;border-radius:20px;cursor:pointer;font-weight:bold;font-size:13px;">All</button>
                <button id="notif-tab-mentions" onclick="filterNotifications('mention')" style="background:var(--bg-input);border:1px solid var(--border-color);padding:6px 18px;border-radius:20px;cursor:pointer;font-size:13px;color:var(--text-primary);">Mentions</button>
                <button id="notif-tab-likes" onclick="filterNotifications('like')" style="background:var(--bg-input);border:1px solid var(--border-color);padding:6px 18px;border-radius:20px;cursor:pointer;font-size:13px;color:var(--text-primary);">Likes</button>
            </div>
            <div id="notificationsList">
                ${notifications.map(n => `
                    <div class="post-card" style="padding:14px;margin-bottom:8px;display:flex;align-items:center;gap:14px;cursor:pointer;transition:background 0.2s;" 
                         onmouseover="this.style.background='var(--bg-input)'" onmouseout="this.style.background=''"
                         onclick="${n.postId ? `viewThread(${n.postId})` : n.user ? `searchUser('${n.user}')` : ''}" data-notif-type="${n.type}">
                        <div style="width:40px;height:40px;border-radius:50%;background:${colorMap[n.type] || '#666'};display:flex;align-items:center;justify-content:center;flex-shrink:0;">
                            <i class="fas ${iconMap[n.type] || 'fa-bell'}" style="color:white;"></i>
                        </div>
                        <div style="flex:1;min-width:0;">
                            <div style="line-height:1.4;">${n.text}</div>
                            <div style="font-size:12px;color:var(--text-secondary);margin-top:3px;">${n.time}</div>
                        </div>
                        ${!n.read ? '<div style="width:8px;height:8px;border-radius:50%;background:var(--honey-yellow);flex-shrink:0;"></div>' : ''}
                    </div>
                `).join('')}
            </div>
        </div>
    `;
}

function filterNotifications(type) {
    ['all','mentions','likes'].forEach(t => {
        const btn = document.getElementById(`notif-tab-${t}`);
        if(btn) { btn.style.background = 'var(--bg-input)'; btn.style.color = 'var(--text-primary)'; }
    });
    const activeTab = document.getElementById(`notif-tab-${type === 'mention' ? 'mentions' : type === 'like' ? 'likes' : 'all'}`);
    if(activeTab) { activeTab.style.background = 'var(--honey-yellow)'; activeTab.style.color = '#000'; }

    const items = document.querySelectorAll('[data-notif-type]');
    items.forEach(item => {
        item.style.display = (type === 'all' || item.dataset.notifType === type) ? 'flex' : 'none';
    });
}

// ===== THREAD / REPLY VIEW =====
function viewThread(postId) {
    const post = posts.find(p => p.id === postId);
    if (!post) { showToast('Post not found'); return; }

    const user = users.find(u => u.id === post.userId);
    if (!user) return;

    const postComments = comments[postId] || SAMPLE_COMMENTS[postId] || [];

    document.getElementById('mainContent').innerHTML = `
        <div style="max-width:700px;margin:0 auto;">
            <div style="display:flex;align-items:center;gap:15px;margin-bottom:20px;padding:10px 0;">
                <button onclick="goToHome()" style="background:none;border:none;color:var(--text-primary);cursor:pointer;font-size:1.2em;"><i class="fas fa-arrow-left"></i></button>
                <h3>Thread</h3>
            </div>

            <!-- Main post (expanded) -->
            <div class="post-card" style="padding:20px;">
                <div style="display:flex;gap:12px;margin-bottom:15px;">
                    <img src="${user.avatar}" alt="${user.username}" style="width:48px;height:48px;border-radius:50%;cursor:pointer;" onclick="goToUserProfile(${user.id})">
                    <div>
                        <div style="display:flex;align-items:center;gap:8px;">
                            <strong style="cursor:pointer;" onclick="goToUserProfile(${user.id})">${user.displayName || user.username}</strong>
                            ${user.role === 'queen' || user.role === 'admin' ? '<i class="fas fa-check-circle" style="color:var(--honey-yellow);font-size:14px;" title="Verified"></i>' : ''}
                            <span class="user-role-badge" style="font-size:11px;">${getRoleName(user.role)}</span>
                        </div>
                        <div style="color:var(--text-secondary);font-size:13px;">@${user.username}</div>
                    </div>
                </div>

                <div style="font-size:16px;line-height:1.6;margin-bottom:15px;">${formatPostContent(post.content)}</div>

                ${post.tags && post.tags.length > 0 ? `<div style="margin-bottom:12px;">${post.tags.map(t => `<span style="color:var(--honey-yellow);cursor:pointer;margin-right:8px;" onclick="searchTag('${t}')">${t}</span>`).join('')}</div>` : ''}

                ${post.media ? `<img src="${post.media}" style="width:100%;border-radius:12px;margin-bottom:15px;max-height:400px;object-fit:cover;">` : ''}

                <div style="color:var(--text-secondary);font-size:13px;padding:12px 0;border-top:1px solid var(--border-color);border-bottom:1px solid var(--border-color);">
                    ${post.createdAt}  <span style="color:var(--text-primary);font-weight:bold;">${(post.views || 0).toLocaleString()}</span> Views
                </div>

                <div style="display:flex;gap:20px;padding:12px 0;border-bottom:1px solid var(--border-color);font-size:14px;">
                    <span><strong>${post.pollinations || 0}</strong> <span style="color:var(--text-secondary);">Pollinations</span></span>
                    <span><strong>${post.likes || 0}</strong> <span style="color:var(--text-secondary);">Likes</span></span>
                    <span><strong>${postComments.length}</strong> <span style="color:var(--text-secondary);">Replies</span></span>
                </div>

                <div style="display:flex;justify-content:space-around;padding:8px 0;border-bottom:1px solid var(--border-color);">
                    <button onclick="toggleComments(${post.id})" style="background:none;border:none;color:var(--text-secondary);cursor:pointer;padding:8px;border-radius:50%;transition:color 0.2s;" onmouseover="this.style.color='var(--sky-blue)'" onmouseout="this.style.color='var(--text-secondary)'"><i class="far fa-comment"></i></button>
                    <button onclick="pollinatePost(${post.id})" style="background:none;border:none;color:${post.isPollinated ? 'var(--leaf-green)' : 'var(--text-secondary)'};cursor:pointer;padding:8px;border-radius:50%;"><i class="${post.isPollinated ? 'fas' : 'far'} fa-retweet"></i></button>
                    <button onclick="quotePollinate(${post.id})" style="background:none;border:none;color:var(--text-secondary);cursor:pointer;padding:8px;border-radius:50%;" onmouseover="this.style.color='var(--honey-yellow)'" onmouseout="this.style.color='var(--text-secondary)'" title="Quote Pollinate"><i class="fas fa-quote-left"></i></button>
                    <button onclick="likePost(${post.id})" style="background:none;border:none;color:${post.isLiked ? '#FF6B6B' : 'var(--text-secondary)'};cursor:pointer;padding:8px;border-radius:50%;"><i class="${post.isLiked ? 'fas' : 'far'} fa-heart"></i></button>
                    <button onclick="sharePost(${post.id})" style="background:none;border:none;color:var(--text-secondary);cursor:pointer;padding:8px;border-radius:50%;" onmouseover="this.style.color='var(--sky-blue)'" onmouseout="this.style.color='var(--text-secondary)'"><i class="fas fa-share-from-square"></i></button>
                </div>
            </div>

            <!-- Reply composer -->
            <div class="post-card" style="padding:15px;margin-top:2px;display:flex;gap:12px;">
                <img src="${currentUser.avatar}" alt="You" style="width:36px;height:36px;border-radius:50%;">
                <div style="flex:1;">
                    <textarea id="thread-reply-input" placeholder="Post your reply..." style="width:100%;background:transparent;border:none;color:var(--text-primary);resize:none;font-size:15px;min-height:50px;outline:none;font-family:inherit;"></textarea>
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px;">
                        <div style="display:flex;gap:12px;">
                            <button onclick="document.getElementById('mediaUpload').click()" style="background:none;border:none;color:var(--honey-yellow);cursor:pointer;"><i class="fas fa-image"></i></button>
                            <button onclick="showGifPicker()" style="background:none;border:none;color:var(--honey-yellow);cursor:pointer;font-weight:bold;font-size:13px;">GIF</button>
                            <button onclick="showEmojiPicker()" style="background:none;border:none;color:var(--honey-yellow);cursor:pointer;"><i class="fas fa-face-smile"></i></button>
                        </div>
                        <button onclick="submitThreadReply(${post.id})" style="background:var(--honey-yellow);color:#000;border:none;padding:8px 20px;border-radius:20px;cursor:pointer;font-weight:bold;font-size:13px;">Reply</button>
                    </div>
                </div>
            </div>

            <!-- Replies -->
            <div id="threadReplies" style="margin-top:2px;">
                ${postComments.map(c => {
                    const commenter = users.find(u => u.id === c.userId) || { username: 'Unknown', displayName: 'Unknown', avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Unknown' };
                    return `
                        <div class="post-card" style="padding:15px;margin-top:2px;display:flex;gap:12px;">
                            <img src="${commenter.avatar}" alt="${commenter.username}" style="width:36px;height:36px;border-radius:50%;cursor:pointer;" onclick="goToUserProfile(${c.userId})">
                            <div style="flex:1;">
                                <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px;">
                                    <strong style="font-size:14px;cursor:pointer;" onclick="goToUserProfile(${c.userId})">${commenter.displayName || commenter.username}</strong>
                                    <span style="color:var(--text-secondary);font-size:13px;">@${commenter.username}  ${c.createdAt}</span>
                                </div>
                                <div style="line-height:1.5;margin-bottom:8px;">${c.text}</div>
                                <div style="display:flex;gap:20px;">
                                    <button onclick="likeComment(${c.id}, ${post.id})" data-comment-like="${c.id}" style="background:none;border:none;color:var(--text-secondary);cursor:pointer;font-size:13px;"><i class="far fa-heart"></i> Like</button>
                                    <button onclick="replyToComment(${post.id}, ${c.id})" style="background:none;border:none;color:var(--text-secondary);cursor:pointer;font-size:13px;"><i class="far fa-comment"></i> Reply</button>
                                    <button onclick="pollinatePost(${post.id})" style="background:none;border:none;color:var(--text-secondary);cursor:pointer;font-size:13px;"><i class="far fa-retweet"></i></button>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('')}

                ${postComments.length === 0 ? '<div class="post-card" style="padding:30px;margin-top:2px;text-align:center;color:var(--text-secondary);">No replies yet. Be the first to buzz! </div>' : ''}
            </div>
        </div>
    `;
}

function submitThreadReply(postId) {
    const input = document.getElementById('thread-reply-input');
    if (!input) return;
    const text = input.value.trim();
    if (!text) { showToast('Write something first!'); return; }

    if (!comments[postId]) comments[postId] = [];
    const newComment = { id: Date.now(), userId: currentUser.id, text: text, createdAt: 'Just now' };
    comments[postId].push(newComment);

    const post = posts.find(p => p.id === postId);
    if (post) post.comments += 1;

    currentUser.honeyPoints += 10;
    localStorage.setItem('polleneer_user', JSON.stringify(currentUser));

    showToast('Reply posted! +10 Honey Points ');
    viewThread(postId);
}

// ===== QUOTE POLLINATION (Quote Retweet) =====
function quotePollinate(postId) {
    const post = posts.find(p => p.id === postId);
    if (!post) return;
    const user = users.find(u => u.id === post.userId);
    if (!user) return;

    const quoteModal = document.createElement('div');
    quoteModal.id = 'quotePollinateOverlay';
    quoteModal.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);z-index:10000;display:flex;align-items:center;justify-content:center;';
    quoteModal.onclick = function(e) { if(e.target === quoteModal) quoteModal.remove(); };

    quoteModal.innerHTML = `
        <div style="background:var(--bg-card);border-radius:15px;width:90%;max-width:550px;overflow:hidden;">
            <div style="padding:15px;border-bottom:1px solid var(--border-color);display:flex;justify-content:space-between;align-items:center;">
                <h3 style="color:var(--honey-yellow);"><i class="fas fa-quote-left"></i> Quote Pollinate</h3>
                <button onclick="document.getElementById('quotePollinateOverlay').remove()" style="background:none;border:none;color:var(--text-primary);font-size:1.5em;cursor:pointer;">&times;</button>
            </div>
            <div style="padding:15px;">
                <div style="display:flex;gap:12px;margin-bottom:12px;">
                    <img src="${currentUser.avatar}" style="width:40px;height:40px;border-radius:50%;">
                    <textarea id="quoteText" placeholder="Add your thoughts..." style="flex:1;background:transparent;border:none;color:var(--text-primary);resize:none;font-size:15px;min-height:60px;outline:none;font-family:inherit;"></textarea>
                </div>

                <!-- Quoted post preview -->
                <div style="border:1px solid var(--border-color);border-radius:12px;padding:12px;margin-bottom:15px;">
                    <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
                        <img src="${user.avatar}" style="width:20px;height:20px;border-radius:50%;">
                        <strong style="font-size:13px;">${user.displayName || user.username}</strong>
                        <span style="color:var(--text-secondary);font-size:12px;">@${user.username}  ${post.createdAt}</span>
                    </div>
                    <div style="font-size:13px;color:var(--text-secondary);line-height:1.4;">${post.content.substring(0, 150)}${post.content.length > 150 ? '...' : ''}</div>
                </div>

                <div style="display:flex;justify-content:flex-end;">
                    <button onclick="submitQuotePollination(${postId})" style="background:var(--honey-yellow);color:#000;border:none;padding:10px 25px;border-radius:20px;cursor:pointer;font-weight:bold;">Pollinate</button>
                </div>
            </div>
        </div>
    `;

    document.body.appendChild(quoteModal);
    document.getElementById('quoteText').focus();
}

function submitQuotePollination(postId) {
    const quoteText = document.getElementById('quoteText').value.trim();
    const originalPost = posts.find(p => p.id === postId);
    if (!originalPost) return;
    const originalUser = users.find(u => u.id === originalPost.userId);

    const newPost = {
        id: posts.length + 100,
        userId: currentUser.id,
        content: quoteText ? quoteText + '\n\n' : '',
        quotedPost: { postId: postId, content: originalPost.content.substring(0, 200), username: originalUser ? originalUser.username : 'Unknown', avatar: originalUser ? originalUser.avatar : '' },
        tags: [],
        likes: 0, comments: 0, pollinations: 0, views: 0,
        createdAt: 'Just now',
        isLiked: false, isPollinated: false
    };

    posts.unshift(newPost);
    originalPost.pollinations += 1;

    currentUser.honeyPoints += 15;
    localStorage.setItem('polleneer_user', JSON.stringify(currentUser));

    document.getElementById('quotePollinateOverlay').remove();
    showToast(' Quote pollinated! +15 Honey Points');

    if (currentPage === 'home') goToHome();
}

// ===== ANALYTICS DASHBOARD =====
function showAnalytics() {
    if (!currentUser) return;

    const myPosts = posts.filter(p => p.userId === currentUser.id);
    const totalLikes = myPosts.reduce((sum, p) => sum + (p.likes || 0), 0);
    const totalViews = myPosts.reduce((sum, p) => sum + (p.views || 0), 0);
    const totalPollinations = myPosts.reduce((sum, p) => sum + (p.pollinations || 0), 0);
    const totalComments = myPosts.reduce((sum, p) => sum + (p.comments || 0), 0);
    const engagementRate = totalViews > 0 ? (((totalLikes + totalComments + totalPollinations) / totalViews) * 100).toFixed(1) : 0;

    document.getElementById('mainContent').innerHTML = `
        <div class="customization-panel" style="max-width:800px;margin:0 auto;">
            <h3 style="margin-bottom:25px;color:var(--honey-yellow);"><i class="fas fa-chart-line"></i> Analytics Dashboard</h3>

            <!-- Key Metrics -->
            <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:12px;margin-bottom:25px;">
                ${[
                    { label: 'Total Views', value: totalViews.toLocaleString(), icon: 'fa-eye', color: '#87CEEB' },
                    { label: 'Total Likes', value: totalLikes.toLocaleString(), icon: 'fa-heart', color: '#FF6B6B' },
                    { label: 'Pollinations', value: totalPollinations.toLocaleString(), icon: 'fa-retweet', color: '#4ECDC4' },
                    { label: 'Comments', value: totalComments.toLocaleString(), icon: 'fa-comment', color: '#9B59B6' },
                    { label: 'Engagement', value: engagementRate + '%', icon: 'fa-chart-pie', color: '#FF8C00' },
                    { label: 'Honey Earned', value: currentUser.honeyPoints.toLocaleString(), icon: 'fa-coins', color: '#FFC30B' },
                ].map(m => `
                    <div class="post-card" style="padding:18px;text-align:center;">
                        <i class="fas ${m.icon}" style="font-size:1.5em;color:${m.color};margin-bottom:8px;"></i>
                        <div style="font-size:24px;font-weight:bold;margin-bottom:4px;">${m.value}</div>
                        <div style="font-size:12px;color:var(--text-secondary);">${m.label}</div>
                    </div>
                `).join('')}
            </div>

            <!-- Engagement Bar Chart -->
            <div class="post-card" style="padding:20px;margin-bottom:15px;">
                <h4 style="margin-bottom:15px;">Post Performance</h4>
                ${myPosts.length > 0 ? myPosts.slice(0, 5).map((p, i) => {
                    const maxLikes = Math.max(...myPosts.map(pp => pp.likes || 1));
                    const barWidth = ((p.likes || 0) / maxLikes * 100);
                    return `
                        <div style="margin-bottom:12px;cursor:pointer;" onclick="viewThread(${p.id})">
                            <div style="display:flex;justify-content:space-between;font-size:13px;margin-bottom:4px;">
                                <span style="overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:70%;">${p.content.substring(0, 50)}...</span>
                                <span style="color:var(--text-secondary);">${p.likes} </span>
                            </div>
                            <div style="background:var(--bg-input);border-radius:5px;height:8px;overflow:hidden;">
                                <div style="background:linear-gradient(90deg,var(--honey-yellow),var(--hive-orange));height:100%;width:${barWidth}%;border-radius:5px;transition:width 0.5s;"></div>
                            </div>
                        </div>
                    `;
                }).join('') : '<div style="text-align:center;color:var(--text-secondary);padding:20px;">Create your first post to see analytics!</div>'}
            </div>

            <!-- Follower Growth -->
            <div class="post-card" style="padding:20px;">
                <h4 style="margin-bottom:15px;">Profile Stats</h4>
                <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:15px;text-align:center;">
                    <div>
                        <div style="font-size:28px;font-weight:bold;color:var(--honey-yellow);">${currentUser.followers}</div>
                        <div style="font-size:12px;color:var(--text-secondary);">Followers</div>
                    </div>
                    <div>
                        <div style="font-size:28px;font-weight:bold;color:var(--hive-orange);">${currentUser.following}</div>
                        <div style="font-size:12px;color:var(--text-secondary);">Following</div>
                    </div>
                    <div>
                        <div style="font-size:28px;font-weight:bold;color:var(--leaf-green);">${myPosts.length}</div>
                        <div style="font-size:12px;color:var(--text-secondary);">Posts</div>
                    </div>
                </div>
            </div>
        </div>
    `;
}



// ===== VERIFIED BADGES =====
// Override createPostHTML to add verified badges and quote pollination support
const _originalCreatePostHTML = createPostHTML;
function createPostHTML(post) {
    let html = _originalCreatePostHTML(post);

    // Add verified badge for queen/admin users
    const user = users.find(u => u.id === post.userId);
    if (user && (user.role === 'queen' || user.role === 'admin')) {
        html = html.replace(
            `<span class="user-role-badge">${getRoleName(user.role)}</span>`,
            `<i class="fas fa-check-circle" style="color:var(--honey-yellow);font-size:13px;" title="Verified Bee"></i> <span class="user-role-badge">${getRoleName(user.role)}</span>`
        );
    }

    // If this post has a quoted post, add the quote card
    if (post.quotedPost) {
        const quoteHTML = `
            <div style="border:1px solid var(--border-color);border-radius:12px;padding:12px;margin:10px 0;cursor:pointer;" onclick="viewThread(${post.quotedPost.postId})">
                <div style="display:flex;align-items:center;gap:6px;margin-bottom:6px;">
                    <img src="${post.quotedPost.avatar}" style="width:18px;height:18px;border-radius:50%;">
                    <span style="font-size:12px;font-weight:bold;">@${post.quotedPost.username}</span>
                </div>
                <div style="font-size:13px;color:var(--text-secondary);line-height:1.3;">${post.quotedPost.content}${post.quotedPost.content.length >= 200 ? '...' : ''}</div>
            </div>
        `;
        // Insert before the post stats
        html = html.replace('class="post-stats"', 'class="quoted-inject"></div>' + quoteHTML + '<div class="post-stats"');
    }

    // Make posts clickable to view thread
    html = html.replace(
        `<div class="post-content"`,
        `<div class="post-content" onclick="viewThread(${post.id})" style="cursor:pointer;"`
    );

    return html;
}

// ===== USER LISTS =====
function showLists() {
    if (!currentUser) return;

    const savedLists = JSON.parse(localStorage.getItem('polleneer_lists_' + currentUser.id) || '[]');

    // Default lists if none exist
    if (savedLists.length === 0) {
        savedLists.push(
            { id: 1, name: 'Favorite Bees', description: 'My top pollinating friends', members: [2, 3], isPrivate: false },
            { id: 2, name: 'Tech Hive', description: 'Tech-focused bees', members: [3], isPrivate: false }
        );
        localStorage.setItem('polleneer_lists_' + currentUser.id, JSON.stringify(savedLists));
    }

    document.getElementById('mainContent').innerHTML = `
        <div class="customization-panel" style="max-width:700px;margin:0 auto;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                <h3 style="color:var(--honey-yellow);"><i class="fas fa-list"></i> Lists</h3>
                <button onclick="createNewList()" style="background:var(--honey-yellow);color:#000;border:none;padding:8px 18px;border-radius:20px;cursor:pointer;font-weight:bold;font-size:13px;">
                    <i class="fas fa-plus"></i> New List
                </button>
            </div>

            <div style="display:grid;gap:10px;">
                ${savedLists.map(list => `
                    <div class="post-card" style="padding:18px;cursor:pointer;transition:transform 0.2s;" 
                         onclick="viewList(${list.id})"
                         onmouseover="this.style.transform='translateX(5px)'" onmouseout="this.style.transform='none'">
                        <div style="display:flex;justify-content:space-between;align-items:start;">
                            <div>
                                <h4 style="margin-bottom:4px;">${list.name} ${list.isPrivate ? '<i class="fas fa-lock" style="font-size:12px;color:var(--text-secondary);"></i>' : ''}</h4>
                                <p style="font-size:13px;color:var(--text-secondary);margin-bottom:8px;">${list.description}</p>
                                <div style="display:flex;gap:5px;">
                                    ${list.members.slice(0, 3).map(mid => {
                                        const member = users.find(u => u.id === mid);
                                        return member ? `<img src="${member.avatar}" style="width:24px;height:24px;border-radius:50%;border:2px solid var(--bg-card);">` : '';
                                    }).join('')}
                                    ${list.members.length > 3 ? `<span style="font-size:12px;color:var(--text-secondary);padding-top:5px;">+${list.members.length - 3}</span>` : ''}
                                </div>
                            </div>
                            <span style="font-size:13px;color:var(--text-secondary);">${list.members.length} members</span>
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>
    `;
}

function createNewList() {
    const name = prompt('Name your new list:');
    if (!name || !name.trim()) return;
    const desc = prompt('Add a description (optional):') || '';

    const savedLists = JSON.parse(localStorage.getItem('polleneer_lists_' + currentUser.id) || '[]');
    savedLists.push({
        id: Date.now(),
        name: name.trim(),
        description: desc.trim(),
        members: [],
        isPrivate: false
    });
    localStorage.setItem('polleneer_lists_' + currentUser.id, JSON.stringify(savedLists));
    showToast(`List "${name}" created! `);
    showLists();
}

function viewList(listId) {
    const savedLists = JSON.parse(localStorage.getItem('polleneer_lists_' + currentUser.id) || '[]');
    const list = savedLists.find(l => l.id === listId);
    if (!list) return;

    const memberUsers = list.members.map(mid => users.find(u => u.id === mid)).filter(Boolean);
    const memberPosts = posts.filter(p => list.members.includes(p.userId));

    document.getElementById('mainContent').innerHTML = `
        <div style="max-width:700px;margin:0 auto;">
            <div style="display:flex;align-items:center;gap:15px;margin-bottom:20px;">
                <button onclick="showLists()" style="background:none;border:none;color:var(--text-primary);cursor:pointer;font-size:1.2em;"><i class="fas fa-arrow-left"></i></button>
                <div>
                    <h3>${list.name}</h3>
                    <span style="font-size:13px;color:var(--text-secondary);">${list.members.length} members  ${memberPosts.length} posts</span>
                </div>
            </div>

            <div style="display:flex;gap:8px;margin-bottom:20px;overflow-x:auto;padding-bottom:5px;">
                ${memberUsers.map(u => `
                    <div style="text-align:center;flex-shrink:0;cursor:pointer;" onclick="goToUserProfile(${u.id})">
                        <img src="${u.avatar}" style="width:45px;height:45px;border-radius:50%;border:2px solid var(--honey-yellow);">
                        <div style="font-size:11px;margin-top:3px;max-width:60px;overflow:hidden;text-overflow:ellipsis;">@${u.username}</div>
                    </div>
                `).join('')}
                <div style="text-align:center;flex-shrink:0;cursor:pointer;" onclick="addMemberToList(${list.id})">
                    <div style="width:45px;height:45px;border-radius:50%;border:2px dashed var(--border-color);display:flex;align-items:center;justify-content:center;color:var(--text-secondary);">
                        <i class="fas fa-plus"></i>
                    </div>
                    <div style="font-size:11px;margin-top:3px;color:var(--text-secondary);">Add</div>
                </div>
            </div>

            <div>
                ${memberPosts.length > 0 ? memberPosts.map(p => createPostHTML(p)).join('') : 
                '<div class="post-card" style="padding:30px;text-align:center;color:var(--text-secondary);">No posts from list members yet.</div>'}
            </div>
        </div>
    `;
}

function addMemberToList(listId) {
    const username = prompt('Enter username to add:');
    if (!username) return;
    const user = users.find(u => u.username.toLowerCase() === username.toLowerCase().replace('@', ''));
    if (!user) { showToast('User not found'); return; }

    const savedLists = JSON.parse(localStorage.getItem('polleneer_lists_' + currentUser.id) || '[]');
    const list = savedLists.find(l => l.id === listId);
    if (!list) return;

    if (list.members.includes(user.id)) { showToast('User already in list'); return; }
    list.members.push(user.id);
    localStorage.setItem('polleneer_lists_' + currentUser.id, JSON.stringify(savedLists));
    showToast(`Added @${user.username} to "${list.name}" `);
    viewList(listId);
}

// ===== ENHANCED DMs =====
function showMessages() {
    if (!currentUser) return;

    // Richer message data
    const conversations = [
        { id: 1, user: 'FloraCreative', userId: 2, avatar: users.find(u=>u.id===2)?.avatar || 'https://api.dicebear.com/7.x/avataaars/svg?seed=Flora', lastMessage: 'Hey! Loved your garden post! The cross-pollination idea is brilliant ', time: '10m ago', unread: 2 },
        { id: 2, user: 'TechWorker', userId: 3, avatar: users.find(u=>u.id===3)?.avatar || 'https://api.dicebear.com/7.x/avataaars/svg?seed=Tech', lastMessage: 'Can we collaborate on that algorithm? I have some ideas for the swarm optimization', time: '1h ago', unread: 1 },
        { id: 3, user: 'ScienceBee', userId: 4, avatar: users.find(u=>u.id===4)?.avatar || 'https://api.dicebear.com/7.x/avataaars/svg?seed=Science', lastMessage: 'The bee colony simulation results are fascinating!', time: '3h ago', unread: 0 },
        { id: 4, user: 'ArtistBee', userId: 5, avatar: users.find(u=>u.id===5)?.avatar || 'https://api.dicebear.com/7.x/avataaars/svg?seed=Artist', lastMessage: 'I designed a new hexagonal logo concept for Polleneer ', time: '1d ago', unread: 0 },
    ];

    document.getElementById('mainContent').innerHTML = `
        <div class="customization-panel" style="max-width:700px;margin:0 auto;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                <h3 style="color:var(--honey-yellow);"><i class="fas fa-envelope"></i> Messages</h3>
                <button onclick="newDirectMessage()" style="background:var(--honey-yellow);color:#000;border:none;padding:8px 18px;border-radius:20px;cursor:pointer;font-weight:bold;font-size:13px;">
                    <i class="fas fa-pen"></i> New
                </button>
            </div>

            <div style="margin-bottom:15px;">
                <input type="text" placeholder="Search messages..." style="width:100%;padding:10px 15px;border-radius:20px;border:1px solid var(--border-color);background:var(--bg-input);color:var(--text-primary);font-size:14px;">
            </div>

            <div style="display:grid;gap:2px;">
                ${conversations.map(c => `
                    <div class="post-card" style="padding:15px;display:flex;align-items:center;gap:14px;cursor:pointer;transition:background 0.2s;border-radius:0;${c.unread > 0 ? 'border-left:3px solid var(--honey-yellow);' : ''}"
                         onclick="openConversation(${c.id}, '${c.user}', '${c.avatar}', ${c.userId})"
                         onmouseover="this.style.background='var(--bg-input)'" onmouseout="this.style.background=''">
                        <div style="position:relative;">
                            <img src="${c.avatar}" alt="${c.user}" style="width:50px;height:50px;border-radius:50%;">
                            ${c.unread > 0 ? `<div style="position:absolute;bottom:-2px;right:-2px;background:var(--honey-yellow);color:#000;font-size:10px;font-weight:bold;width:18px;height:18px;border-radius:50%;display:flex;align-items:center;justify-content:center;">${c.unread}</div>` : ''}
                        </div>
                        <div style="flex:1;min-width:0;">
                            <div style="display:flex;justify-content:space-between;align-items:center;">
                                <strong style="font-size:15px;">${c.user}</strong>
                                <span style="font-size:12px;color:var(--text-secondary);">${c.time}</span>
                            </div>
                            <div style="color:var(--text-secondary);font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:3px;${c.unread > 0 ? 'color:var(--text-primary);font-weight:500;' : ''}">${c.lastMessage}</div>
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>
    `;
}

function openConversation(convId, userName, userAvatar, userId) {
    const sampleMessages = [
        { from: 'them', text: 'Hey! I saw your latest post about cross-pollination. Amazing concept! ', time: '10:30 AM' },
        { from: 'me', text: 'Thanks! I\'ve been thinking about how bee behavior can inspire social platform design.', time: '10:32 AM' },
        { from: 'them', text: 'That\'s exactly what makes Polleneer special. The pollination metaphor is so natural.', time: '10:35 AM' },
        { from: 'me', text: 'Right? Every interaction should feel like a flower visit ', time: '10:37 AM' },
        { from: 'them', text: 'Would love to collaborate on some ideas! Maybe we can create a hive together?', time: '10:40 AM' },
    ];

    document.getElementById('mainContent').innerHTML = `
        <div style="max-width:700px;margin:0 auto;display:flex;flex-direction:column;height:calc(100vh - 120px);">
            <!-- Header -->
            <div style="display:flex;align-items:center;gap:12px;padding:15px;border-bottom:1px solid var(--border-color);">
                <button onclick="showMessages()" style="background:none;border:none;color:var(--text-primary);cursor:pointer;font-size:1.2em;"><i class="fas fa-arrow-left"></i></button>
                <img src="${userAvatar}" style="width:40px;height:40px;border-radius:50%;cursor:pointer;" onclick="goToUserProfile(${userId})">
                <div style="cursor:pointer;" onclick="goToUserProfile(${userId})">
                    <strong>${userName}</strong>
                    <div style="font-size:12px;color:var(--text-secondary);">@${userName.toLowerCase().replace(/\s/g,'')}  Online</div>
                </div>
            </div>

            <!-- Messages -->
            <div id="conversationMessages" style="flex:1;overflow-y:auto;padding:15px;display:flex;flex-direction:column;gap:10px;">
                ${sampleMessages.map(m => `
                    <div style="display:flex;justify-content:${m.from === 'me' ? 'flex-end' : 'flex-start'};">
                        <div style="max-width:70%;padding:10px 15px;border-radius:${m.from === 'me' ? '15px 15px 5px 15px' : '15px 15px 15px 5px'};background:${m.from === 'me' ? 'var(--honey-yellow)' : 'var(--bg-input)'};color:${m.from === 'me' ? '#000' : 'var(--text-primary)'};">
                            <div style="line-height:1.4;">${m.text}</div>
                            <div style="font-size:11px;margin-top:4px;opacity:0.7;text-align:right;">${m.time}</div>
                        </div>
                    </div>
                `).join('')}
            </div>

            <!-- Input -->
            <div style="padding:12px;border-top:1px solid var(--border-color);display:flex;gap:10px;align-items:end;">
                <div style="display:flex;gap:8px;align-items:center;">
                    <button onclick="showGifPicker()" style="background:none;border:none;color:var(--honey-yellow);cursor:pointer;font-size:1.1em;"><i class="fas fa-image"></i></button>
                    <button onclick="showEmojiPicker()" style="background:none;border:none;color:var(--honey-yellow);cursor:pointer;font-size:1.1em;"><i class="fas fa-face-smile"></i></button>
                </div>
                <input type="text" id="dmInput" placeholder="Send a message..." style="flex:1;padding:10px 15px;border-radius:20px;border:1px solid var(--border-color);background:var(--bg-input);color:var(--text-primary);font-size:14px;"
                    onkeypress="if(event.key==='Enter')sendDM('${userName}')">
                <button onclick="sendDM('${userName}')" style="background:var(--honey-yellow);color:#000;border:none;width:40px;height:40px;border-radius:50%;cursor:pointer;">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    `;

    // Scroll to bottom
    const msgContainer = document.getElementById('conversationMessages');
    if (msgContainer) msgContainer.scrollTop = msgContainer.scrollHeight;
}

function sendDM(userName) {
    const input = document.getElementById('dmInput');
    if (!input || !input.value.trim()) return;

    const msgContainer = document.getElementById('conversationMessages');
    const msgHTML = `
        <div style="display:flex;justify-content:flex-end;">
            <div style="max-width:70%;padding:10px 15px;border-radius:15px 15px 5px 15px;background:var(--honey-yellow);color:#000;">
                <div style="line-height:1.4;">${input.value.trim()}</div>
                <div style="font-size:11px;margin-top:4px;opacity:0.7;text-align:right;">Just now</div>
            </div>
        </div>
    `;
    msgContainer.innerHTML += msgHTML;
    msgContainer.scrollTop = msgContainer.scrollHeight;

    input.value = '';

    // Simulate reply after 2s
    setTimeout(() => {
        const replies = ['That sounds great! ', 'Absolutely! Let\'s make it happen.', 'Love that idea! ', 'I\'m in! When should we start?', 'Amazing, let me think about it! '];
        const reply = replies[Math.floor(Math.random() * replies.length)];
        const replyHTML = `
            <div style="display:flex;justify-content:flex-start;">
                <div style="max-width:70%;padding:10px 15px;border-radius:15px 15px 15px 5px;background:var(--bg-input);color:var(--text-primary);">
                    <div style="line-height:1.4;">${reply}</div>
                    <div style="font-size:11px;margin-top:4px;opacity:0.7;">Just now</div>
                </div>
            </div>
        `;
        msgContainer.innerHTML += replyHTML;
        msgContainer.scrollTop = msgContainer.scrollHeight;
    }, 2000);
}

function newDirectMessage() {
    const username = prompt('Who would you like to message? (Enter username):');
    if (!username) return;
    const user = users.find(u => u.username.toLowerCase() === username.toLowerCase().replace('@', ''));
    if (!user) { showToast('User not found. Try a different username.'); return; }
    openConversation(Date.now(), user.displayName || user.username, user.avatar, user.id);
}



// ===== CLEAN showCreatePostModal (buttons now in HTML template) =====
function showCreatePostModal() {
    if (!currentUser) { showToast('Please log in first!'); return; }
    const modalAvatar = document.getElementById('modalUserAvatar');
    if (modalAvatar) modalAvatar.src = currentUser.avatar;
    const postContent = document.getElementById('postContent');
    if (postContent) postContent.value = '';
    const mediaPreview = document.getElementById('mediaPreview');
    if (mediaPreview) { mediaPreview.style.display = 'none'; mediaPreview.innerHTML = ''; }
    const mediaContainer = document.getElementById('postMediaContainer');
    if (mediaContainer) mediaContainer.classList.add('hidden');
    const tagsContainer = document.getElementById('postTags');
    if (tagsContainer) tagsContainer.innerHTML = '';
    const pollContainer = document.getElementById('postPollContainer');
    if (pollContainer) pollContainer.classList.add('hidden');
    const oldLocation = document.getElementById('postLocation');
    if (oldLocation) oldLocation.remove();
    openModal('createPostModal');
    if (postContent) postContent.focus();
}

// ===== ADD NAV LINKS FOR NEW FEATURES =====
// Override goToHome to add new nav buttons in sidebar
// goToHome sidebar injection handled via DOMContentLoaded + MutationObserver
// (removed _originalGoToHome override to prevent circular reference issues)

function injectSidebarExtras() {
    // Add Analytics and Lists to the sidebar if not present
    setTimeout(() => {
        const sidebar = document.querySelector('.left-sidebar nav, .sidebar-nav');
        if (sidebar && !document.getElementById('nav-analytics')) {
            // Find the communities nav item to insert after it
            const navItems = sidebar.querySelectorAll('a, .nav-link, [onclick]');
            const lastNavItem = navItems[navItems.length - 1];

            if (lastNavItem && lastNavItem.parentElement) {
                const analyticsLink = document.createElement('a');
                analyticsLink.id = 'nav-analytics';
                analyticsLink.href = '#';
                analyticsLink.className = lastNavItem.className;
                analyticsLink.onclick = function(e) { e.preventDefault(); showAnalytics(); };
                analyticsLink.innerHTML = '<i class="fas fa-chart-line"></i><span>Analytics</span>';
                lastNavItem.parentElement.insertBefore(analyticsLink, lastNavItem.nextSibling);

                const listsLink = document.createElement('a');
                listsLink.id = 'nav-lists';
                listsLink.href = '#';
                listsLink.className = lastNavItem.className;
                listsLink.onclick = function(e) { e.preventDefault(); showLists(); };
                listsLink.innerHTML = '<i class="fas fa-list"></i><span>Lists</span>';
                analyticsLink.parentElement.insertBefore(listsLink, analyticsLink.nextSibling);
            }
        }
    }, 500);
}

// Run sidebar injection on load
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(injectSidebarExtras, 3000);
});

// ===== MAKE TRENDING TOPICS CLICKABLE =====
function loadTrendingTopics() {
    const trendingList = document.getElementById('trendingList');
    if (!trendingList) return;

    trendingList.innerHTML = TRENDING_TOPICS.map(topic => `
        <li class="trend-item" onclick="searchTag('${topic.tag}')" style="cursor:pointer;padding:12px;border-radius:10px;transition:background 0.2s;" onmouseover="this.style.background='var(--bg-input)'" onmouseout="this.style.background=''">
            <div class="trend-category" style="font-size:12px;color:var(--text-secondary);">${topic.category}  Trending</div>
            <div class="trend-tag" style="font-weight:bold;margin:3px 0;">${topic.tag}</div>
            <div class="trend-stats" style="font-size:12px;color:var(--text-secondary);">${topic.posts} posts</div>
        </li>
    `).join('');
}

// ===== UPDATE goToCommunities TO USE JOIN/LEAVE TOGGLE =====
function goToCommunities() {
    currentPage = 'communities';
    const joinedHives = JSON.parse(localStorage.getItem('polleneer_joined_hives') || '[]');

    const communities = [
        { name: 'Art Collective', members: '3.7k', icon: 'A', color: '#FF69B4', desc: 'For visual artists, digital creators, and art lovers' },
        { name: 'Tech Innovators', members: '4.2k', icon: 'T', color: '#87CEEB', desc: 'Cutting-edge tech discussions and innovation' },
        { name: 'Music Lovers', members: '5.1k', icon: 'M', color: '#9370DB', desc: 'Share and discover amazing music' },
        { name: 'Food & Travel', members: '2.9k', icon: 'F', color: '#FF8C00', desc: 'Foodie adventures and travel stories' },
        { name: 'Gaming Hive', members: '6.3k', icon: 'G', color: '#228B22', desc: 'Gamers unite! Reviews, streams, and esports' },
        { name: 'Science & Nature', members: '3.1k', icon: 'S', color: '#FFC30B', desc: 'Explore the wonders of the natural world' },
    ];

    document.getElementById('mainContent').innerHTML = `
        <div class="customization-panel" style="max-width:700px;margin:0 auto;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                <h3 style="color:var(--honey-yellow);"><i class="fas fa-users"></i> Communities</h3>
                <button onclick="createCommunity()" style="background:var(--honey-yellow);color:#000;border:none;padding:8px 18px;border-radius:20px;cursor:pointer;font-weight:bold;font-size:13px;">
                    <i class="fas fa-plus"></i> Create Hive
                </button>
            </div>

            <div style="display:grid;gap:12px;">
                ${communities.map(c => {
                    const isJoined = joinedHives.includes(c.name);
                    return `
                        <div class="post-card" style="padding:18px;display:flex;align-items:center;gap:15px;">
                            <div style="width:55px;height:55px;border-radius:12px;background:${c.color};display:flex;align-items:center;justify-content:center;font-size:24px;font-weight:bold;color:white;flex-shrink:0;">${c.icon}</div>
                            <div style="flex:1;">
                                <h4 style="margin-bottom:3px;">${c.name}</h4>
                                <p style="font-size:12px;color:var(--text-secondary);margin-bottom:5px;">${c.desc}</p>
                                <span style="font-size:12px;color:var(--text-secondary);">${c.members} members</span>
                            </div>
                            <button onclick="joinCommunity('${c.name}')" 
                                style="background:${isJoined ? 'transparent' : c.color};color:${isJoined ? 'var(--text-primary)' : 'white'};border:${isJoined ? '1px solid var(--border-color)' : 'none'};padding:8px 18px;border-radius:20px;cursor:pointer;font-weight:bold;font-size:13px;white-space:nowrap;">
                                ${isJoined ? 'Joined ' : 'Join'}
                            </button>
                        </div>
                    `;
                }).join('')}
            </div>
        </div>
    `;
    updateActiveNavLink('communities');
}




// ===== INLINE COMPOSE FUNCTIONS (Home Page X-style) =====
function expandInlineCompose() {
    const actions = document.getElementById('inlineComposeActions');
    if (actions) actions.classList.remove('hidden');
    const textarea = document.getElementById('inlinePostContent');
    if (textarea) textarea.style.minHeight = '80px';
}

function handleInlineCompose(textarea) {
    const btn = document.getElementById('inlineBuzzBtn');
    if (btn) btn.disabled = !textarea.value.trim();
    // Auto-resize
    textarea.style.height = 'auto';
    textarea.style.height = Math.min(textarea.scrollHeight, 200) + 'px';
}

function triggerInlineMedia() {
    document.getElementById('inlineMediaUpload').click();
}

function handleInlineMediaUpload(event) {
    const file = event.target.files[0];
    if (!file) return;
    const preview = document.getElementById('inlineMediaPreview');
    if (!preview) return;

    const reader = new FileReader();
    reader.onload = function(e) {
        preview.style.display = 'block';
        preview.innerHTML = `
            <div style="position:relative;display:inline-block;margin-top:10px;">
                <img src="${e.target.result}" style="max-width:100%;max-height:200px;border-radius:12px;">
                <button onclick="clearInlineMedia()" style="position:absolute;top:5px;right:5px;background:rgba(0,0,0,0.7);border:none;color:white;width:28px;height:28px;border-radius:50%;cursor:pointer;font-size:16px;">&times;</button>
            </div>
        `;
        const btn = document.getElementById('inlineBuzzBtn');
        if (btn) btn.disabled = false;
    };
    reader.readAsDataURL(file);
}

function clearInlineMedia() {
    const preview = document.getElementById('inlineMediaPreview');
    if (preview) { preview.style.display = 'none'; preview.innerHTML = ''; }
    const input = document.getElementById('inlineMediaUpload');
    if (input) input.value = '';
    // Re-check if buzz button should be disabled
    const textarea = document.getElementById('inlinePostContent');
    const btn = document.getElementById('inlineBuzzBtn');
    if (btn && textarea) btn.disabled = !textarea.value.trim();
}

function showEmojiPickerInline() {
    // Reuse the existing emoji picker but target inlinePostContent
    showEmojiPicker();
    // Override insertEmoji temporarily to target inline textarea
    window._emojiTarget = 'inlinePostContent';
}

// Override insertEmoji to support both modal and inline
const _origInsertEmoji = typeof insertEmoji === 'function' ? insertEmoji : null;
function insertEmoji(emoji) {
    const targetId = window._emojiTarget || 'postContent';
    const textarea = document.getElementById(targetId);
    if (textarea) {
        const start = textarea.selectionStart;
        const end = textarea.selectionEnd;
        textarea.value = textarea.value.substring(0, start) + emoji + textarea.value.substring(end);
        textarea.selectionStart = textarea.selectionEnd = start + emoji.length;
        textarea.focus();
        // Update buzz button state if inline
        if (targetId === 'inlinePostContent') {
            const btn = document.getElementById('inlineBuzzBtn');
            if (btn) btn.disabled = !textarea.value.trim();
        }
    }
    // Reset target
    window._emojiTarget = 'postContent';
}

// Same for insertSticker
const _origInsertSticker = typeof insertSticker === 'function' ? insertSticker : null;
function insertSticker(emoji) {
    const targetId = window._emojiTarget || 'postContent';
    const textarea = document.getElementById(targetId);
    if (textarea) {
        const start = textarea.selectionStart;
        const end = textarea.selectionEnd;
        textarea.value = textarea.value.substring(0, start) + emoji + textarea.value.substring(end);
        textarea.selectionStart = textarea.selectionEnd = start + emoji.length;
        textarea.focus();
        if (targetId === 'inlinePostContent') {
            const btn = document.getElementById('inlineBuzzBtn');
            if (btn) btn.disabled = !textarea.value.trim();
        }
    }
    const overlay = document.getElementById('stickerPickerOverlay');
    if (overlay) overlay.remove();
    window._emojiTarget = 'postContent';
}

function createPollInline() {
    // For polls, open the full modal since polls need more space
    showCreatePostModal();
    setTimeout(function() { createPoll(); }, 300);
}

function submitInlinePost() {
    const textarea = document.getElementById('inlinePostContent');
    if (!textarea || !textarea.value.trim()) return;
    if (!currentUser) { showToast('Please log in first!'); return; }

    const mediaPreview = document.getElementById('inlineMediaPreview');
    const mediaImg = mediaPreview ? mediaPreview.querySelector('img') : null;

    const newPost = {
        id: posts.length + 1,
        userId: currentUser.id,
        content: textarea.value.trim(),
        tags: [],
        media: mediaImg ? mediaImg.src : null,
        likes: 0,
        comments: 0,
        pollinations: 0,
        views: 0,
        createdAt: 'Just now',
        isLiked: false,
        isPollinated: false
    };

    posts.unshift(newPost);

    // Clear compose area
    textarea.value = '';
    textarea.style.height = 'auto';
    textarea.style.minHeight = '28px';
    if (mediaPreview) { mediaPreview.style.display = 'none'; mediaPreview.innerHTML = ''; }
    const inlineUpload = document.getElementById('inlineMediaUpload');
    if (inlineUpload) inlineUpload.value = '';
    const btn = document.getElementById('inlineBuzzBtn');
    if (btn) btn.disabled = true;
    const actions = document.getElementById('inlineComposeActions');
    if (actions) actions.classList.add('hidden');

    // Reload feed
    if (currentPage === 'home') {
        loadHomeFeed();
    }

    currentUser.honeyPoints += 25;
    updateUIForUser();
    localStorage.setItem('polleneer_user', JSON.stringify(currentUser));

    showToast('Buzz posted! +25 Honey Points ');
}

// Also override selectGif to support inline target
const _origSelectGif = typeof selectGif === 'function' ? selectGif : null;
function selectGif(url) {
    // Check if we're in inline mode
    const inlinePreview = document.getElementById('inlineMediaPreview');
    const inlineCompose = document.getElementById('inlineComposeActions');
    const isInline = inlineCompose && !inlineCompose.classList.contains('hidden');

    if (isInline && inlinePreview) {
        inlinePreview.style.display = 'block';
        inlinePreview.innerHTML = `
            <div style="position:relative;display:inline-block;margin-top:10px;">
                <img src="${url}" style="max-width:100%;border-radius:12px;max-height:200px;">
                <button onclick="clearInlineMedia()" style="position:absolute;top:5px;right:5px;background:rgba(0,0,0,0.7);border:none;color:white;width:28px;height:28px;border-radius:50%;cursor:pointer;font-size:16px;">&times;</button>
            </div>
        `;
        const btn = document.getElementById('inlineBuzzBtn');
        if (btn) btn.disabled = false;
    } else {
        // Modal mode
        const preview = document.getElementById('mediaPreview');
        if (preview) {
            preview.style.display = 'block';
            preview.innerHTML = `
                <div style="position:relative;display:inline-block;">
                    <img src="${url}" style="max-width:100%;border-radius:10px;max-height:200px;">
                    <button onclick="removeMedia()" style="position:absolute;top:5px;right:5px;background:rgba(0,0,0,0.7);border:none;color:white;width:25px;height:25px;border-radius:50%;cursor:pointer;">&times;</button>
                </div>
            `;
        }
    }
    const overlay = document.getElementById('gifPickerOverlay');
    if (overlay) overlay.remove();
    showToast('GIF added! ');
}



// ============================================
// PHASE 2.5 FIXES: Profile Page + Inline Compose Functions
// ============================================

// FIX 1: ADMIN_CREDENTIALS - add missing fields
(function() {
    if (typeof ADMIN_CREDENTIALS !== 'undefined') {
        if (!ADMIN_CREDENTIALS.id) ADMIN_CREDENTIALS.id = 999;
        if (!ADMIN_CREDENTIALS.displayName) ADMIN_CREDENTIALS.displayName = ADMIN_CREDENTIALS.username || 'Admin';
        if (!ADMIN_CREDENTIALS.bio) ADMIN_CREDENTIALS.bio = 'Bee Keeper of Polleneer. Building the future of social media. ';
        if (!ADMIN_CREDENTIALS.joined) ADMIN_CREDENTIALS.joined = '2024-01-01';
        if (!ADMIN_CREDENTIALS.followers) ADMIN_CREDENTIALS.followers = 1200;
        if (!ADMIN_CREDENTIALS.following) ADMIN_CREDENTIALS.following = 247;
        if (!ADMIN_CREDENTIALS.avatar) ADMIN_CREDENTIALS.avatar = 'https://api.dicebear.com/7.x/avataaars/svg?seed=BeeKeeper';
    }

    // Also fix currentUser if already loaded from localStorage and missing fields
    if (typeof currentUser !== 'undefined' && currentUser) {
        if (!currentUser.displayName) currentUser.displayName = currentUser.username || 'User';
        if (!currentUser.bio) currentUser.bio = 'Welcome to Polleneer! ';
        if (!currentUser.joined) currentUser.joined = new Date().toISOString().split('T')[0];
        if (!currentUser.followers) currentUser.followers = 0;
        if (!currentUser.following) currentUser.following = 0;
        if (!currentUser.avatar) currentUser.avatar = 'https://api.dicebear.com/7.x/avataaars/svg?seed=' + (currentUser.username || 'User');
        if (!currentUser.id) currentUser.id = 999;
    }
})();

// Patch the login flow to ensure fields are always set
const _origHandleLogin = handleLogin;
function handleLogin(e) {
    _origHandleLogin(e);
    // After login, ensure currentUser has all required fields
    if (currentUser) {
        if (!currentUser.displayName) currentUser.displayName = currentUser.username || 'User';
        if (!currentUser.bio) currentUser.bio = 'Welcome to Polleneer! ';
        if (!currentUser.joined) currentUser.joined = new Date().toISOString().split('T')[0];
        if (!currentUser.followers) currentUser.followers = 0;
        if (!currentUser.following) currentUser.following = 0;
        if (!currentUser.avatar) currentUser.avatar = 'https://api.dicebear.com/7.x/avataaars/svg?seed=' + (currentUser.username || 'User');
        if (!currentUser.id) currentUser.id = 999;
        localStorage.setItem('polleneer_user', JSON.stringify(currentUser));
    }
}

// FIX 2: Completely redesigned goToProfile with X/Twitter-style layout
function goToProfile(section) {
    section = section || 'posts';
    currentPage = 'profile';
    selectedProfileTab = section;

    // Ensure user fields exist
    if (currentUser) {
        if (!currentUser.displayName) currentUser.displayName = currentUser.username || 'User';
        if (!currentUser.bio) currentUser.bio = '';
        if (!currentUser.joined) currentUser.joined = new Date().toISOString().split('T')[0];
        if (!currentUser.followers) currentUser.followers = 0;
        if (!currentUser.following) currentUser.following = 0;
        if (!currentUser.avatar) currentUser.avatar = 'https://api.dicebear.com/7.x/avataaars/svg?seed=User';
        if (!currentUser.id) currentUser.id = 999;
    }

    const user = currentUser;
    const bannerUrl = user.bannerImage || localStorage.getItem('polleneer_banner_' + user.id) || '';
    const bannerStyle = bannerUrl 
        ? `background-image:url('${bannerUrl}');background-size:cover;background-position:center;`
        : 'background:linear-gradient(135deg, var(--honey-yellow), var(--hive-orange));';

    document.getElementById('mainContent').innerHTML = `
        <div style="max-width:800px;margin:0 auto;">
            <!-- Banner (clickable to change, like X) -->
            <div id="profileBannerArea" style="position:relative;height:200px;border-radius:var(--site-radius, 15px) var(--site-radius, 15px) 0 0;${bannerStyle}cursor:pointer;overflow:hidden;" onclick="changeBanner()">
                <div style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0);transition:background 0.2s;" onmouseover="this.style.background='rgba(0,0,0,0.4)';this.querySelector('.cam-icon').style.opacity='1'" onmouseout="this.style.background='rgba(0,0,0,0)';this.querySelector('.cam-icon').style.opacity='0'">
                    <div class="cam-icon" style="opacity:0;transition:opacity 0.2s;color:white;font-size:24px;"><i class="fas fa-camera"></i></div>
                </div>
                <input type="file" id="bannerUpload" accept="image/*" style="display:none;" onchange="handleBannerUpload(event)">
            </div>

            <!-- Profile Info Section -->
            <div style="background:var(--bg-card);padding:0 20px 20px;border-radius:0 0 var(--site-radius, 15px) var(--site-radius, 15px);border:1px solid var(--border-color);border-top:none;position:relative;">
                <!-- Avatar (overlapping banner) -->
                <div style="display:flex;justify-content:space-between;align-items:flex-start;">
                    <div style="margin-top:-65px;position:relative;">
                        <img src="${user.avatar}" alt="Profile" id="profileAvatar" 
                            style="width:130px;height:130px;border-radius:50%;border:4px solid var(--bg-card);object-fit:cover;cursor:pointer;background:var(--bg-card);" 
                            onclick="changeAvatar()">
                    </div>

                    <!-- Action Buttons (proper X-style) -->
                    <div style="display:flex;gap:10px;margin-top:15px;">
                        <button onclick="showCustomization()" 
                            style="padding:8px 18px;border-radius:20px;border:1px solid var(--border-color);background:transparent;color:var(--text-primary);cursor:pointer;font-weight:600;font-size:14px;transition:background 0.2s;display:flex;align-items:center;gap:6px;"
                            onmouseover="this.style.background='var(--bg-input)'" onmouseout="this.style.background='transparent'">
                            <i class="fas fa-paint-brush" style="font-size:13px;"></i> Customize
                        </button>
                        <button onclick="editProfileFull()"
                            style="padding:8px 18px;border-radius:20px;background:var(--honey-yellow);color:#000;border:none;cursor:pointer;font-weight:600;font-size:14px;display:flex;align-items:center;gap:6px;">
                            <i class="fas fa-edit" style="font-size:13px;"></i> Edit Profile
                        </button>
                    </div>
                </div>

                <!-- Name & Username -->
                <div style="margin-top:10px;">
                    <div style="display:flex;align-items:center;gap:8px;">
                        <h2 style="font-size:22px;font-weight:800;margin:0;">${user.displayName || user.username}</h2>
                        ${user.role === 'queen' || user.role === 'admin' ? '<i class="fas fa-check-circle" style="color:var(--honey-yellow);font-size:18px;" title="Verified Bee"></i>' : ''}
                        <span style="background:var(--honey-yellow);color:#000;padding:2px 10px;border-radius:10px;font-size:11px;font-weight:700;">${(typeof getRoleName === 'function' ? getRoleName(user.role) : user.role) || 'Bee'}</span>
                    </div>
                    <div style="color:var(--text-secondary);font-size:15px;margin-top:2px;">@${user.username}</div>
                </div>

                <!-- Bio -->
                <div style="margin-top:12px;font-size:15px;line-height:1.6;max-width:600px;">${user.bio || '<span style="color:var(--text-secondary);font-style:italic;">Add a bio to tell the hive about yourself</span>'}</div>

                <!-- Joined date + location -->
                <div style="display:flex;gap:16px;margin-top:12px;color:var(--text-secondary);font-size:14px;">
                    <span><i class="fas fa-calendar" style="margin-right:4px;"></i> Joined ${user.joined || 'recently'}</span>
                    ${user.location ? '<span><i class="fas fa-map-marker-alt" style="margin-right:4px;"></i> ' + user.location + '</span>' : ''}
                </div>

                <!-- Stats row -->
                <div style="display:flex;gap:20px;margin-top:14px;font-size:14px;">
                    <span style="cursor:pointer;" onclick="showFollowing()"><strong>${user.following || 0}</strong> <span style="color:var(--text-secondary);">Following</span></span>
                    <span style="cursor:pointer;" onclick="showFollowers()"><strong>${user.followers || 0}</strong> <span style="color:var(--text-secondary);">Followers</span></span>
                    <span style="cursor:pointer;" onclick="showHoneyShop()"><strong style="color:var(--honey-yellow);">${(user.honeyPoints || 0).toLocaleString()}</strong> <span style="color:var(--text-secondary);">Honey Points </span></span>
                </div>
            </div>

            <!-- Music Player -->
            <div id="profileMusicPlayer" style="display:none;background:var(--bg-card);border-radius:var(--site-radius, 15px);padding:15px;margin-top:10px;border:1px solid var(--border-color);">
                <div class="player-controls">
                    <button class="play-btn" id="profilePlayBtn" onclick="toggleMusic()"><i class="fas fa-play"></i></button>
                    <div class="song-info">
                        <div class="song-title" id="profileSongTitle">No song selected</div>
                        <div class="song-artist" id="profileSongArtist">Add music in customization</div>
                    </div>
                    <div class="progress-bar" onclick="seekMusic(event)"><div class="progress" id="musicProgress"></div></div>
                </div>
            </div>

            <!-- Bulletin Board -->
            <div style="background:var(--bg-card);border-radius:var(--site-radius, 15px);padding:20px;margin-top:10px;border:1px solid var(--border-color);">
                <h4 style="margin-bottom:12px;"><i class="fas fa-bullhorn"></i> Bulletin Board</h4>
                <div class="bulletin-form">
                    <textarea placeholder="Post a bulletin to your profile..." id="bulletinText" style="width:100%;min-height:60px;background:var(--bg-input);border:1px solid var(--border-color);border-radius:10px;padding:10px;color:var(--text-primary);resize:none;font-family:inherit;"></textarea>
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px;">
                        <div style="display:flex;gap:8px;">
                            <button class="action-btn" onclick="addBulletinOption('public')" style="font-size:12px;"><i class="fas fa-globe"></i> Public</button>
                            <button class="action-btn" onclick="addBulletinOption('friends')" style="font-size:12px;"><i class="fas fa-user-friends"></i> Friends</button>
                        </div>
                        <button class="pollinate-btn" onclick="postBulletin()" style="padding:8px 20px;font-size:13px;">
                            <i class="fas fa-paper-plane"></i> Post
                        </button>
                    </div>
                </div>
            </div>

            <!-- Top Friends -->
            <div style="background:var(--bg-card);border-radius:var(--site-radius, 15px);padding:20px;margin-top:10px;border:1px solid var(--border-color);">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
                    <h4><i class="fas fa-star"></i> Top Friends</h4>
                    <button class="action-btn" onclick="manageFriends()" style="font-size:12px;"><i class="fas fa-cog"></i> Manage</button>
                </div>
                <div class="friends-grid" id="topFriendsGrid"></div>
            </div>

            <!-- Profile Tabs -->
            <div style="display:flex;border-bottom:1px solid var(--border-color);margin-top:10px;background:var(--bg-card);border-radius:var(--site-radius, 15px) var(--site-radius, 15px) 0 0;overflow:hidden;">
                ${['posts','comments','media','likes'].map(tab => `
                    <button onclick="switchProfileTab('${tab}')" 
                        style="flex:1;padding:14px;border:none;background:transparent;color:${section === tab ? 'var(--honey-yellow)' : 'var(--text-secondary)'};cursor:pointer;font-weight:${section === tab ? '700' : '400'};font-size:14px;border-bottom:${section === tab ? '3px solid var(--honey-yellow)' : '3px solid transparent'};transition:all 0.2s;"
                        onmouseover="if(this.style.borderBottomColor==='transparent')this.style.background='var(--bg-input)'" onmouseout="this.style.background='transparent'">
                        <i class="fas fa-${tab === 'posts' ? 'feather-alt' : tab === 'comments' ? 'comment' : tab === 'media' ? 'image' : 'heart'}"></i> ${tab.charAt(0).toUpperCase() + tab.slice(1)}
                    </button>
                `).join('')}
            </div>

            <div id="profileFeed" style="min-height:200px;"></div>
        </div>
    `;

    if (typeof applyProfileCustomization === 'function') applyProfileCustomization();
    if (typeof loadProfileFeed === 'function') loadProfileFeed(section);
    if (typeof loadTopFriends === 'function') loadTopFriends();
    updateActiveNavLink('profile');
}

// FIX 3: Banner upload (like X)
function changeBanner() {
    document.getElementById('bannerUpload').click();
}

function handleBannerUpload(event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(e) {
        const bannerArea = document.getElementById('profileBannerArea');
        if (bannerArea) {
            bannerArea.style.backgroundImage = `url('${e.target.result}')`;
            bannerArea.style.backgroundSize = 'cover';
            bannerArea.style.backgroundPosition = 'center';
            bannerArea.style.background = ''; // Clear gradient
            bannerArea.style.backgroundImage = `url('${e.target.result}')`;
            bannerArea.style.backgroundSize = 'cover';
            bannerArea.style.backgroundPosition = 'center';
        }
        // Save to localStorage
        if (currentUser) {
            currentUser.bannerImage = e.target.result;
            localStorage.setItem('polleneer_banner_' + currentUser.id, e.target.result);
            localStorage.setItem('polleneer_user', JSON.stringify(currentUser));
        }
        showToast('Banner updated! ');
    };
    reader.readAsDataURL(file);
}

// FIX 4: Full Edit Profile modal (not just bio)
function editProfileFull() {
    const user = currentUser;

    const editModal = document.createElement('div');
    editModal.id = 'editProfileOverlay';
    editModal.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);z-index:10000;display:flex;align-items:center;justify-content:center;';
    editModal.onclick = function(e) { if(e.target === editModal) editModal.remove(); };

    editModal.innerHTML = `
        <div style="background:var(--bg-card);border-radius:15px;width:90%;max-width:500px;max-height:80vh;overflow-y:auto;">
            <div style="padding:15px 20px;border-bottom:1px solid var(--border-color);display:flex;justify-content:space-between;align-items:center;">
                <h3 style="color:var(--honey-yellow);"><i class="fas fa-edit"></i> Edit Profile</h3>
                <button onclick="document.getElementById('editProfileOverlay').remove()" style="background:none;border:none;color:var(--text-primary);font-size:1.5em;cursor:pointer;">&times;</button>
            </div>
            <div style="padding:20px;">
                <div style="margin-bottom:18px;">
                    <label style="display:block;font-weight:600;margin-bottom:6px;font-size:14px;">Display Name</label>
                    <input type="text" id="editDisplayName" value="${user.displayName || ''}" 
                        style="width:100%;padding:10px 14px;border-radius:10px;border:1px solid var(--border-color);background:var(--bg-input);color:var(--text-primary);font-size:15px;" maxlength="50">
                </div>
                <div style="margin-bottom:18px;">
                    <label style="display:block;font-weight:600;margin-bottom:6px;font-size:14px;">Bio</label>
                    <textarea id="editBioText" rows="3" maxlength="160"
                        style="width:100%;padding:10px 14px;border-radius:10px;border:1px solid var(--border-color);background:var(--bg-input);color:var(--text-primary);font-size:15px;resize:none;font-family:inherit;">${user.bio || ''}</textarea>
                    <div style="text-align:right;font-size:12px;color:var(--text-secondary);margin-top:4px;"><span id="bioCharCount">${(user.bio || '').length}</span>/160</div>
                </div>
                <div style="margin-bottom:18px;">
                    <label style="display:block;font-weight:600;margin-bottom:6px;font-size:14px;">Location</label>
                    <input type="text" id="editLocation" value="${user.location || ''}" placeholder="Where are you based?"
                        style="width:100%;padding:10px 14px;border-radius:10px;border:1px solid var(--border-color);background:var(--bg-input);color:var(--text-primary);font-size:15px;" maxlength="30">
                </div>
                <div style="margin-bottom:18px;">
                    <label style="display:block;font-weight:600;margin-bottom:6px;font-size:14px;">Website</label>
                    <input type="url" id="editWebsite" value="${user.website || ''}" placeholder="https://your-site.com"
                        style="width:100%;padding:10px 14px;border-radius:10px;border:1px solid var(--border-color);background:var(--bg-input);color:var(--text-primary);font-size:15px;">
                </div>
                <div style="display:flex;gap:10px;justify-content:flex-end;">
                    <button onclick="document.getElementById('editProfileOverlay').remove()" 
                        style="padding:10px 20px;border-radius:20px;border:1px solid var(--border-color);background:transparent;color:var(--text-primary);cursor:pointer;font-size:14px;">Cancel</button>
                    <button onclick="saveProfileEdits()" 
                        style="padding:10px 25px;border-radius:20px;background:var(--honey-yellow);color:#000;border:none;cursor:pointer;font-weight:700;font-size:14px;">Save</button>
                </div>
            </div>
        </div>
    `;

    document.body.appendChild(editModal);

    // Bio character counter
    const bioTextarea = document.getElementById('editBioText');
    if (bioTextarea) {
        bioTextarea.oninput = function() {
            document.getElementById('bioCharCount').textContent = this.value.length;
        };
    }
}

function saveProfileEdits() {
    const displayName = document.getElementById('editDisplayName').value.trim();
    const bio = document.getElementById('editBioText').value.trim();
    const location = document.getElementById('editLocation').value.trim();
    const website = document.getElementById('editWebsite').value.trim();

    if (displayName) currentUser.displayName = displayName;
    currentUser.bio = bio;
    currentUser.location = location;
    currentUser.website = website;

    localStorage.setItem('polleneer_user', JSON.stringify(currentUser));
    document.getElementById('editProfileOverlay').remove();

    // Refresh profile
    goToProfile(selectedProfileTab || 'posts');
    showToast('Profile updated! ');
}

</script>
</body>
</html>
